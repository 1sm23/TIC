!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.TEduBoard=e():t.TEduBoard=e()}(window,function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(o,i,function(e){return t[e]}.bind(null,i));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e,r){t.exports=function(t){function e(o){if(r[o])return r[o].exports;var i=r[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="D:\\github\\cos-wx-sdk-v5\\demo\\lib",e(e.s=4)}([function(t,e,r){"use strict";function o(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}function i(t){return c(t,function(t){return"object"==typeof t?i(t):t})}function n(t,e){return s(e,function(r,o){t[o]=e[o]}),t}function a(t){return t instanceof Array}function s(t,e){for(var r in t)t.hasOwnProperty(r)&&e(t[r],r)}function c(t,e){var r=a(t)?[]:{};for(var o in t)t.hasOwnProperty(o)&&(r[o]=e(t[o],o));return r}var l=r(8),u=r(6),d=r(10),h=r(7),f=r(5).btoa,p=function(){},g=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&null!==t[r]&&(e[r]=t[r]);return e},m=function(t,e){if(e=n({},e),"getAuth"!==t&&"getV4Auth"!==t&&"getObjectUrl"!==t){var r=e.Headers||{};e&&"object"==typeof e&&(function(){for(var t in e)e.hasOwnProperty(t)&&t.indexOf("x-cos-")>-1&&(r[t]=e[t])}(),y.each({"x-cos-mfa":"MFA","Content-MD5":"ContentMD5","Content-Length":"ContentLength","Content-Type":"ContentType",Expect:"Expect",Expires:"Expires","Cache-Control":"CacheControl","Content-Disposition":"ContentDisposition","Content-Encoding":"ContentEncoding",Range:"Range","If-Modified-Since":"IfModifiedSince","If-Unmodified-Since":"IfUnmodifiedSince","If-Match":"IfMatch","If-None-Match":"IfNoneMatch","x-cos-copy-source":"CopySource","x-cos-copy-source-Range":"CopySourceRange","x-cos-metadata-directive":"MetadataDirective","x-cos-copy-source-If-Modified-Since":"CopySourceIfModifiedSince","x-cos-copy-source-If-Unmodified-Since":"CopySourceIfUnmodifiedSince","x-cos-copy-source-If-Match":"CopySourceIfMatch","x-cos-copy-source-If-None-Match":"CopySourceIfNoneMatch","x-cos-acl":"ACL","x-cos-grant-read":"GrantRead","x-cos-grant-write":"GrantWrite","x-cos-grant-full-control":"GrantFullControl","x-cos-grant-read-acp":"GrantReadAcp","x-cos-grant-write-acp":"GrantWriteAcp","x-cos-storage-class":"StorageClass","x-cos-server-side-encryption-customer-algorithm":"SSECustomerAlgorithm","x-cos-server-side-encryption-customer-key":"SSECustomerKey","x-cos-server-side-encryption-customer-key-MD5":"SSECustomerKeyMD5","x-cos-server-side-encryption":"ServerSideEncryption","x-cos-server-side-encryption-cos-kms-key-id":"SSEKMSKeyId","x-cos-server-side-encryption-context":"SSEContext"},function(t,o){void 0!==e[t]&&(r[o]=e[t])}),e.Headers=g(r))}return e},_=function(t){return Date.now()+(t||0)},y={noop:p,formatParams:m,apiWrapper:function(t,e){return function(r,o){"function"==typeof r&&(o=r,r={}),r=m(t,r);var i=function(t){return t&&t.headers&&(t.headers["x-cos-version-id"]&&(t.VersionId=t.headers["x-cos-version-id"]),t.headers["x-cos-delete-marker"]&&(t.DeleteMarker=t.headers["x-cos-delete-marker"])),t},n=function(t,e){o&&o(i(t),i(e))};if("getService"!==t&&"abortUploadTask"!==t){var a;if(a=function(t,e){var r=e.Bucket,o=e.Region,i=e.Key;if(t.indexOf("Bucket")>-1||"deleteMultipleObject"===t||"multipartList"===t||"listObjectVersions"===t){if(!r)return"Bucket";if(!o)return"Region"}else if(t.indexOf("Object")>-1||t.indexOf("multipart")>-1||"sliceUploadFile"===t||"abortUploadTask"===t){if(!r)return"Bucket";if(!o)return"Region";if(!i)return"Key"}return!1}(t,r))return void n({error:"missing param "+a});if(r.Region){if(r.Region.indexOf("cos.")>-1)return void n({error:'param Region should not be start with "cos."'});if(!/^([a-z\d-]+)$/.test(r.Region))return void n({error:"Region format error."});this.options.CompatibilityMode||-1!==r.Region.indexOf("-")||"yfb"===r.Region||r.Region}if(r.Bucket){if(!/^([a-z\d-]+)-(\d+)$/.test(r.Bucket))if(r.AppId)r.Bucket=r.Bucket+"-"+r.AppId;else{if(!this.options.AppId)return void n({error:'Bucket should format as "test-1250000000".'});r.Bucket=r.Bucket+"-"+this.options.AppId}r.AppId&&delete r.AppId}}var s=e.call(this,r,n);if("getAuth"===t||"getObjectUrl"===t)return s}},xml2json:d,json2xml:h,md5:l,clearKey:g,getFileMd5:function(t,e){!function(t,e){var r,o=new FileReader;FileReader.prototype.readAsBinaryString?(r=FileReader.prototype.readAsBinaryString,o.onload=function(){e(this.result)}):FileReader.prototype.readAsArrayBuffer&&(r=function(t){var r="",o=new FileReader;o.onload=function(t){for(var i=new Uint8Array(o.result),n=i.byteLength,a=0;a<n;a++)r+=String.fromCharCode(i[a]);e(r)},o.readAsArrayBuffer(t)}),r.call(o,t)}(t,function(t){var r=l(t,!0);e(null,r)})},binaryBase64:function(t){var e,r,o,i="";for(e=0,r=t.length/2;e<r;e++)o=parseInt(t[2*e]+t[2*e+1],16),i+=String.fromCharCode(o);return f(i)},extend:n,isArray:a,isInArray:function(t,e){for(var r=!1,o=0;o<t.length;o++)if(e===t[o]){r=!0;break}return r},each:s,map:c,filter:function(t,e){var r=a(t),o=r?[]:{};for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)&&(r?o.push(t[i]):o[i]=t[i]);return o},clone:i,uuid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},camSafeUrlEncode:o,throttleOnProgress:function(t,e){function r(){if(i=0,e&&"function"==typeof e){o=Date.now();var r,n=Math.max(0,Math.round((s-a)/((o-c)/1e3)*100)/100);r=0===s&&0===t?1:Math.round(s/t*100)/100||0,c=o,a=s;try{e({loaded:s,total:t,speed:n,percent:r})}catch(t){}}}var o,i,n=this,a=0,s=0,c=Date.now();return function(e,o){if(e&&(s=e.loaded,t=e.total),o)clearTimeout(i),r();else{if(i)return;i=setTimeout(r,n.options.ProgressInterval)}}},getFileSize:function(t,e,r){var o;"string"==typeof e.Body&&(e.Body=new Blob([e.Body],{type:"text/plain"})),e.Body&&(e.Body instanceof Blob||"[object File]"===e.Body.toString()||"[object Blob]"===e.Body.toString())?(o=e.Body.size,e.ContentLength=o,r(null,o)):r({error:"params body format error, Only allow File|Blob|String."})},getSkewTime:_,getAuth:function(t){var e=(t=t||{}).SecretId,r=t.SecretKey,n=(t.method||t.Method||"get").toLowerCase(),a=i(t.Query||t.params||{}),s=i(t.Headers||t.headers||{}),c=t.Pathname||"/"+(t.Key||"");if(e&&r){var l=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e.sort(function(t,e){return(t=t.toLowerCase())===(e=e.toLowerCase())?0:t>e?1:-1})},d=function(t){var e,r,i,n=[],a=l(t);for(e=0;e<a.length;e++)i=void 0===t[r=a[e]]||null===t[r]?"":""+t[r],r=o(r=r.toLowerCase()),i=o(i)||"",n.push(r+"="+i);return n.join("&")},h=Math.round(_(t.SystemClockOffset)/1e3)-1,f=h,p=t.Expires||t.expires,g=e,m=h+";"+(f+=void 0===p?900:1*p||0),y=h+";"+f,b=l(s).join(";").toLowerCase(),T=l(a).join(";").toLowerCase(),v=u.HmacSHA1(y,r).toString(),C=[n,c,d(a),d(s),""].join("\n"),E=["sha1",m,u.SHA1(C).toString(),""].join("\n");return["q-sign-algorithm=sha1","q-ak="+g,"q-sign-time="+m,"q-key-time="+y,"q-header-list="+b,"q-url-param-list="+T,"q-signature="+u.HmacSHA1(E,v).toString()].join("&")}},isBrowser:!0,fileSlice:function(t,e,r){return t.slice?t.slice(e,r):t.mozSlice?t.mozSlice(e,r):t.webkitSlice?t.webkitSlice(e,r):void 0},getFileUUID:function(t,e){return t.name&&t.size&&t.lastModifiedDate&&e?y.md5([t.name,t.size,t.lastModifiedDate,e].join("::")):null},getBodyMd5:function(t,e,r){r=r||p,t&&"string"==typeof e?r(y.md5(e,!0)):r()}};t.exports=y},function(t,e){function r(t,e){for(var r in t)e[r]=t[r]}function o(t,e){function o(){}var i=t.prototype;if(Object.create){var n=Object.create(e.prototype);i.__proto__=n}i instanceof e||(o.prototype=e.prototype,r(i,o=new o),t.prototype=i=o),i.constructor!=t&&(i.constructor=t)}function i(t,e){if(e instanceof Error)var r=e;else r=this,Error.call(this,Q[t]),this.message=Q[t],Error.captureStackTrace&&Error.captureStackTrace(this,i);return r.code=t,e&&(this.message=this.message+": "+e),r}function n(){}function a(t,e){this._node=t,this._refresh=e,s(this)}function s(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var o=t._refresh(t._node);q(t,"length",o.length),r(o,t),t._inc=e}}function c(){}function l(t,e){for(var r=t.length;r--;)if(t[r]===e)return r}function u(t,e,r,o){if(o?e[l(e,o)]=r:e[e.length++]=r,t){r.ownerElement=t;var i=t.ownerDocument;i&&(o&&_(i,t,o),function(t,e,r){i&&i._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(e._nsMap[r.prefix?r.localName:""]=r.value)}(0,t,r))}}function d(t,e,r){var o=l(e,r);if(!(o>=0))throw i(et,new Error(t.tagName+"@"+r));for(var n=e.length-1;o<n;)e[o]=e[++o];if(e.length=n,t){var a=t.ownerDocument;a&&(_(a,t,r),r.ownerElement=null)}}function h(t){if(this._features={},t)for(var e in t)this._features=t[e]}function f(){}function p(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function g(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(g(t,e))return!0}while(t=t.nextSibling)}function m(){}function _(t,e,r,o){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete e._nsMap[r.prefix?r.localName:""]}function y(t,e,r){if(t&&t._inc){t._inc++;var o=e.childNodes;if(r)o[o.length++]=r;else{for(var i=e.firstChild,n=0;i;)o[n++]=i,i=i.nextSibling;o.length=n}}}function b(t,e){var r=e.previousSibling,o=e.nextSibling;return r?r.nextSibling=o:t.firstChild=o,o?o.previousSibling=r:t.lastChild=r,y(t.ownerDocument,t),e}function T(t,e,r){var o=e.parentNode;if(o&&o.removeChild(e),e.nodeType===J){var i=e.firstChild;if(null==i)return e;var n=e.lastChild}else i=n=e;var a=r?r.previousSibling:t.lastChild;i.previousSibling=a,n.nextSibling=r,a?a.nextSibling=i:t.firstChild=i,null==r?t.lastChild=n:r.previousSibling=n;do{i.parentNode=t}while(i!==n&&(i=i.nextSibling));return y(t.ownerDocument||t,t),e.nodeType==J&&(e.firstChild=e.lastChild=null),e}function v(){this._nsMap={}}function C(){}function E(){}function S(){}function D(){}function A(){}function O(){}function x(){}function R(){}function B(){}function I(){}function P(){}function w(){}function N(t,e){var r=[],o=9==this.nodeType?this.documentElement:this,i=o.prefix,n=o.namespaceURI;if(n&&null==i&&null==(i=o.lookupPrefix(n)))var a=[{namespace:n,prefix:null}];return k(this,r,t,e,a),r.join("")}function L(t,e,r){var o=t.prefix||"",i=t.namespaceURI;if(!o&&!i)return!1;if("xml"===o&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var n=r.length;n--;){var a=r[n];if(a.prefix==o)return a.namespace!=i}return!0}function k(t,e,r,o,i){if(o){if(!(t=o(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case U:i||(i=[]);var n=(i.length,t.attributes),a=n.length,s=t.firstChild,c=t.tagName;r=M===t.namespaceURI||r,e.push("<",c);for(var l=0;l<a;l++){"xmlns"==(u=n.item(l)).prefix?i.push({prefix:u.localName,namespace:u.value}):"xmlns"==u.nodeName&&i.push({prefix:"",namespace:u.value})}for(l=0;l<a;l++){var u;if(L(u=n.item(l),0,i)){var d=u.prefix||"",h=u.namespaceURI,f=d?" xmlns:"+d:" xmlns";e.push(f,'="',h,'"'),i.push({prefix:d,namespace:h})}k(u,e,r,o,i)}if(L(t,0,i)){d=t.prefix||"",h=t.namespaceURI,f=d?" xmlns:"+d:" xmlns";e.push(f,'="',h,'"'),i.push({prefix:d,namespace:h})}if(s||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(c)){if(e.push(">"),r&&/^script$/i.test(c))for(;s;)s.data?e.push(s.data):k(s,e,r,o,i),s=s.nextSibling;else for(;s;)k(s,e,r,o,i),s=s.nextSibling;e.push("</",c,">")}else e.push("/>");return;case Y:case J:for(s=t.firstChild;s;)k(s,e,r,o,i),s=s.nextSibling;return;case G:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,p),'"');case H:return e.push(t.data.replace(/[<&]/g,p));case j:return e.push("<![CDATA[",t.data,"]]>");case V:return e.push("\x3c!--",t.data,"--\x3e");case X:var g=t.publicId,m=t.systemId;if(e.push("<!DOCTYPE ",t.name),g)e.push(' PUBLIC "',g),m&&"."!=m&&e.push('" "',m),e.push('">');else if(m&&"."!=m)e.push(' SYSTEM "',m,'">');else{var _=t.internalSubset;_&&e.push(" [",_,"]"),e.push(">")}return;case z:return e.push("<?",t.target," ",t.data,"?>");case K:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function q(t,e,r){t[e]=r}var M="http://www.w3.org/1999/xhtml",F={},U=F.ELEMENT_NODE=1,G=F.ATTRIBUTE_NODE=2,H=F.TEXT_NODE=3,j=F.CDATA_SECTION_NODE=4,K=F.ENTITY_REFERENCE_NODE=5,W=F.ENTITY_NODE=6,z=F.PROCESSING_INSTRUCTION_NODE=7,V=F.COMMENT_NODE=8,Y=F.DOCUMENT_NODE=9,X=F.DOCUMENT_TYPE_NODE=10,J=F.DOCUMENT_FRAGMENT_NODE=11,$=F.NOTATION_NODE=12,Z={},Q={},tt=(Z.INDEX_SIZE_ERR=(Q[1]="Index size error",1),Z.DOMSTRING_SIZE_ERR=(Q[2]="DOMString size error",2),Z.HIERARCHY_REQUEST_ERR=(Q[3]="Hierarchy request error",3)),et=(Z.WRONG_DOCUMENT_ERR=(Q[4]="Wrong document",4),Z.INVALID_CHARACTER_ERR=(Q[5]="Invalid character",5),Z.NO_DATA_ALLOWED_ERR=(Q[6]="No data allowed",6),Z.NO_MODIFICATION_ALLOWED_ERR=(Q[7]="No modification allowed",7),Z.NOT_FOUND_ERR=(Q[8]="Not found",8)),rt=(Z.NOT_SUPPORTED_ERR=(Q[9]="Not supported",9),Z.INUSE_ATTRIBUTE_ERR=(Q[10]="Attribute in use",10));Z.INVALID_STATE_ERR=(Q[11]="Invalid state",11),Z.SYNTAX_ERR=(Q[12]="Syntax error",12),Z.INVALID_MODIFICATION_ERR=(Q[13]="Invalid modification",13),Z.NAMESPACE_ERR=(Q[14]="Invalid namespace",14),Z.INVALID_ACCESS_ERR=(Q[15]="Invalid access",15),i.prototype=Error.prototype,r(Z,i),n.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var r=[],o=0;o<this.length;o++)k(this[o],r,t,e);return r.join("")}},a.prototype.item=function(t){return s(this),this[t]},o(a,n),c.prototype={length:0,item:n.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var r=this[e];if(r.nodeName==t)return r}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new i(rt);var r=this.getNamedItem(t.nodeName);return u(this._ownerElement,this,t,r),r},setNamedItemNS:function(t){var e,r=t.ownerElement;if(r&&r!=this._ownerElement)throw new i(rt);return e=this.getNamedItemNS(t.namespaceURI,t.localName),u(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return d(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var r=this.getNamedItemNS(t,e);return d(this._ownerElement,this,r),r},getNamedItemNS:function(t,e){for(var r=this.length;r--;){var o=this[r];if(o.localName==e&&o.namespaceURI==t)return o}return null}},h.prototype={hasFeature:function(t,e){var r=this._features[t.toLowerCase()];return!(!r||e&&!(e in r))},createDocument:function(t,e,r){var o=new m;if(o.implementation=this,o.childNodes=new n,o.doctype=r,r&&o.appendChild(r),e){var i=o.createElementNS(t,e);o.appendChild(i)}return o},createDocumentType:function(t,e,r){var o=new O;return o.name=t,o.nodeName=t,o.publicId=e,o.systemId=r,o}},f.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return T(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return b(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function t(e,r,o){var i=new r.constructor;for(var a in r){var s=r[a];"object"!=typeof s&&s!=i[a]&&(i[a]=s)}switch(r.childNodes&&(i.childNodes=new n),i.ownerDocument=e,i.nodeType){case U:var l=r.attributes,u=i.attributes=new c,d=l.length;u._ownerElement=i;for(var h=0;h<d;h++)i.setAttributeNode(t(e,l.item(h),!0));break;case G:o=!0}if(o)for(var f=r.firstChild;f;)i.appendChild(t(e,f,o)),f=f.nextSibling;return i}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==H&&t.nodeType==H?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var r=e._nsMap;if(r)for(var o in r)if(r[o]==t)return o;e=e.nodeType==G?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var r=e._nsMap;if(r&&t in r)return r[t];e=e.nodeType==G?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},r(F,f),r(F,f.prototype),m.prototype={nodeName:"#document",nodeType:Y,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==J){for(var r=t.firstChild;r;){var o=r.nextSibling;this.insertBefore(r,e),r=o}return t}return null==this.documentElement&&t.nodeType==U&&(this.documentElement=t),T(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),b(this,t)},importNode:function(t,e){return function t(e,r,o){var i;switch(r.nodeType){case U:(i=r.cloneNode(!1)).ownerDocument=e;case J:break;case G:o=!0}if(i||(i=r.cloneNode(!1)),i.ownerDocument=e,i.parentNode=null,o)for(var n=r.firstChild;n;)i.appendChild(t(e,n,o)),n=n.nextSibling;return i}(this,t,e)},getElementById:function(t){var e=null;return g(this.documentElement,function(r){if(r.nodeType==U&&r.getAttribute("id")==t)return e=r,!0}),e},createElement:function(t){var e=new v;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new n,(e.attributes=new c)._ownerElement=e,e},createDocumentFragment:function(){var t=new I;return t.ownerDocument=this,t.childNodes=new n,t},createTextNode:function(t){var e=new S;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new D;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new A;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var r=new P;return r.ownerDocument=this,r.tagName=r.target=t,r.nodeValue=r.data=e,r},createAttribute:function(t){var e=new C;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new B;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var r=new v,o=e.split(":"),i=r.attributes=new c;return r.childNodes=new n,r.ownerDocument=this,r.nodeName=e,r.tagName=e,r.namespaceURI=t,2==o.length?(r.prefix=o[0],r.localName=o[1]):r.localName=e,i._ownerElement=r,r},createAttributeNS:function(t,e){var r=new C,o=e.split(":");return r.ownerDocument=this,r.nodeName=e,r.name=e,r.namespaceURI=t,r.specified=!0,2==o.length?(r.prefix=o[0],r.localName=o[1]):r.localName=e,r}},o(m,f),v.prototype={nodeType:U,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var r=this.ownerDocument.createAttribute(t);r.value=r.nodeValue=""+e,this.setAttributeNode(r)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===J?this.insertBefore(t,null):function(t,e){var r=e.parentNode;if(r){var o=t.lastChild;r.removeChild(e);o=t.lastChild}o=t.lastChild;return e.parentNode=t,e.previousSibling=o,e.nextSibling=null,o?o.nextSibling=e:t.firstChild=e,t.lastChild=e,y(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);r&&this.removeAttributeNode(r)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);return r&&r.value||""},setAttributeNS:function(t,e,r){var o=this.ownerDocument.createAttributeNS(t,e);o.value=o.nodeValue=""+r,this.setAttributeNode(o)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new a(this,function(e){var r=[];return g(e,function(o){o===e||o.nodeType!=U||"*"!==t&&o.tagName!=t||r.push(o)}),r})},getElementsByTagNameNS:function(t,e){return new a(this,function(r){var o=[];return g(r,function(i){i===r||i.nodeType!==U||"*"!==t&&i.namespaceURI!==t||"*"!==e&&i.localName!=e||o.push(i)}),o})}},m.prototype.getElementsByTagName=v.prototype.getElementsByTagName,m.prototype.getElementsByTagNameNS=v.prototype.getElementsByTagNameNS,o(v,f),C.prototype.nodeType=G,o(C,f),E.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(Q[tt])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,r){r=this.data.substring(0,t)+r+this.data.substring(t+e),this.nodeValue=this.data=r,this.length=r.length}},o(E,f),S.prototype={nodeName:"#text",nodeType:H,splitText:function(t){var e=this.data,r=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var o=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(o,this.nextSibling),o}},o(S,E),D.prototype={nodeName:"#comment",nodeType:V},o(D,E),A.prototype={nodeName:"#cdata-section",nodeType:j},o(A,E),O.prototype.nodeType=X,o(O,f),x.prototype.nodeType=$,o(x,f),R.prototype.nodeType=W,o(R,f),B.prototype.nodeType=K,o(B,f),I.prototype.nodeName="#document-fragment",I.prototype.nodeType=J,o(I,f),P.prototype.nodeType=z,o(P,f),w.prototype.serializeToString=function(t,e,r){return N.call(t,e,r)},f.prototype.toString=N;try{Object.defineProperty&&(Object.defineProperty(a.prototype,"length",{get:function(){return s(this),this.$$length}}),Object.defineProperty(f.prototype,"textContent",{get:function(){return function t(e){switch(e.nodeType){case U:case J:var r=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&r.push(t(e)),e=e.nextSibling;return r.join("");default:return e.nodeValue}}(this)},set:function(t){switch(this.nodeType){case U:case J:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),q=function(t,e,r){t["$$"+e]=r})}catch(t){}e.DOMImplementation=h,e.XMLSerializer=w},function(t,e){var r=function(t){var e={},r=function(t){return!e[t]&&(e[t]=[]),e[t]};t.on=function(t,e){r(t).push(e)},t.off=function(t,e){for(var o=r(t),i=o.length-1;i>=0;i--)e===o[i]&&o.splice(i,1)},t.emit=function(t,e){for(var o=r(t).map(function(t){return t}),i=0;i<o.length;i++)o[i](e)}};t.exports.init=r,t.exports.EventProxy=function(){r(this)}},function(t,e,r){"use strict";var o=r(0),i=r(2),n=r(16),a=r(15),s=r(13),c={SecretId:"",SecretKey:"",XCosSecurityToken:"",FileParallelLimit:3,ChunkParallelLimit:3,ChunkSize:1048576,SliceSize:1048576,CopyChunkParallelLimit:20,CopyChunkSize:10485760,CopySliceSize:10485760,MaxPartNumber:1e4,ProgressInterval:1e3,UploadQueueSize:1e4,Domain:"",ServiceDomain:"",Protocol:"",CompatibilityMode:!1,ForcePathStyle:!1,CorrectClockSkew:!0,SystemClockOffset:0},l=function(t){this.options=o.extend(o.clone(c),t||{}),this.options.FileParallelLimit=Math.max(1,this.options.FileParallelLimit),this.options.ChunkParallelLimit=Math.max(1,this.options.ChunkParallelLimit),this.options.ChunkRetryTimes=Math.max(0,this.options.ChunkRetryTimes),this.options.ChunkSize=Math.max(1048576,this.options.ChunkSize),this.options.CopyChunkParallelLimit=Math.max(1,this.options.CopyChunkParallelLimit),this.options.CopyChunkSize=Math.max(1048576,this.options.CopyChunkSize),this.options.CopySliceSize=Math.max(0,this.options.CopySliceSize),this.options.MaxPartNumber=Math.max(1024,Math.min(1e4,this.options.MaxPartNumber)),this.options.Timeout=Math.max(0,this.options.Timeout),this.options.AppId,i.init(this),n.init(this)};a.init(l,n),s.init(l,n),l.getAuthorization=o.getAuth,l.version="0.7.3",t.exports=l},function(t,e,r){var o=r(3);t.exports=o},function(t,e){var r=function(t){var e=(t=t||{}).Base64,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=function(t){for(var e={},r=0,o=t.length;r<o;r++)e[t.charAt(r)]=r;return e}(r),i=String.fromCharCode,n=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?i(192|e>>>6)+i(128|63&e):i(224|e>>>12&15)+i(128|e>>>6&63)+i(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return i(240|e>>>18&7)+i(128|e>>>12&63)+i(128|e>>>6&63)+i(128|63&e)},a=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,s=function(t){return t.replace(a,n)},c=function(t){var e=[0,2,1][t.length%3],o=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[r.charAt(o>>>18),r.charAt(o>>>12&63),e>=2?"=":r.charAt(o>>>6&63),e>=1?"=":r.charAt(63&o)].join("")},l=t.btoa?function(e){return t.btoa(e)}:function(t){return t.replace(/[\s\S]{1,3}/g,c)},u=function(t){return l(s(t))},d=function(t,e){return e?u(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):u(String(t))},h=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),f=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return i(55296+(e>>>10))+i(56320+(1023&e));case 3:return i((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return i((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},p=function(t){return t.replace(h,f)},g=function(t){var e=t.length,r=e%4,n=(e>0?o[t.charAt(0)]<<18:0)|(e>1?o[t.charAt(1)]<<12:0)|(e>2?o[t.charAt(2)]<<6:0)|(e>3?o[t.charAt(3)]:0),a=[i(n>>>16),i(n>>>8&255),i(255&n)];return a.length-=[0,0,2,1][r],a.join("")},m=t.atob?function(e){return t.atob(e)}:function(t){return t.replace(/[\s\S]{1,4}/g,g)},_=function(t){return function(t){return p(m(t))}(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};return{VERSION:"2.1.9",atob:m,btoa:l,fromBase64:_,toBase64:d,utob:s,encode:d,encodeURI:function(t){return d(t,!0)},btou:p,decode:_,noConflict:function(){var r=t.Base64;return t.Base64=e,r}}}();t.exports=r},function(t,e){var r=r||function(t,e){var r={},o=r.lib={},i=function(){},n=o.Base={extend:function(t){i.prototype=this;var e=new i;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=n.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,r=t.words,o=this.sigBytes;if(t=t.sigBytes,this.clamp(),o%4)for(var i=0;i<t;i++)e[o+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(o+i)%4*8;else if(65535<r.length)for(i=0;i<t;i+=4)e[o+i>>>2]=r[i>>>2];else e.push.apply(e,r);return this.sigBytes+=t,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=n.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var r=[],o=0;o<e;o+=4)r.push(4294967296*t.random()|0);return new a.init(r,e)}}),s=r.enc={},c=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var r=[],o=0;o<t;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,r=[],o=0;o<e;o+=2)r[o>>>3]|=parseInt(t.substr(o,2),16)<<24-o%8*4;return new a.init(r,e/2)}},l=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var r=[],o=0;o<t;o++)r.push(String.fromCharCode(e[o>>>2]>>>24-o%4*8&255));return r.join("")},parse:function(t){for(var e=t.length,r=[],o=0;o<e;o++)r[o>>>2]|=(255&t.charCodeAt(o))<<24-o%4*8;return new a.init(r,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},d=o.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r=this._data,o=r.words,i=r.sigBytes,n=this.blockSize,s=i/(4*n);if(e=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*n,i=t.min(4*e,i),e){for(var c=0;c<e;c+=n)this._doProcessBlock(o,c);c=o.splice(0,e),r.sigBytes-=i}return new a.init(c,i)},clone:function(){var t=n.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});o.Hasher=d.extend({cfg:n.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new h.HMAC.init(t,r).finalize(e)}}});var h=r.algo={};return r}(Math);!function(){var t=r,e=(n=t.lib).WordArray,o=n.Hasher,i=[],n=t.algo.SHA1=o.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=this._hash.words,o=r[0],n=r[1],a=r[2],s=r[3],c=r[4],l=0;80>l;l++){if(16>l)i[l]=0|t[e+l];else{var u=i[l-3]^i[l-8]^i[l-14]^i[l-16];i[l]=u<<1|u>>>31}u=(o<<5|o>>>27)+c+i[l],u=20>l?u+(1518500249+(n&a|~n&s)):40>l?u+(1859775393+(n^a^s)):60>l?u+((n&a|n&s|a&s)-1894007588):u+((n^a^s)-899497514),c=s,s=a,a=n<<30|n>>>2,n=o,o=u}r[0]=r[0]+o|0,r[1]=r[1]+n|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+c|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return e[o>>>5]|=128<<24-o%32,e[14+(o+64>>>9<<4)]=Math.floor(r/4294967296),e[15+(o+64>>>9<<4)]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=o._createHelper(n),t.HmacSHA1=o._createHmacHelper(n)}(),function(){var t=r,e=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(t,r){t=this._hasher=new t.init,"string"==typeof r&&(r=e.parse(r));var o=t.blockSize,i=4*o;r.sigBytes>i&&(r=t.finalize(r)),r.clamp();for(var n=this._oKey=r.clone(),a=this._iKey=r.clone(),s=n.words,c=a.words,l=0;l<o;l++)s[l]^=1549556828,c[l]^=909522486;n.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}})}(),function(){var t=r,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,o=this._map;t.clamp();for(var i=[],n=0;n<r;n+=3)for(var a=(e[n>>>2]>>>24-n%4*8&255)<<16|(e[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|e[n+2>>>2]>>>24-(n+2)%4*8&255,s=0;s<4&&n+.75*s<r;s++)i.push(o.charAt(a>>>6*(3-s)&63));var c=o.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(t){var r=t.length,o=this._map,i=o.charAt(64);if(i){var n=t.indexOf(i);-1!=n&&(r=n)}for(var a=[],s=0,c=0;c<r;c++)if(c%4){var l=o.indexOf(t.charAt(c-1))<<c%4*2,u=o.indexOf(t.charAt(c))>>>6-c%4*2;a[s>>>2]|=(l|u)<<24-s%4*8,s++}return e.create(a,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.exports=r},function(t,e){function r(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(i,"")}var o=new RegExp("^([^a-zA-Z_À-ÖØ-öø-ÿͰ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿿、-퟿豈-﷏ﷰ-�])|^((x|X)(m|M)(l|L))|([^a-zA-Z_À-ÖØ-öø-ÿͰ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿿、-퟿豈-﷏ﷰ-�-.0-9·̀-ͯ‿⁀])","g"),i=/[^\x09\x0A\x0D\x20-\xFF\x85\xA0-\uD7FF\uE000-\uFDCF\uFDE0-\uFFFD]/gm,n=function(t){var e=[];if(t instanceof Object)for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e},a=function(t,e){var i=function(t,r,i,n,a){var s=void 0!==e.indent?e.indent:"\t",c=e.prettyPrint?"\n"+new Array(n).join(s):"";e.removeIllegalNameCharacters&&(t=t.replace(o,"_"));var l=[c,"<",t,i||""];return r&&r.length>0?(l.push(">"),l.push(r),a&&l.push(c),l.push("</"),l.push(t),l.push(">")):l.push("/>"),l.join("")};return function t(o,a,s){var c=typeof o;switch((Array.isArray?Array.isArray(o):o instanceof Array)?c="array":o instanceof Date&&(c="date"),c){case"array":var l=[];return o.map(function(e){l.push(t(e,0,s+1))}),e.prettyPrint&&l.push("\n"),l.join("");case"date":return o.toJSON?o.toJSON():o+"";case"object":var u=[];for(var d in o)if(o[d]instanceof Array)for(var h in o[d])u.push(i(d,t(o[d][h],0,s+1),null,s+1,n(o[d][h]).length));else u.push(i(d,t(o[d],0,s+1),null,s+1));return e.prettyPrint&&u.length>0&&u.push("\n"),u.join("");case"function":return o();default:return e.escape?r(o):""+o}}(t,0,0)},s=function(t){var e=['<?xml version="1.0" encoding="UTF-8"'];return t&&e.push(' standalone="yes"'),e.push("?>"),e.join("")};t.exports=function(t,e){if(e||(e={xmlHeader:{standalone:!0},prettyPrint:!0,indent:"  "}),"string"==typeof t)try{t=JSON.parse(t.toString())}catch(t){return!1}var r="",o="";return e&&("object"==typeof e?(e.xmlHeader&&(r=s(!!e.xmlHeader.standalone)),void 0!==e.docType&&(o="<!DOCTYPE "+e.docType+">")):r=s()),[r,(e=e||{}).prettyPrint&&o?"\n":"",o,a(t,e)].join("").replace(/\n{2,}/g,"\n").replace(/\s+$/g,"")}},function(t,e){t.exports=function(t){function e(t,e){return t<<e|t>>>32-e}function r(t,e){var r,o,i,n,a;return i=2147483648&t,n=2147483648&e,a=(1073741823&t)+(1073741823&e),(r=1073741824&t)&(o=1073741824&e)?2147483648^a^i^n:r|o?1073741824&a?3221225472^a^i^n:1073741824^a^i^n:a^i^n}function o(t,o,i,n,a,s,c){return r(e(t=r(t,r(r(o&i|~o&n,a),c)),s),o)}function i(t,o,i,n,a,s,c){return r(e(t=r(t,r(r(o&n|i&~n,a),c)),s),o)}function n(t,o,i,n,a,s,c){return r(e(t=r(t,r(r(o^i^n,a),c)),s),o)}function a(t,o,i,n,a,s,c){return r(e(t=r(t,r(r(i^(o|~n),a),c)),s),o)}function s(t){var e,r="",o="";for(e=0;e<=3;e++)r+=(o="0"+(t>>>8*e&255).toString(16)).substr(o.length-2,2);return r}var c,l,u,d,h,f,p,g,m,_=Array();for(_=function(t){for(var e,r=t.length,o=r+8,i=16*((o-o%64)/64+1),n=Array(i-1),a=0,s=0;s<r;)a=s%4*8,n[e=(s-s%4)/4]=n[e]|t.charCodeAt(s)<<a,s++;return a=s%4*8,n[e=(s-s%4)/4]=n[e]|128<<a,n[i-2]=r<<3,n[i-1]=r>>>29,n}(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var o=t.charCodeAt(r);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}(t)),f=1732584193,p=4023233417,g=2562383102,m=271733878,c=0;c<_.length;c+=16)l=f,u=p,d=g,h=m,f=o(f,p,g,m,_[c+0],7,3614090360),m=o(m,f,p,g,_[c+1],12,3905402710),g=o(g,m,f,p,_[c+2],17,606105819),p=o(p,g,m,f,_[c+3],22,3250441966),f=o(f,p,g,m,_[c+4],7,4118548399),m=o(m,f,p,g,_[c+5],12,1200080426),g=o(g,m,f,p,_[c+6],17,2821735955),p=o(p,g,m,f,_[c+7],22,4249261313),f=o(f,p,g,m,_[c+8],7,1770035416),m=o(m,f,p,g,_[c+9],12,2336552879),g=o(g,m,f,p,_[c+10],17,4294925233),p=o(p,g,m,f,_[c+11],22,2304563134),f=o(f,p,g,m,_[c+12],7,1804603682),m=o(m,f,p,g,_[c+13],12,4254626195),g=o(g,m,f,p,_[c+14],17,2792965006),f=i(f,p=o(p,g,m,f,_[c+15],22,1236535329),g,m,_[c+1],5,4129170786),m=i(m,f,p,g,_[c+6],9,3225465664),g=i(g,m,f,p,_[c+11],14,643717713),p=i(p,g,m,f,_[c+0],20,3921069994),f=i(f,p,g,m,_[c+5],5,3593408605),m=i(m,f,p,g,_[c+10],9,38016083),g=i(g,m,f,p,_[c+15],14,3634488961),p=i(p,g,m,f,_[c+4],20,3889429448),f=i(f,p,g,m,_[c+9],5,568446438),m=i(m,f,p,g,_[c+14],9,3275163606),g=i(g,m,f,p,_[c+3],14,4107603335),p=i(p,g,m,f,_[c+8],20,1163531501),f=i(f,p,g,m,_[c+13],5,2850285829),m=i(m,f,p,g,_[c+2],9,4243563512),g=i(g,m,f,p,_[c+7],14,1735328473),f=n(f,p=i(p,g,m,f,_[c+12],20,2368359562),g,m,_[c+5],4,4294588738),m=n(m,f,p,g,_[c+8],11,2272392833),g=n(g,m,f,p,_[c+11],16,1839030562),p=n(p,g,m,f,_[c+14],23,4259657740),f=n(f,p,g,m,_[c+1],4,2763975236),m=n(m,f,p,g,_[c+4],11,1272893353),g=n(g,m,f,p,_[c+7],16,4139469664),p=n(p,g,m,f,_[c+10],23,3200236656),f=n(f,p,g,m,_[c+13],4,681279174),m=n(m,f,p,g,_[c+0],11,3936430074),g=n(g,m,f,p,_[c+3],16,3572445317),p=n(p,g,m,f,_[c+6],23,76029189),f=n(f,p,g,m,_[c+9],4,3654602809),m=n(m,f,p,g,_[c+12],11,3873151461),g=n(g,m,f,p,_[c+15],16,530742520),f=a(f,p=n(p,g,m,f,_[c+2],23,3299628645),g,m,_[c+0],6,4096336452),m=a(m,f,p,g,_[c+7],10,1126891415),g=a(g,m,f,p,_[c+14],15,2878612391),p=a(p,g,m,f,_[c+5],21,4237533241),f=a(f,p,g,m,_[c+12],6,1700485571),m=a(m,f,p,g,_[c+3],10,2399980690),g=a(g,m,f,p,_[c+10],15,4293915773),p=a(p,g,m,f,_[c+1],21,2240044497),f=a(f,p,g,m,_[c+8],6,1873313359),m=a(m,f,p,g,_[c+15],10,4264355552),g=a(g,m,f,p,_[c+6],15,2734768916),p=a(p,g,m,f,_[c+13],21,1309151649),f=a(f,p,g,m,_[c+4],6,4149444226),m=a(m,f,p,g,_[c+11],10,3174756917),g=a(g,m,f,p,_[c+2],15,718787259),p=a(p,g,m,f,_[c+9],21,3951481745),f=r(f,l),p=r(p,u),g=r(g,d),m=r(m,h);return(s(f)+s(p)+s(g)+s(m)).toLowerCase()}},function(t,e){t.exports=function(t,e){var r,o=t.filePath,i=t.headers||{},n=t.url,a=t.method,s=t.onProgress,c=function(t,r){e(t,{statusCode:r.statusCode,headers:r.header},r.data)};if(o){var l,u=n.match(/^(https?:\/\/[^\/]+\/)([^\/]*\/?)(.*)$/);t.pathStyle?(l=decodeURIComponent(u[3]||""),n=u[1]+u[2]):(l=decodeURIComponent(u[2]+u[3]||""),n=u[1]);var d={key:l,success_action_status:200,Signature:i.Authorization},h=["Cache-Control","Content-Type","Content-Disposition","Content-Encoding","Expires","x-cos-storage-class","x-cos-security-token"];for(var f in t.headers)t.headers.hasOwnProperty(f)&&(f.indexOf("x-cos-meta-")>-1||h.indexOf(f)>-1)&&(d[f]=t.headers[f]);i["x-cos-acl"]&&(d.acl=i["x-cos-acl"]),!d["Content-Type"]&&(d["Content-Type"]=""),(r=wx.uploadFile({url:n,method:a,name:"file",filePath:o,formData:d,success:function(t){c(null,t)},fail:function(t){c(t.errMsg,t)}})).onProgressUpdate(function(t){s({loaded:t.totalBytesSent,total:t.totalBytesExpectedToSend,progress:t.progress/100})})}else{var p=t.qs&&function(t){var e,r,o,i=[],n=Object.keys(t);for(e=0;e<n.length;e++)o=t[r=n[e]]||"",i.push(r+"="+encodeURIComponent(o));return i.join("&")}(t.qs)||"";p&&(n+=(n.indexOf("?")>-1?"&":"?")+p),i["Content-Length"]&&delete i["Content-Length"],wx.request({url:n,method:a,header:i,dataType:"text",data:t.body,success:function(t){c(null,t)},fail:function(t){c(t.errMsg,t)}})}return r}},function(t,e,r){var o=r(11).DOMParser,i=function(t){"use strict";function e(t){var e=t.localName;return null==e&&(e=t.baseName),null!=e&&""!=e||(e=t.nodeName),e}function r(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):t}function i(t,e,r,o){for(var i=0;i<t.length;i++){var n=t[i];if("string"==typeof n){if(n==o)break}else if(n instanceof RegExp){if(n.test(o))break}else if("function"==typeof n&&n(e,r,o))break}return i!=t.length}function n(e,r,o){switch(t.arrayAccessForm){case"property":e[r]instanceof Array?e[r+"_asArray"]=e[r]:e[r+"_asArray"]=[e[r]]}!(e[r]instanceof Array)&&t.arrayAccessFormPaths.length>0&&i(t.arrayAccessFormPaths,e,r,o)&&(e[r]=[e[r]])}function a(t){var e=t.split(/[-T:+Z]/g),r=new Date(e[0],e[1]-1,e[2]),o=e[5].split(".");if(r.setHours(e[3],e[4],o[0]),o.length>1&&r.setMilliseconds(o[1]),e[6]&&e[7]){var i=60*e[6]+Number(e[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(t)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==t.indexOf("Z",t.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function s(e,r,o){if(t.datetimeAccessFormPaths.length>0){var n=o.split(".#")[0];return i(t.datetimeAccessFormPaths,e,r,n)?a(e):e}return e}function c(e,r,o,n){return!(r==T.ELEMENT_NODE&&t.xmlElementsFilter.length>0)||i(t.xmlElementsFilter,e,o,n)}function l(r,o){if(r.nodeType==T.DOCUMENT_NODE){for(var i=new Object,a=r.childNodes,u=0;u<a.length;u++){if((d=a.item(u)).nodeType==T.ELEMENT_NODE)i[h=e(d)]=l(d,h)}return i}if(r.nodeType==T.ELEMENT_NODE){(i=new Object).__cnt=0;for(a=r.childNodes,u=0;u<a.length;u++){var d,h=e(d=a.item(u));if(d.nodeType!=T.COMMENT_NODE){var f=o+"."+h;c(i,d.nodeType,h,f)&&(i.__cnt++,null==i[h]?(i[h]=l(d,f),n(i,h,f)):(null!=i[h]&&(i[h]instanceof Array||(i[h]=[i[h]],n(i,h,f))),i[h][i[h].length]=l(d,f)))}}for(var p=0;p<r.attributes.length;p++){var g=r.attributes.item(p);i.__cnt++,i[t.attributePrefix+g.name]=g.value}var m=r.prefix;return null!=m&&""!=m&&(i.__cnt++,i.__prefix=m),null!=i["#text"]&&(i.__text=i["#text"],i.__text instanceof Array&&(i.__text=i.__text.join("\n")),t.stripWhitespaces&&(i.__text=i.__text.trim()),delete i["#text"],"property"==t.arrayAccessForm&&delete i["#text_asArray"],i.__text=s(i.__text,h,o+"."+h)),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],"property"==t.arrayAccessForm&&delete i["#cdata-section_asArray"]),0==i.__cnt&&"text"==t.emptyNodeForm?i="":1==i.__cnt&&null!=i.__text?i=i.__text:1!=i.__cnt||null==i.__cdata||t.keepCData?i.__cnt>1&&null!=i.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""==i.__text||""==i.__text.trim())&&delete i.__text:i=i.__cdata,delete i.__cnt,!t.enableToStringFunc||null==i.__text&&null==i.__cdata||(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}if(r.nodeType==T.TEXT_NODE||r.nodeType==T.CDATA_SECTION_NODE)return r.nodeValue}function u(e,o,i,n){var a="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+o;if(null!=i)for(var s=0;s<i.length;s++){var c=i[s],l=e[c];t.escapeMode&&(l=r(l)),a+=" "+c.substr(t.attributePrefix.length)+"=",t.useDoubleQuotes?a+='"'+l+'"':a+="'"+l+"'"}return a+(n?"/>":">")}function d(t,e){return"</"+(null!=t.__prefix?t.__prefix+":":"")+e+">"}function h(e,r){return!!("property"==t.arrayAccessForm&&function(t,e){return-1!==t.indexOf(e,t.length-e.length)}(r.toString(),"_asArray")||0==r.toString().indexOf(t.attributePrefix)||0==r.toString().indexOf("__")||e[r]instanceof Function)}function f(t){var e=0;if(t instanceof Object)for(var r in t)h(t,r)||e++;return e}function p(e,r,o){return 0==t.jsonPropertiesFilter.length||""==o||i(t.jsonPropertiesFilter,e,r,o)}function g(e){var r=[];if(e instanceof Object)for(var o in e)-1==o.toString().indexOf("__")&&0==o.toString().indexOf(t.attributePrefix)&&r.push(o);return r}function m(e){var o="";return e instanceof Object?o+=function(e){var o="";return null!=e.__cdata&&(o+="<![CDATA["+e.__cdata+"]]>"),null!=e.__text&&(t.escapeMode?o+=r(e.__text):o+=e.__text),o}(e):null!=e&&(t.escapeMode?o+=r(e):o+=e),o}function _(t,e){return""===t?e:t+"."+e}function y(t,e,r,o){var i="";if(0==t.length)i+=u(t,e,r,!0);else for(var n=0;n<t.length;n++)i+=u(t[n],e,g(t[n]),!1),i+=b(t[n],_(o,e)),i+=d(t[n],e);return i}function b(t,e){var r="";if(f(t)>0)for(var o in t)if(!h(t,o)&&(""==e||p(t,o,_(e,o)))){var i=t[o],n=g(i);if(null==i||null==i)r+=u(i,o,n,!0);else if(i instanceof Object)if(i instanceof Array)r+=y(i,o,n,e);else if(i instanceof Date)r+=u(i,o,n,!1),r+=i.toISOString(),r+=d(i,o);else{f(i)>0||null!=i.__text||null!=i.__cdata?(r+=u(i,o,n,!1),r+=b(i,_(e,o)),r+=d(i,o)):r+=u(i,o,n,!0)}else r+=u(i,o,n,!1),r+=m(i),r+=d(i,o)}return r+m(t)}void 0===(t=t||{}).escapeMode&&(t.escapeMode=!0),t.attributePrefix=t.attributePrefix||"_",t.arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[],void 0===t.useDoubleQuotes&&(t.useDoubleQuotes=!1),t.xmlElementsFilter=t.xmlElementsFilter||[],t.jsonPropertiesFilter=t.jsonPropertiesFilter||[],void 0===t.keepCData&&(t.keepCData=!1);var T={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(t){if(void 0===t)return null;var e;if(o){var r=new o,i=null;try{i=r.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(t){i=null}try{e=r.parseFromString(t,"text/xml"),null!=i&&e.getElementsByTagNameNS(i,"parsererror").length>0&&(e=null)}catch(t){e=null}}else 0==t.indexOf("<?")&&(t=t.substr(t.indexOf("?>")+2)),(e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t);return e},this.asArray=function(t){return void 0===t||null==t?[]:t instanceof Array?t:[t]},this.toXmlDateTime=function(t){return t instanceof Date?t.toISOString():"number"==typeof t?new Date(t).toISOString():null},this.asDateTime=function(t){return"string"==typeof t?a(t):t},this.xml2json=function(t){return l(t)},this.xml_str2json=function(t){var e=this.parseXmlString(t);return null!=e?this.xml2json(e):null},this.json2xml_str=function(t){return b(t,"")},this.json2xml=function(t){var e=this.json2xml_str(t);return this.parseXmlString(e)},this.getVersion=function(){return"1.2.0"}};t.exports=function(t){if(!t)return null;var e=(new o).parseFromString(t,"text/xml"),r=(new i).xml2json(e);return r.html&&r.getElementsByTagName("parsererror").length?null:r}},function(t,e,r){function o(t){this.options=t||{locator:{}}}function i(){this.cdata=!1}function n(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function a(t,e,r){return"string"==typeof t?t.substr(e,r):t.length>=e+r||e?new java.lang.String(t,e,r)+"":t}function s(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}o.prototype.parseFromString=function(t,e){var r=this.options,o=new c,n=r.domBuilder||new i,a=r.errorHandler,s=r.locator,l=r.xmlns||{},u={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&n.setDocumentLocator(s),o.errorHandler=function(t,e,r){function o(e){var o=t[e];!o&&a&&(o=2==t.length?function(r){t(e,r)}:t),n[e]=o&&function(t){o("[xmldom "+e+"]\t"+t+function(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}(r))}||function(){}}if(!t){if(e instanceof i)return e;t=e}var n={},a=t instanceof Function;return r=r||{},o("warning"),o("error"),o("fatalError"),n}(a,n,s),o.domBuilder=r.domBuilder||n,/\/x?html?$/.test(e)&&(u.nbsp=" ",u.copy="©",l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",t?o.parse(t,l,u):o.errorHandler.error("invalid doc source"),n.doc},i.prototype={startDocument:function(){this.doc=(new l).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,r,o){var i=this.doc,a=i.createElementNS(t,r||e),c=o.length;s(this,a),this.currentElement=a,this.locator&&n(this.locator,a);for(var l=0;l<c;l++){t=o.getURI(l);var u=o.getValue(l),d=(r=o.getQName(l),i.createAttributeNS(t,r));this.locator&&n(o.getLocator(l),d),d.value=d.nodeValue=u,a.setAttributeNode(d)}},endElement:function(t,e,r){var o=this.currentElement;o.tagName,this.currentElement=o.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var r=this.doc.createProcessingInstruction(t,e);this.locator&&n(this.locator,r),s(this,r)},ignorableWhitespace:function(t,e,r){},characters:function(t,e,r){if(t=a.apply(this,arguments)){if(this.cdata)var o=this.doc.createCDATASection(t);else o=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(o):/^\s*$/.test(t)&&this.doc.appendChild(o),this.locator&&n(this.locator,o)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,r){t=a.apply(this,arguments);var o=this.doc.createComment(t);this.locator&&n(this.locator,o),s(this,o)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,r){var o=this.doc.implementation;if(o&&o.createDocumentType){var i=o.createDocumentType(t,e,r);this.locator&&n(this.locator,i),s(this,i)}},warning:function(t){},error:function(t){},fatalError:function(t){throw t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){i.prototype[t]=function(){return null}});var c=r(12).XMLReader,l=e.DOMImplementation=r(1).DOMImplementation;e.XMLSerializer=r(1).XMLSerializer,e.DOMParser=o},function(t,e){function r(){}function o(t,e,r,o,l){function f(t){var e=t.slice(1,-1);return e in r?r[e]:"#"===e.charAt(0)?function(t){if(t>65535){var e=55296+((t-=65536)>>10),r=56320+(1023&t);return String.fromCharCode(e,r)}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(l.error("entity not found:"+t),t)}function p(e){if(e>C){var r=t.substring(C,e).replace(/&#?\w+;/g,f);b&&g(C),o.characters(r,0,e-C),C=e}}function g(e,r){for(;e>=_&&(r=y.exec(t));)m=r.index,_=m+r[0].length,b.lineNumber++;b.columnNumber=e-m+1}for(var m=0,_=0,y=/.*(?:\r\n?|\n)|.*$/g,b=o.locator,T=[{currentNSMap:e}],v={},C=0;;){try{var E=t.indexOf("<",C);if(E<0){if(!t.substr(C).match(/^\s*$/)){var S=o.doc,D=S.createTextNode(t.substr(C));S.appendChild(D),o.currentElement=D}return}switch(E>C&&p(E),t.charAt(E+1)){case"/":var A=t.indexOf(">",E+3),O=t.substring(E+2,A),x=T.pop();A<0?(O=t.substring(E+2).replace(/[\s<].*/,""),l.error("end tag name: "+O+" is not complete:"+x.tagName),A=E+1+O.length):O.match(/\s</)&&(O=O.replace(/[\s<].*/,""),l.error("end tag name: "+O+" maybe not complete"),A=E+1+O.length);var R=x.localNSMap,B=x.tagName==O;if(B||x.tagName&&x.tagName.toLowerCase()==O.toLowerCase()){if(o.endElement(x.uri,x.localName,O),R)for(var I in R)o.endPrefixMapping(I);B||l.fatalError("end tag name: "+O+" is not match the current start tagName:"+x.tagName)}else T.push(x);A++;break;case"?":b&&g(E),A=d(t,E,o);break;case"!":b&&g(E),A=u(t,E,o,l);break;default:b&&g(E);var P=new h,w=T[T.length-1].currentNSMap,N=(A=n(t,E,P,w,f,l),P.length);if(!P.closed&&c(t,A,P.tagName,v)&&(P.closed=!0,r.nbsp||l.warning("unclosed xml attribute")),b&&N){for(var L=i(b,{}),k=0;k<N;k++){var q=P[k];g(q.offset),q.locator=i(b,{})}o.locator=L,a(P,o,w)&&T.push(P),o.locator=b}else a(P,o,w)&&T.push(P);"http://www.w3.org/1999/xhtml"!==P.uri||P.closed?A++:A=s(t,A,P.tagName,f,o)}}catch(t){l.error("element parse error: "+t),A=-1}A>C?C=A:p(Math.max(E,C)+1)}}function i(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function n(t,e,r,o,i,n){for(var a,s=++e,c=_;;){var l=t.charAt(s);switch(l){case"=":if(c===y)a=t.slice(e,s),c=T;else{if(c!==b)throw new Error("attribute equal must after attrName");c=T}break;case"'":case'"':if(c===T||c===y){if(c===y&&(n.warning('attribute value must after "="'),a=t.slice(e,s)),e=s+1,!((s=t.indexOf(l,e))>0))throw new Error("attribute value no end '"+l+"' match");u=t.slice(e,s).replace(/&#?\w+;/g,i),r.add(a,u,e-1),c=C}else{if(c!=v)throw new Error('attribute value must after "="');u=t.slice(e,s).replace(/&#?\w+;/g,i),r.add(a,u,e),n.warning('attribute "'+a+'" missed start quot('+l+")!!"),e=s+1,c=C}break;case"/":switch(c){case _:r.setTagName(t.slice(e,s));case C:case E:case S:c=S,r.closed=!0;case v:case y:case b:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return n.error("unexpected end of input"),c==_&&r.setTagName(t.slice(e,s)),s;case">":switch(c){case _:r.setTagName(t.slice(e,s));case C:case E:case S:break;case v:case y:"/"===(u=t.slice(e,s)).slice(-1)&&(r.closed=!0,u=u.slice(0,-1));case b:c===b&&(u=a),c==v?(n.warning('attribute "'+u+'" missed quot(")!!'),r.add(a,u.replace(/&#?\w+;/g,i),e)):("http://www.w3.org/1999/xhtml"===o[""]&&u.match(/^(?:disabled|checked|selected)$/i)||n.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),r.add(u,u,e));break;case T:throw new Error("attribute value missed!!")}return s;case"":l=" ";default:if(l<=" ")switch(c){case _:r.setTagName(t.slice(e,s)),c=E;break;case y:a=t.slice(e,s),c=b;break;case v:var u=t.slice(e,s).replace(/&#?\w+;/g,i);n.warning('attribute "'+u+'" missed quot(")!!'),r.add(a,u,e);case C:c=E}else switch(c){case b:r.tagName,"http://www.w3.org/1999/xhtml"===o[""]&&a.match(/^(?:disabled|checked|selected)$/i)||n.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),r.add(a,a,e),e=s,c=y;break;case C:n.warning('attribute space is required"'+a+'"!!');case E:c=y,e=s;break;case T:c=v,e=s;break;case S:throw new Error("elements closed character '/' and '>' must be connected to")}}s++}}function a(t,e,r){for(var o=t.tagName,i=null,n=t.length;n--;){var a=t[n],s=a.qName,c=a.value;if((f=s.indexOf(":"))>0)var u=a.prefix=s.slice(0,f),d=s.slice(f+1),h="xmlns"===u&&d;else d=s,u=null,h="xmlns"===s&&"";a.localName=d,!1!==h&&(null==i&&(i={},l(r,r={})),r[h]=i[h]=c,a.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(h,c))}for(n=t.length;n--;){(u=(a=t[n]).prefix)&&("xml"===u&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(a.uri=r[u||""]))}var f;(f=o.indexOf(":"))>0?(u=t.prefix=o.slice(0,f),d=t.localName=o.slice(f+1)):(u=null,d=t.localName=o);var p=t.uri=r[u||""];if(e.startElement(p,d,o,t),!t.closed)return t.currentNSMap=r,t.localNSMap=i,!0;if(e.endElement(p,d,o),i)for(u in i)e.endPrefixMapping(u)}function s(t,e,r,o,i){if(/^(?:script|textarea)$/i.test(r)){var n=t.indexOf("</"+r+">",e),a=t.substring(e+1,n);if(/[&<]/.test(a))return/^script$/i.test(r)?(i.characters(a,0,a.length),n):(a=a.replace(/&#?\w+;/g,o),i.characters(a,0,a.length),n)}return e+1}function c(t,e,r,o){var i=o[r];return null==i&&((i=t.lastIndexOf("</"+r+">"))<e&&(i=t.lastIndexOf("</"+r)),o[r]=i),i<e}function l(t,e){for(var r in t)e[r]=t[r]}function u(t,e,r,o){switch(t.charAt(e+2)){case"-":return"-"===t.charAt(e+3)?(i=t.indexOf("--\x3e",e+4))>e?(r.comment(t,e+4,i-e-4),i+3):(o.error("Unclosed comment"),-1):-1;default:if("CDATA["==t.substr(e+3,6)){var i=t.indexOf("]]>",e+9);return r.startCDATA(),r.characters(t,e+9,i-e-9),r.endCDATA(),i+3}var n=function(t,e){var r,o=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=e,i.exec(t);r=i.exec(t);)if(o.push(r),r[1])return o}(t,e),a=n.length;if(a>1&&/!doctype/i.test(n[0][0])){var s=n[1][0],c=a>3&&/^public$/i.test(n[2][0])&&n[3][0],l=a>4&&n[4][0],u=n[a-1];return r.startDTD(s,c&&c.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),u.index+u[0].length}}return-1}function d(t,e,r){var o=t.indexOf("?>",e);if(o){var i=t.substring(e,o).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return i?(i[0].length,r.processingInstruction(i[1],i[2]),o+2):-1}return-1}function h(t){}function f(t,e){return t.__proto__=e,t}var p=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,g=new RegExp("[\\-\\.0-9"+p.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),m=new RegExp("^"+p.source+g.source+"*(?::"+p.source+g.source+"*)?$"),_=0,y=1,b=2,T=3,v=4,C=5,E=6,S=7;r.prototype={parse:function(t,e,r){var i=this.domBuilder;i.startDocument(),l(e,e={}),o(t,e,r,i,this.errorHandler),i.endDocument()}},h.prototype={setTagName:function(t){if(!m.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,r){if(!m.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:r}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},f({},f.prototype)instanceof f||(f=function(t,e){function r(){}for(e in r.prototype=e,r=new r,t)r[e]=t[e];return r}),e.XMLReader=r},function(t,e,r){function o(t,e){var r=t.Bucket,o=t.Region,i=t.Key,n=t.AbortArray,s=t.AsyncLimit||1,c=this,l=0,u=new Array(n.length);a.eachLimit(n,s,function(e,n){var a=l;if(i&&i!==e.Key)return u[a]={error:{KeyNotMatch:!0}},void n(null);var s=e.UploadId||e.UploadID;c.multipartAbort({Bucket:r,Region:o,Key:e.Key,Headers:t.Headers,UploadId:s},function(t,i){var c={Bucket:r,Region:o,Key:e.Key,UploadId:s};u[a]={error:t,task:c},n(null)}),l++},function(t){if(t)return e(t);for(var r=[],o=[],i=0,n=u.length;i<n;i++){var a=u[i];a.task&&(a.error?o.push(a.task):r.push(a.task))}return e(null,{successList:r,errorList:o})})}function i(t,e){var r=this,o=[],i={Bucket:t.Bucket,Region:t.Region,Prefix:t.Key},n=function(){r.multipartList(i,function(t,r){if(t)return e(t);o.push.apply(o,r.Upload||[]),"true"==r.IsTruncated?(i.KeyMarker=r.NextKeyMarker,i.UploadIdMarker=r.NextUploadIdMarker,n()):e(null,{UploadList:o})})};n()}function n(t,e){var r=t.TaskId,o=t.Bucket,i=t.Region,n=t.Key,s=t.CopySource,c=t.UploadId,l=1*t.PartNumber,u=t.CopySourceRange,d=this.options.ChunkRetryTimes+1,h=this;a.retry(d,function(e){h.uploadPartCopy({TaskId:r,Bucket:o,Region:i,Key:n,CopySource:s,UploadId:c,PartNumber:l,CopySourceRange:u,onProgress:t.onProgress},function(t,r){e(t||null,r)})},function(t,r){return e(t,r)})}var a=r(14),s=r(2).EventProxy,c=r(0),l={abortUploadTask:function(t,e){var r=t.Bucket,n=t.Region,a=t.Key,c=t.UploadId,l=t.Level||"task",u=t.AsyncLimit,d=this,h=new s;if(h.on("error",function(t){return e(t)}),h.on("get_abort_array",function(i){o.call(d,{Bucket:r,Region:n,Key:a,Headers:t.Headers,AsyncLimit:u,AbortArray:i},function(t,r){if(t)return e(t);e(null,r)})}),"bucket"===l)i.call(d,{Bucket:r,Region:n},function(t,r){if(t)return e(t);h.emit("get_abort_array",r.UploadList||[])});else if("file"===l){if(!a)return e({error:"abort_upload_task_no_key"});i.call(d,{Bucket:r,Region:n,Key:a},function(t,r){if(t)return e(t);h.emit("get_abort_array",r.UploadList||[])})}else{if("task"!==l)return e({error:"abort_unknown_level"});if(!c)return e({error:"abort_upload_task_no_id"});if(!a)return e({error:"abort_upload_task_no_key"});h.emit("get_abort_array",[{Key:a,UploadId:c}])}},sliceCopyFile:function(t,e){var r=new s,o=this,i=t.Bucket,l=t.Region,u=t.Key,d=t.CopySource,h=d.match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^\/]+\/(.+)$/);if(h){var f=h[1],p=h[3],g=decodeURIComponent(h[4]),m=void 0===t.SliceSize?o.options.CopySliceSize:t.SliceSize;m=Math.max(0,Math.min(m,5368709120));var _,y,b=t.ChunkSize||this.options.CopyChunkSize,T=this.options.CopyChunkParallelLimit,v=0;r.on("copy_slice_complete",function(t){o.multipartComplete({Bucket:i,Region:l,Key:u,UploadId:t.UploadId,Parts:t.PartList},function(t,r){if(t)return y(null,!0),e(t);y({loaded:_,total:_},!0),e(null,r)})}),r.on("get_copy_data_finish",function(t){a.eachLimit(t.PartList,T,function(e,r){var a=e.PartNumber,s=e.CopySourceRange,c=e.end-e.start,h=0;n.call(o,{Bucket:i,Region:l,Key:u,CopySource:d,UploadId:t.UploadId,PartNumber:a,CopySourceRange:s,onProgress:function(t){v+=t.loaded-h,h=t.loaded,y({loaded:v,total:_})}},function(t,o){if(t)return r(t);y({loaded:v,total:_}),v+=c-h,e.ETag=o.ETag,r(t||null,o)})},function(o){if(o)return y(null,!0),e(o);r.emit("copy_slice_complete",t)})}),r.on("get_file_size_finish",function(n){var a;!function(){for(var e=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,5120],r=1048576,i=0;i<e.length&&!(_/(r=1024*e[i]*1024)<=o.options.MaxPartNumber);i++);t.ChunkSize=b=Math.max(b,r);for(var n=Math.ceil(_/b),a=[],s=1;s<=n;s++){var c=(s-1)*b,l=s*b<_?s*b-1:_-1,u={PartNumber:s,start:c,end:l,CopySourceRange:"bytes="+c+"-"+l};a.push(u)}t.PartList=a}(),(a="Replaced"===t.Headers["x-cos-metadata-directive"]?t.Headers:n)["x-cos-storage-class"]=t.Headers["x-cos-storage-class"]||n["x-cos-storage-class"],a=c.clearKey(a),o.multipartInit({Bucket:i,Region:l,Key:u,Headers:a},function(o,i){if(o)return e(o);t.UploadId=i.UploadId,r.emit("get_copy_data_finish",t)})}),o.headObject({Bucket:f,Region:p,Key:g},function(i,n){if(i)e(i.statusCode&&404===i.statusCode?{ErrorStatus:g+" Not Exist"}:i);else if(void 0!==(_=t.FileSize=n.headers["content-length"])&&_)if(y=c.throttleOnProgress.call(o,_,t.onProgress),_<=m)t.Headers["x-cos-metadata-directive"]||(t.Headers["x-cos-metadata-directive"]="Copy"),o.putObjectCopy(t,function(t,r){if(t)return y(null,!0),e(t);y({loaded:_,total:_},!0),e(t,r)});else{var a=n.headers,s={"Cache-Control":a["cache-control"],"Content-Disposition":a["content-disposition"],"Content-Encoding":a["content-encoding"],"Content-Type":a["content-type"],Expires:a.expires,"x-cos-storage-class":a["x-cos-storage-class"]};c.each(a,function(t,e){0===e.indexOf("x-cos-meta-")&&e.length>"x-cos-meta-".length&&(s[e]=t)}),r.emit("get_file_size_finish",s)}else e({error:'get Content-Length error, please add "Content-Length" to CORS ExposeHeader setting.'})})}else e({error:"CopySource format error"})}};t.exports.init=function(t,e){c.each(l,function(e,r){t.prototype[r]=c.apiWrapper(r,e)})}},function(t,e){t.exports={eachLimit:function(t,e,r,o){if(o=o||function(){},!t.length||e<=0)return o();var i=0,n=0,a=0;!function s(){if(i>=t.length)return o();for(;a<e&&n<t.length;)a+=1,r(t[(n+=1)-1],function(e){e?(o(e),o=function(){}):(a-=1,(i+=1)>=t.length?o():s())})}()},retry:function(t,e,r){var o=function(i){e(function(e,n){e&&i<t?o(i+1):r(e,n)})};t<1?r():o(1)}}},function(t,e,r){"use strict";function o(t){var e={GrantFullControl:[],GrantWrite:[],GrantRead:[],GrantReadAcp:[],GrantWriteAcp:[],ACL:""},r={FULL_CONTROL:"GrantFullControl",WRITE:"GrantWrite",READ:"GrantRead",READ_ACP:"GrantReadAcp",WRITE_ACP:"GrantWriteAcp"},o=t.AccessControlList.Grant;o&&(o=l.isArray(o)?o:[o]);var n={READ:0,WRITE:0,FULL_CONTROL:0};return o.length&&l.each(o,function(o){"qcs::cam::anyone:anyone"===o.Grantee.ID||"http://cam.qcloud.com/groups/global/AllUsers"===o.Grantee.URI?n[o.Permission]=1:o.Grantee.ID!==t.Owner.ID&&e[r[o.Permission]].push('id="'+o.Grantee.ID+'"')}),n.FULL_CONTROL||n.WRITE&&n.READ?e.ACL="public-read-write":n.READ?e.ACL="public-read":e.ACL="private",l.each(r,function(t){e[t]=i(e[t].join(","))}),e}function i(t){var e,r,o=t.split(","),i={};for(e=0;e<o.length;)i[r=o[e].trim()]?o.splice(e,1):(i[r]=!0,o[e]=r,e++);return o.join(",")}function n(t){var e=t.bucket,r=e.substr(0,e.lastIndexOf("-")),o=e.substr(e.lastIndexOf("-")+1),i=t.domain,n=t.region,a=t.object;i||(i=["cn-south","cn-south-2","cn-north","cn-east","cn-southwest","sg"].indexOf(n)>-1?"{Region}.myqcloud.com":"cos.{Region}.myqcloud.com",t.ForcePathStyle||(i="{Bucket}."+i)),i=(i=i.replace(/\{\{AppId\}\}/gi,o).replace(/\{\{Bucket\}\}/gi,r).replace(/\{\{Region\}\}/gi,n).replace(/\{\{.*?\}\}/gi,"")).replace(/\{AppId\}/gi,o).replace(/\{BucketName\}/gi,r).replace(/\{Bucket\}/gi,e).replace(/\{Region\}/gi,n).replace(/\{.*?\}/gi,""),/^[a-zA-Z]+:\/\//.test(i)||(i="https://"+i),"/"===i.slice(-1)&&(i=i.slice(0,-1));var s=i;return t.ForcePathStyle&&(s+="/"+e),s+="/",a&&(s+=l.camSafeUrlEncode(a).replace(/%2F/g,"/")),t.isLocation&&(s=s.replace(/^https?:\/\//,"")),s}function a(t,e){var r=l.clone(t.Headers);delete r["Content-Type"],delete r["Cache-Control"],l.each(r,function(t,e){""===t&&delete r[e]});var o=function(t){var r=!1,o=t.Authorization;if(o)if(o.indexOf(" ")>-1)r=!1;else if(o.indexOf("q-sign-algorithm=")>-1&&o.indexOf("q-ak=")>-1&&o.indexOf("q-sign-time=")>-1&&o.indexOf("q-key-time=")>-1&&o.indexOf("q-url-param-list=")>-1)r=!0;else try{(o=atob(o)).indexOf("a=")>-1&&o.indexOf("k=")>-1&&o.indexOf("t=")>-1&&o.indexOf("r=")>-1&&o.indexOf("b=")>-1&&(r=!0)}catch(t){}r?e&&e(null,t):e&&e("authorization error")},i=this,n=t.Bucket||"",a=t.Region||"",s="name/cos:PostObject"!==t.Action&&t.Key?t.Key:"";i.options.ForcePathStyle&&n&&(s=n+"/"+s);var c="/"+s,u={},d=t.Scope;if(!d){var h=t.Action||"",f=t.ResourceKey||t.Key||"";d=t.Scope||[{action:h,bucket:n,region:a,prefix:f}]}var p=l.md5(JSON.stringify(d));i._StsCache=i._StsCache||[],function(){var t,e;for(t=i._StsCache.length-1;t>=0;t--){e=i._StsCache[t];var r=Math.round(l.getSkewTime(i.options.SystemClockOffset)/1e3)+30;if(e.StartTime&&r<e.StartTime||r>=e.ExpiredTime)i._StsCache.splice(t,1);else if(!e.ScopeLimit||e.ScopeLimit&&e.ScopeKey===p){u=e;break}}}();var g=function(){var e={Authorization:l.getAuth({SecretId:u.TmpSecretId,SecretKey:u.TmpSecretKey,Method:t.Method,Pathname:c,Query:t.Query,Headers:r,Expires:t.Expires,SystemClockOffset:i.options.SystemClockOffset}),XCosSecurityToken:u.XCosSecurityToken||"",Token:u.Token||"",ClientIP:u.ClientIP||"",ClientUA:u.ClientUA||""};o(e)};if(u.ExpiredTime&&u.ExpiredTime-l.getSkewTime(i.options.SystemClockOffset)/1e3>60)g();else if(i.options.getAuthorization)i.options.getAuthorization.call(i,{Bucket:n,Region:a,Method:t.Method,Key:s,Pathname:c,Query:t.Query,Headers:r,Scope:d},function(t){"string"==typeof t&&(t={Authorization:t}),t.TmpSecretId&&t.TmpSecretKey&&t.XCosSecurityToken&&t.ExpiredTime?((u=t||{}).Scope=d,u.ScopeKey=p,i._StsCache.push(u),g()):o(t)});else{if(!i.options.getSTS)return function(){var e={Authorization:l.getAuth({SecretId:t.SecretId||i.options.SecretId,SecretKey:t.SecretKey||i.options.SecretKey,Method:t.Method,Pathname:c,Query:t.Query,Headers:r,Expires:t.Expires,SystemClockOffset:i.options.SystemClockOffset}),XCosSecurityToken:i.options.XCosSecurityToken};return o(e),e}();i.options.getSTS.call(i,{Bucket:n,Region:a},function(t){(u=t||{}).Scope=d,u.ScopeKey=p,u.TmpSecretId=u.SecretId,u.TmpSecretKey=u.SecretKey,i._StsCache.push(u),g()})}return""}function s(t,e){var r=this;!t.headers&&(t.headers={}),!t.qs&&(t.qs={}),t.VersionId&&(t.qs.versionId=t.VersionId),t.qs=l.clearKey(t.qs),t.headers&&(t.headers=l.clearKey(t.headers)),t.qs&&(t.qs=l.clearKey(t.qs));var o=l.clone(t.qs);t.action&&(o[t.action]="");var i=function(s){var u=r.options.SystemClockOffset;a.call(r,{Bucket:t.Bucket||"",Region:t.Region||"",Method:t.method,Key:t.Key,Query:o,Headers:t.headers,Action:t.Action,ResourceKey:t.ResourceKey,Scope:t.Scope},function(o,a){t.AuthData=a,function(t,e){var r=this,o=t.TaskId;if(!o||r._isRunningTask(o)){var i=t.Bucket,a=t.Region,s=t.Key,u=t.method||"GET",d=t.url,h=t.body,f=t.json,p=t.rawBody;d=d||n({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:i,region:a,object:s}),t.action&&(d=d+"?"+t.action);var g={method:u,url:d,headers:t.headers,qs:t.qs,filePath:t.filePath,body:h,json:f};g.headers.Authorization=t.AuthData.Authorization,t.AuthData.Token&&(g.headers.token=t.AuthData.Token),t.AuthData.ClientIP&&(g.headers.clientIP=t.AuthData.ClientIP),t.AuthData.ClientUA&&(g.headers.clientUA=t.AuthData.ClientUA),t.AuthData.XCosSecurityToken&&(g.headers["x-cos-security-token"]=t.AuthData.XCosSecurityToken),g.headers&&(g.headers=l.clearKey(g.headers)),g=l.clearKey(g),t.onProgress&&"function"==typeof t.onProgress&&(g.onProgress=function(e){if(!o||r._isRunningTask(o)){var i=e?e.loaded:0;t.onProgress({loaded:i,total:e.total})}}),r.options.ForcePathStyle&&(g.pathStyle=r.options.ForcePathStyle);var m=c(g,function(t,i,n){var a,s=function(t,n){if(o&&r.off("inner-kill-task",_),!a){a=!0;var s={};i&&i.statusCode&&(s.statusCode=i.statusCode),i&&i.headers&&(s.headers=i.headers),t?(t=l.extend(t||{},s),e(t,null)):(n=l.extend(n||{},s),e(null,n))}};if(!t){var c;try{c=l.xml2json(n)||{}}catch(t){c=n||{}}var u=i.statusCode;return 2!==Math.floor(u/100)?void s({error:c.Error||c}):(p&&((c={}).body=n),c.Error?void s({error:c.Error}):void s(null,c))}s({error:t})}),_=function(t){t.TaskId===o&&(m&&m.abort&&m.abort(),r.off("inner-kill-task",_))};o&&r.on("inner-kill-task",_)}}.call(r,t,function(o,n){o&&s<2&&(u!==r.options.SystemClockOffset||function(t){var e=!1,r=!1,o=t.headers&&(t.headers.date||t.headers.Date)||"";try{var i=t.error.Code,n=t.error.Message;("RequestTimeTooSkewed"===i||"AccessDenied"===i&&"Request has expired"===n)&&(r=!0)}catch(t){}if(t)if(r&&o){var a=Date.parse(o);this.options.CorrectClockSkew&&Math.abs(l.getSkewTime(this.options.SystemClockOffset)-a)>=3e4&&(this.options.SystemClockOffset=a-Date.now(),e=!0)}else 5===Math.round(t.statusCode/100)&&(e=!0);return e}.call(r,o))?(t.headers&&(delete t.headers.Authorization,delete t.headers.token,delete t.headers.clientIP,delete t.headers.clientUA,delete t.headers["x-cos-security-token"]),i(s+1)):e(o,n)})})};i(0)}var c=r(9),l=r(0),u={getService:function(t,e){"function"==typeof t&&(e=t,t={});var r=this.options.ServiceDomain,o=t.AppId||this.options.appId;r?(r=r.replace(/\{\{AppId\}\}/gi,o||"").replace(/\{\{.*?\}\}/gi,""),/^[a-zA-Z]+:\/\//.test(r)||(r="https://"+r),"/"===r.slice(-1)&&(r=r.slice(0,-1))):r="https://service.cos.myqcloud.com",s.call(this,{Action:"name/cos:GetService",url:r+"/",method:"GET"},function(t,r){if(t)return e(t);var o=r&&r.ListAllMyBucketsResult&&r.ListAllMyBucketsResult.Buckets&&r.ListAllMyBucketsResult.Buckets.Bucket||[];o=l.isArray(o)?o:[o],e(null,{Buckets:o,statusCode:r.statusCode,headers:r.headers})})},putBucket:function(t,e){var r=this,o={};o["x-cos-acl"]=t.ACL,o["x-cos-grant-read"]=t.GrantRead,o["x-cos-grant-write"]=t.GrantWrite,o["x-cos-grant-read-acp"]=t.GrantReadAcp,o["x-cos-grant-write-acp"]=t.GrantWriteAcp,o["x-cos-grant-full-control"]=t.GrantFullControl,s.call(this,{Action:"name/cos:PutBucket",method:"PUT",Bucket:t.Bucket,Region:t.Region,headers:o},function(o,i){if(o)return e(o);var a=n({domain:r.options.Domain,bucket:t.Bucket,region:t.Region,isLocation:!0});e(null,{Location:a,statusCode:i.statusCode,headers:i.headers})})},getBucket:function(t,e){var r={};r.prefix=t.Prefix||"",r.delimiter=t.Delimiter,r.marker=t.Marker,r["max-keys"]=t.MaxKeys,r["encoding-type"]=t.EncodingType,s.call(this,{Action:"name/cos:GetBucket",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);var o=r.ListBucketResult||{},i=o.Contents||[],n=o.CommonPrefixes||[];i=l.isArray(i)?i:[i],n=l.isArray(n)?n:[n];var a=l.clone(o);l.extend(a,{Contents:i,CommonPrefixes:n,statusCode:r.statusCode,headers:r.headers}),e(null,a)})},headBucket:function(t,e){s.call(this,{Action:"name/cos:HeadBucket",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,method:"HEAD"},function(t,r){e(t,r)})},deleteBucket:function(t,e){s.call(this,{Action:"name/cos:DeleteBucket",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,method:"DELETE"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketAcl:function(t,e){s.call(this,{Action:"name/cos:GetBucketACL",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"acl"},function(t,r){if(t)return e(t);var i=r.AccessControlPolicy||{},n=i.Owner||{},a=i.AccessControlList.Grant||[];a=l.isArray(a)?a:[a];var s=o(i);r.headers&&r.headers["x-cos-acl"]&&(s.ACL=r.headers["x-cos-acl"]),s=l.extend(s,{Owner:n,Grants:a,statusCode:r.statusCode,headers:r.headers}),e(null,s)})},putBucketAcl:function(t,e){var r=t.Headers,o="";if(t.AccessControlPolicy){var n=l.clone(t.AccessControlPolicy||{}),a=n.Grants||n.Grant;a=l.isArray(a)?a:[a],delete n.Grant,delete n.Grants,n.AccessControlList={Grant:a},o=l.json2xml({AccessControlPolicy:n}),r["Content-Type"]="application/xml",r["Content-MD5"]=l.binaryBase64(l.md5(o))}l.each(r,function(t,e){0===e.indexOf("x-cos-grant-")&&(r[e]=i(r[e]))}),s.call(this,{Action:"name/cos:PutBucketACL",method:"PUT",Bucket:t.Bucket,Region:t.Region,headers:r,action:"acl",body:o},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketCors:function(t,e){s.call(this,{Action:"name/cos:GetBucketCORS",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"cors"},function(t,r){if(t)if(404===t.statusCode&&t.error&&"NoSuchCORSConfiguration"===t.error.Code){var o={CORSRules:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else e(t);else{var i=r.CORSConfiguration||{},n=i.CORSRules||i.CORSRule||[];n=l.clone(l.isArray(n)?n:[n]),l.each(n,function(t){l.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],function(e,r){var o=e+"s",i=t[o]||t[e]||[];delete t[e],t[o]=l.isArray(i)?i:[i]})}),e(null,{CORSRules:n,statusCode:r.statusCode,headers:r.headers})}})},putBucketCors:function(t,e){var r=(t.CORSConfiguration||{}).CORSRules||t.CORSRules||[];r=l.clone(l.isArray(r)?r:[r]),l.each(r,function(t){l.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],function(e,r){var o=e+"s",i=t[o]||t[e]||[];delete t[o],t[e]=l.isArray(i)?i:[i]})});var o=l.json2xml({CORSConfiguration:{CORSRule:r}}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=l.binaryBase64(l.md5(o)),s.call(this,{Action:"name/cos:PutBucketCORS",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"cors",headers:i},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketCors:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketCORS",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"cors"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode||t.statusCode,headers:r.headers})})},getBucketLocation:function(t,e){s.call(this,{Action:"name/cos:GetBucketLocation",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"location"},function(t,r){if(t)return e(t);e(null,r)})},putBucketTagging:function(t,e){var r=t.Tagging||{},o=r.TagSet||r.Tags||t.Tags||[];o=l.clone(l.isArray(o)?o:[o]);var i=l.json2xml({Tagging:{TagSet:{Tag:o}}}),n=t.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=l.binaryBase64(l.md5(i)),s.call(this,{Action:"name/cos:PutBucketTagging",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:i,action:"tagging",headers:n},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketTagging:function(t,e){s.call(this,{Action:"name/cos:GetBucketTagging",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"tagging"},function(t,r){if(t)if(404!==t.statusCode||!t.error||"Not Found"!==t.error&&"NoSuchTagSet"!==t.error.Code)e(t);else{var o={Tags:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else{var i=[];try{i=r.Tagging.TagSet.Tag||[]}catch(t){}i=l.clone(l.isArray(i)?i:[i]),e(null,{Tags:i,statusCode:r.statusCode,headers:r.headers})}})},deleteBucketTagging:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketTagging",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"tagging"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketPolicy:function(t,e){s.call(this,{Action:"name/cos:GetBucketPolicy",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"policy",rawBody:!0},function(t,r){if(t)return e(t.statusCode&&403===t.statusCode?{ErrorStatus:"Access Denied"}:t.statusCode&&405===t.statusCode?{ErrorStatus:"Method Not Allowed"}:t.statusCode&&404===t.statusCode?{ErrorStatus:"Policy Not Found"}:t);var o={};try{o=JSON.parse(r.body)}catch(t){}e(null,{Policy:o,statusCode:r.statusCode,headers:r.headers})})},putBucketPolicy:function(t,e){var r=t.Policy,o=r;try{"string"==typeof r?r=JSON.parse(o):o=JSON.stringify(r)}catch(t){e({error:"Policy format error"})}var i=t.Headers;i["Content-Type"]="application/json",i["Content-MD5"]=l.binaryBase64(l.md5(o)),s.call(this,{Action:"name/cos:PutBucketPolicy",method:"PUT",Bucket:t.Bucket,Region:t.Region,action:"policy",body:l.isBrowser?o:r,headers:i,json:!0},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketPolicy:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketPolicy",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"policy"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode||t.statusCode,headers:r.headers})})},getBucketLifecycle:function(t,e){s.call(this,{Action:"name/cos:GetBucketLifecycle",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"lifecycle"},function(t,r){if(t)if(404===t.statusCode&&t.error&&"NoSuchLifecycleConfiguration"===t.error.Code){var o={Rules:[],statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else e(t);else{var i=[];try{i=r.LifecycleConfiguration.Rule||[]}catch(t){}i=l.clone(l.isArray(i)?i:[i]),e(null,{Rules:i,statusCode:r.statusCode,headers:r.headers})}})},putBucketLifecycle:function(t,e){var r=(t.LifecycleConfiguration||{}).Rules||[];r=l.clone(r);var o=l.json2xml({LifecycleConfiguration:{Rule:r}}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=l.binaryBase64(l.md5(o)),s.call(this,{Action:"name/cos:PutBucketLifecycle",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"lifecycle",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},deleteBucketLifecycle:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketLifecycle",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"lifecycle"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},putBucketVersioning:function(t,e){if(t.VersioningConfiguration){var r=t.VersioningConfiguration||{},o=l.json2xml({VersioningConfiguration:r}),i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=l.binaryBase64(l.md5(o)),s.call(this,{Action:"name/cos:PutBucketVersioning",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"versioning",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})}else e({error:"missing param VersioningConfiguration"})},getBucketVersioning:function(t,e){s.call(this,{Action:"name/cos:GetBucketVersioning",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"versioning"},function(t,r){t||!r.VersioningConfiguration&&(r.VersioningConfiguration={}),e(t,r)})},putBucketReplication:function(t,e){var r=l.clone(t.ReplicationConfiguration),o=l.json2xml({ReplicationConfiguration:r});o=(o=o.replace(/<(\/?)Rules>/gi,"<$1Rule>")).replace(/<(\/?)Tags>/gi,"<$1Tag>");var i=t.Headers;i["Content-Type"]="application/xml",i["Content-MD5"]=l.binaryBase64(l.md5(o)),s.call(this,{Action:"name/cos:PutBucketReplication",method:"PUT",Bucket:t.Bucket,Region:t.Region,body:o,action:"replication",headers:i},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getBucketReplication:function(t,e){s.call(this,{Action:"name/cos:GetBucketReplication",method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"replication"},function(t,r){if(t)if(404!==t.statusCode||!t.error||"Not Found"!==t.error&&"ReplicationConfigurationnotFoundError"!==t.error.Code)e(t);else{var o={ReplicationConfiguration:{Rules:[]},statusCode:t.statusCode};t.headers&&(o.headers=t.headers),e(null,o)}else t||!r.ReplicationConfiguration&&(r.ReplicationConfiguration={}),r.ReplicationConfiguration.Rule&&(r.ReplicationConfiguration.Rules=r.ReplicationConfiguration.Rule,delete r.ReplicationConfiguration.Rule),e(t,r)})},deleteBucketReplication:function(t,e){s.call(this,{Action:"name/cos:DeleteBucketReplication",method:"DELETE",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,action:"replication"},function(t,r){return t&&204===t.statusCode?e(null,{statusCode:t.statusCode}):t?e(t):void e(null,{statusCode:r.statusCode,headers:r.headers})})},getObject:function(t,e){var r={};r["response-content-type"]=t.ResponseContentType,r["response-content-language"]=t.ResponseContentLanguage,r["response-expires"]=t.ResponseExpires,r["response-cache-control"]=t.ResponseCacheControl,r["response-content-disposition"]=t.ResponseContentDisposition,r["response-content-encoding"]=t.ResponseContentEncoding,s.call(this,{Action:"name/cos:GetObject",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers,qs:r,rawBody:!0},function(r,o){if(r){var i=r.statusCode;return t.Headers["If-Modified-Since"]&&i&&304===i?e(null,{NotModified:!0}):e(r)}var n={};n.Body=o.body,o.headers&&o.headers.etag&&(n.ETag=o.headers&&o.headers.etag),l.extend(n,{statusCode:o.statusCode,headers:o.headers}),e(null,n)})},headObject:function(t,e){s.call(this,{Action:"name/cos:HeadObject",method:"HEAD",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers},function(r,o){if(r){var i=r.statusCode;return t.Headers["If-Modified-Since"]&&i&&304===i?e(null,{NotModified:!0,statusCode:i}):e(r)}o.headers&&o.headers.etag&&(o.ETag=o.headers&&o.headers.etag),e(null,o)})},listObjectVersions:function(t,e){var r={};r.prefix=t.Prefix||"",r.delimiter=t.Delimiter,r["key-marker"]=t.KeyMarker,r["version-id-marker"]=t.VersionIdMarker,r["max-keys"]=t.MaxKeys,r["encoding-type"]=t.EncodingType,s.call(this,{Action:"name/cos:GetBucketObjectVersions",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r,action:"versions"},function(t,r){if(t)return e(t);var o=r.ListVersionsResult||{},i=o.DeleteMarker||[];i=l.isArray(i)?i:[i];var n=o.Version||[];n=l.isArray(n)?n:[n];var a=l.clone(o);delete a.DeleteMarker,delete a.Version,l.extend(a,{DeleteMarkers:i,Versions:n,statusCode:r.statusCode,headers:r.headers}),e(null,a)})},putObject:function(t,e){var r=this,o=t.ContentLength,i=l.throttleOnProgress.call(r,o,t.onProgress);l.getBodyMd5(r.options.UploadCheckContentMd5,t.Body,function(a){a&&(t.Headers["Content-MD5"]=l.binaryBase64(a)),void 0!==t.ContentLength&&(t.Headers["Content-Length"]=t.ContentLength),s.call(r,{Action:"name/cos:PutObject",TaskId:t.TaskId,method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,body:t.Body,onProgress:i},function(a,s){if(a)return i(null,!0),e(a);if(i({loaded:o,total:o},!0),s&&s.headers&&s.headers.etag){var c=n({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key});return c=c.substr(c.indexOf("://")+3),e(null,{Location:c,ETag:s.headers.etag,statusCode:s.statusCode,headers:s.headers})}e(null,s)})})},postObject:function(t,e){var r=this,o={};o["Cache-Control"]=t.CacheControl,o["Content-Disposition"]=t.ContentDisposition,o["Content-Encoding"]=t.ContentEncoding,o["Content-MD5"]=t.ContentMD5,o["Content-Length"]=t.ContentLength,o["Content-Type"]=t.ContentType,o.Expect=t.Expect,o.Expires=t.Expires,o["x-cos-acl"]=t.ACL,o["x-cos-grant-read"]=t.GrantRead,o["x-cos-grant-write"]=t.GrantWrite,o["x-cos-grant-full-control"]=t.GrantFullControl,o["x-cos-storage-class"]=t.StorageClass;var i=t.FilePath;for(var a in t)a.indexOf("x-cos-meta-")>-1&&(o[a]=t[a]);var c=l.throttleOnProgress.call(r,o["Content-Length"],t.onProgress);s.call(this,{Action:"name/cos:PostObject",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:o,filePath:i,onProgress:c},function(o,i){if(c(null,!0),o)return e(o);if(i){var a=n({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key,isLocation:!0});return e(null,{Location:a,statusCode:i.statusCode})}e(null,i)})},deleteObject:function(t,e){s.call(this,{Action:"name/cos:DeleteObject",method:"DELETE",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,VersionId:t.VersionId},function(t,r){if(t){var o=t.statusCode;return o&&204===o?e(null,{statusCode:o}):o&&404===o?e(null,{BucketNotFound:!0,statusCode:o}):e(t)}e(null,{statusCode:r.statusCode,headers:r.headers})})},getObjectAcl:function(t,e){s.call(this,{Action:"name/cos:GetObjectACL",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,action:"acl"},function(t,r){if(t)return e(t);var i=r.AccessControlPolicy||{},n=i.Owner||{},a=i.AccessControlList&&i.AccessControlList.Grant||[];a=l.isArray(a)?a:[a];var s=o(i);r.headers&&r.headers["x-cos-acl"]&&(s.ACL=r.headers["x-cos-acl"]),s=l.extend(s,{Owner:n,Grants:a,statusCode:r.statusCode,headers:r.headers}),e(null,s)})},putObjectAcl:function(t,e){var r=t.Headers,o="";if(t.AccessControlPolicy){var n=l.clone(t.AccessControlPolicy||{}),a=n.Grants||n.Grant;a=l.isArray(a)?a:[a],delete n.Grant,delete n.Grants,n.AccessControlList={Grant:a},o=l.json2xml({AccessControlPolicy:n}),r["Content-Type"]="application/xml",r["Content-MD5"]=l.binaryBase64(l.md5(o))}l.each(r,function(t,e){0===e.indexOf("x-cos-grant-")&&(r[e]=i(r[e]))}),s.call(this,{Action:"name/cos:PutObjectACL",method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,action:"acl",headers:r,body:o},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},optionsObject:function(t,e){var r=t.Headers;r.Origin=t.Origin,r["Access-Control-Request-Method"]=t.AccessControlRequestMethod,r["Access-Control-Request-Headers"]=t.AccessControlRequestHeaders,s.call(this,{Action:"name/cos:OptionsObject",method:"OPTIONS",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:r},function(t,r){if(t)return t.statusCode&&403===t.statusCode?e(null,{OptionsForbidden:!0,statusCode:t.statusCode}):e(t);var o=r.headers||{};e(null,{AccessControlAllowOrigin:o["access-control-allow-origin"],AccessControlAllowMethods:o["access-control-allow-methods"],AccessControlAllowHeaders:o["access-control-allow-headers"],AccessControlExposeHeaders:o["access-control-expose-headers"],AccessControlMaxAge:o["access-control-max-age"],statusCode:r.statusCode,headers:r.headers})})},putObjectCopy:function(t,e){var r=(t.CopySource||"").match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^\/]+\/(.+)$/);if(r){var o=r[1],i=r[3],n=decodeURIComponent(r[4]);s.call(this,{Scope:[{action:"name/cos:GetObject",bucket:o,region:i,prefix:n},{action:"name/cos:PutObject",bucket:t.Bucket,region:t.Region,prefix:t.Key}],method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,headers:t.Headers},function(t,r){if(t)return e(t);var o=l.clone(r.CopyObjectResult||{});l.extend(o,{statusCode:r.statusCode,headers:r.headers}),e(null,o)})}else e({error:"CopySource format error"})},deleteMultipleObject:function(t,e){var r=t.Objects||[],o=t.Quiet;r=l.isArray(r)?r:[r];var i=l.json2xml({Delete:{Object:r,Quiet:o||!1}}),n=t.Headers;n["Content-Type"]="application/xml",n["Content-MD5"]=l.binaryBase64(l.md5(i));var a=l.map(r,function(e){return{action:"name/cos:DeleteObject",bucket:t.Bucket,region:t.Region,prefix:e.Key}});s.call(this,{Scope:a,method:"POST",Bucket:t.Bucket,Region:t.Region,body:i,action:"delete",headers:n},function(t,r){if(t)return e(t);var o=r.DeleteResult||{},i=o.Deleted||[],n=o.Error||[];i=l.isArray(i)?i:[i],n=l.isArray(n)?n:[n];var a=l.clone(o);l.extend(a,{Error:n,Deleted:i,statusCode:r.statusCode,headers:r.headers}),e(null,a)})},restoreObject:function(t,e){var r=t.Headers;if(t.RestoreRequest){var o=t.RestoreRequest||{},i=l.json2xml({RestoreRequest:o});r["Content-Type"]="application/xml",r["Content-MD5"]=l.binaryBase64(l.md5(i)),s.call(this,{Action:"name/cos:RestoreObject",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,body:i,action:"restore",headers:r},function(t,r){e(t,r)})}else e({error:"missing param RestoreRequest"})},uploadPartCopy:function(t,e){var r=(t.CopySource||"").match(/^([^.]+-\d+)\.cos(v6)?\.([^.]+)\.[^\/]+\/(.+)$/);if(r){var o=r[1],i=r[3],n=decodeURIComponent(r[4]);s.call(this,{Scope:[{action:"name/cos:GetObject",bucket:o,region:i,prefix:n},{action:"name/cos:PutObject",bucket:t.Bucket,region:t.Region,prefix:t.Key}],method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,VersionId:t.VersionId,qs:{partNumber:t.PartNumber,uploadId:t.UploadId},headers:t.Headers},function(t,r){if(t)return e(t);var o=l.clone(r.CopyPartResult||{});l.extend(o,{statusCode:r.statusCode,headers:r.headers}),e(null,o)})}else e({error:"CopySource format error"})},multipartInit:function(t,e){s.call(this,{Action:"name/cos:InitiateMultipartUpload",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,action:"uploads",headers:t.Headers},function(t,r){return t?e(t):(r=l.clone(r||{}))&&r.InitiateMultipartUploadResult?e(null,l.extend(r.InitiateMultipartUploadResult,{statusCode:r.statusCode,headers:r.headers})):void e(null,r)})},multipartUpload:function(t,e){var r=this;l.getFileSize("multipartUpload",t,function(){l.getBodyMd5(r.options.UploadCheckContentMd5,t.Body,function(o){o&&(t.Headers["Content-MD5"]=l.binaryBase64(o)),s.call(r,{Action:"name/cos:UploadPart",TaskId:t.TaskId,method:"PUT",Bucket:t.Bucket,Region:t.Region,Key:t.Key,qs:{partNumber:t.PartNumber,uploadId:t.UploadId},headers:t.Headers,onProgress:t.onProgress,body:t.Body||null},function(t,r){if(t)return e(t);r.headers=r.headers||{},e(null,{ETag:r.headers.etag||"",statusCode:r.statusCode,headers:r.headers})})})})},multipartComplete:function(t,e){for(var r=this,o=t.UploadId,i=t.Parts,a=0,c=i.length;a<c;a++)0!==i[a].ETag.indexOf('"')&&(i[a].ETag='"'+i[a].ETag+'"');var u=l.json2xml({CompleteMultipartUpload:{Part:i}}),d=t.Headers;d["Content-Type"]="application/xml",d["Content-MD5"]=l.binaryBase64(l.md5(u)),s.call(this,{Action:"name/cos:CompleteMultipartUpload",method:"POST",Bucket:t.Bucket,Region:t.Region,Key:t.Key,qs:{uploadId:o},body:u,headers:d},function(o,i){if(o)return e(o);var a=n({ForcePathStyle:r.options.ForcePathStyle,protocol:r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key,isLocation:!0}),s=i.CompleteMultipartUploadResult||{},c=l.extend(s,{Location:a,statusCode:i.statusCode,headers:i.headers});e(null,c)})},multipartList:function(t,e){var r={};r.delimiter=t.Delimiter,r["encoding-type"]=t.EncodingType,r.prefix=t.Prefix||"",r["max-uploads"]=t.MaxUploads,r["key-marker"]=t.KeyMarker,r["upload-id-marker"]=t.UploadIdMarker,r=l.clearKey(r),s.call(this,{Action:"name/cos:ListMultipartUploads",ResourceKey:r.prefix,method:"GET",Bucket:t.Bucket,Region:t.Region,headers:t.Headers,qs:r,action:"uploads"},function(t,r){if(t)return e(t);if(r&&r.ListMultipartUploadsResult){var o=r.ListMultipartUploadsResult.Upload||[],i=r.ListMultipartUploadsResult.CommonPrefixes||[];i=l.isArray(i)?i:[i],o=l.isArray(o)?o:[o],r.ListMultipartUploadsResult.Upload=o,r.ListMultipartUploadsResult.CommonPrefixes=i}var n=l.clone(r.ListMultipartUploadsResult||{});l.extend(n,{statusCode:r.statusCode,headers:r.headers}),e(null,n)})},multipartListPart:function(t,e){var r={};r.uploadId=t.UploadId,r["encoding-type"]=t.EncodingType,r["max-parts"]=t.MaxParts,r["part-number-marker"]=t.PartNumberMarker,s.call(this,{Action:"name/cos:ListParts",method:"GET",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);var o=r.ListPartsResult||{},i=o.Part||[];i=l.isArray(i)?i:[i],o.Part=i;var n=l.clone(o);l.extend(n,{statusCode:r.statusCode,headers:r.headers}),e(null,n)})},multipartAbort:function(t,e){var r={};r.uploadId=t.UploadId,s.call(this,{Action:"name/cos:AbortMultipartUpload",method:"DELETE",Bucket:t.Bucket,Region:t.Region,Key:t.Key,headers:t.Headers,qs:r},function(t,r){if(t)return e(t);e(null,{statusCode:r.statusCode,headers:r.headers})})},getObjectUrl:function(t,e){var r=this,o=n({ForcePathStyle:r.options.ForcePathStyle,protocol:t.Protocol||r.options.Protocol,domain:r.options.Domain,bucket:t.Bucket,region:t.Region,object:t.Key});if(void 0!==t.Sign&&!t.Sign)return e(null,{Url:o}),o;var i=a.call(this,{Action:"PUT"===(t.Method||"").toUpperCase()?"name/cos:PutObject":"name/cos:GetObject",Bucket:t.Bucket||"",Region:t.Region||"",Method:t.Method||"get",Key:t.Key,Expires:t.Expires},function(t,r){if(e){if(t)return void e(t);var i=o;i+="?"+(r.Authorization.indexOf("q-signature")>-1?r.Authorization:"sign="+encodeURIComponent(r.Authorization)),r.XCosSecurityToken&&(i+="&x-cos-security-token="+r.XCosSecurityToken),r.ClientIP&&(i+="&clientIP="+r.ClientIP),r.ClientUA&&(i+="&clientUA="+r.ClientUA),r.Token&&(i+="&token="+r.Token),setTimeout(function(){e(null,{Url:i})})}});return i?o+"?"+i.Authorization+(i.XCosSecurityToken?"&x-cos-security-token="+i.XCosSecurityToken:""):o},getAuth:function(t){return l.getAuth({SecretId:t.SecretId||this.options.SecretId||"",SecretKey:t.SecretKey||this.options.SecretKey||"",Method:t.Method,Key:t.Key,Query:t.Query,Headers:t.Headers,Expires:t.Expires,SystemClockOffset:this.options.SystemClockOffset})}};t.exports.init=function(t,e){e.transferToTaskMethod(u,"postObject"),l.each(u,function(e,r){t.prototype[r]=l.apiWrapper(r,e)})}},function(t,e,r){var o=r(0),i={};t.exports.transferToTaskMethod=function(t,e){i[e]=t[e],t[e]=function(t,r){t.SkipTask?i[e].call(this,t,r):this._addTask(e,t,r)}},t.exports.init=function(t){var e=[],r={},n=0,a=0,s=function(t){var e={id:t.id,Bucket:t.Bucket,Region:t.Region,Key:t.Key,FilePath:t.FilePath,state:t.state,loaded:t.loaded,size:t.size,speed:t.speed,percent:t.percent,hashPercent:t.hashPercent,error:t.error};return t.FilePath&&(e.FilePath=t.FilePath),e},c=function(){t.emit("list-update",{list:o.map(e,s)})},l=function(){var r;if(e.length>t.options.UploadQueueSize)for(r=0;r<e.length&&e.length>t.options.UploadQueueSize&&r<a;r++)e[r]&&"waiting"===e[r].state||(e.splice(r,1),a--)},u=function(){if(a<e.length&&n<t.options.FileParallelLimit){var r=e[a];if("waiting"===r.state){n++,r.state="checking";var s=o.formatParams(r.api,r.params);i[r.api].call(t,s,function(e,o){t._isRunningTask(r.id)&&("checking"!==r.state&&"uploading"!==r.state||(r.state=e?"error":"success",e&&(r.error=e),n--,c(),u(t),r.callback&&r.callback(e,o),"success"===r.state&&(r.params&&(delete r.params.Body,delete r.params),delete r.callback)),l())}),c()}a++,u(t)}},d=function(e,o){var i=r[e];if(i){var a=i&&"waiting"===i.state,s=i&&("checking"===i.state||"uploading"===i.state);if("canceled"===o&&"canceled"!==i.state||"paused"===o&&a||"paused"===o&&s){if("paused"===o&&i.params.Body&&"function"==typeof i.params.Body.pipe)return;i.state=o,t.emit("inner-kill-task",{TaskId:e,toState:o}),c(),s&&(n--,u(t)),"canceled"===o&&(i.params&&(delete i.params.Body,delete i.params),delete i.callback)}l()}};t._addTasks=function(e){o.each(e,function(e){t._addTask(e.api,e.params,e.callback,!0)}),c()},t._addTask=function(i,n,a,s){n=o.formatParams(i,n);var d=o.uuid();n.TaskId=d,n.TaskReady&&n.TaskReady(d);var h={params:n,callback:a,api:i,index:e.length,id:d,Bucket:n.Bucket,Region:n.Region,Key:n.Key,FilePath:n.FilePath||"",state:"waiting",loaded:0,size:0,speed:0,percent:0,hashPercent:0,error:null},f=n.onHashProgress;n.onHashProgress=function(e){t._isRunningTask(h.id)&&(h.hashPercent=e.percent,f&&f(e),c())};var p=n.onProgress;return n.onProgress=function(e){t._isRunningTask(h.id)&&("checking"===h.state&&(h.state="uploading"),h.loaded=e.loaded,h.size=e.total,h.speed=e.speed,h.percent=e.percent,p&&p(e),c())},r[d]=h,e.push(h),h.size=n.FileSize,!s&&c(),u(t),l(),d},t._isRunningTask=function(t){var e=r[t];return!(!e||"checking"!==e.state&&"uploading"!==e.state)},t.getTaskList=function(){return o.map(e,s)},t.cancelTask=function(t){d(t,"canceled")},t.pauseTask=function(t){d(t,"paused")},t.restartTask=function(t){var e=r[t];!e||"paused"!==e.state&&"error"!==e.state||(e.state="waiting",c(),a=Math.min(a,e.index),u())}}}])},function(t,e){t.exports=o;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function o(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function i(t){return!0===(t&&t.__isLong__)}o.prototype.__isLong__,Object.defineProperty(o.prototype,"__isLong__",{value:!0}),o.isLong=i;var n={},a={};function s(t,e){var r,o,i;return e?(i=0<=(t>>>=0)&&t<256)&&(o=a[t])?o:(r=l(t,(0|t)<0?-1:0,!0),i&&(a[t]=r),r):(i=-128<=(t|=0)&&t<128)&&(o=n[t])?o:(r=l(t,t<0?-1:0,!1),i&&(n[t]=r),r)}function c(t,e){if(isNaN(t))return e?y:_;if(e){if(t<0)return y;if(t>=p)return E}else{if(t<=-g)return S;if(t+1>=g)return C}return t<0?c(-t,e).neg():l(t%f|0,t/f|0,e)}function l(t,e,r){return new o(t,e,r)}o.fromInt=s,o.fromNumber=c,o.fromBits=l;var u=Math.pow;function d(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return _;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var o;if((o=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===o)return d(t.substring(1),e,r).neg();for(var i=c(u(r,8)),n=_,a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a),l=parseInt(t.substring(a,a+s),r);if(s<8){var h=c(u(r,s));n=n.mul(h).add(c(l))}else n=(n=n.mul(i)).add(c(l))}return n.unsigned=e,n}function h(t,e){return"number"==typeof t?c(t,e):"string"==typeof t?d(t,e):l(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}o.fromString=d,o.fromValue=h;var f=4294967296,p=f*f,g=p/2,m=s(1<<24),_=s(0);o.ZERO=_;var y=s(0,!0);o.UZERO=y;var b=s(1);o.ONE=b;var T=s(1,!0);o.UONE=T;var v=s(-1);o.NEG_ONE=v;var C=l(-1,2147483647,!1);o.MAX_VALUE=C;var E=l(-1,-1,!0);o.MAX_UNSIGNED_VALUE=E;var S=l(0,-2147483648,!1);o.MIN_VALUE=S;var D=o.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},D.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var e=c(t),r=this.div(e),o=r.mul(e).sub(this);return r.toString(t)+o.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=c(u(t,6),this.unsigned),n=this,a="";;){var s=n.div(i),l=(n.sub(s.mul(i)).toInt()>>>0).toString(t);if((n=s).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},D.isZero=function(){return 0===this.high&&0===this.low},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&this.high<0},D.isPositive=function(){return this.unsigned||this.high>=0},D.isOdd=function(){return 1==(1&this.low)},D.isEven=function(){return 0==(1&this.low)},D.equals=function(t){return i(t)||(t=h(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},D.eq=D.equals,D.notEquals=function(t){return!this.eq(t)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(t){return this.comp(t)<0},D.lt=D.lessThan,D.lessThanOrEqual=function(t){return this.comp(t)<=0},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(t){return this.comp(t)>0},D.gt=D.greaterThan,D.greaterThanOrEqual=function(t){return this.comp(t)>=0},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(t){if(i(t)||(t=h(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(b)},D.neg=D.negate,D.add=function(t){i(t)||(t=h(t));var e=this.high>>>16,r=65535&this.high,o=this.low>>>16,n=65535&this.low,a=t.high>>>16,s=65535&t.high,c=t.low>>>16,u=0,d=0,f=0,p=0;return f+=(p+=n+(65535&t.low))>>>16,d+=(f+=o+c)>>>16,u+=(d+=r+s)>>>16,u+=e+a,l((f&=65535)<<16|(p&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},D.subtract=function(t){return i(t)||(t=h(t)),this.add(t.neg())},D.sub=D.subtract,D.multiply=function(t){if(this.isZero())return _;if(i(t)||(t=h(t)),r)return l(r.mul(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned);if(t.isZero())return _;if(this.eq(S))return t.isOdd()?S:_;if(t.eq(S))return this.isOdd()?S:_;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return c(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,o=65535&this.high,n=this.low>>>16,a=65535&this.low,s=t.high>>>16,u=65535&t.high,d=t.low>>>16,f=65535&t.low,p=0,g=0,y=0,b=0;return y+=(b+=a*f)>>>16,g+=(y+=n*f)>>>16,y&=65535,g+=(y+=a*d)>>>16,p+=(g+=o*f)>>>16,g&=65535,p+=(g+=n*d)>>>16,g&=65535,p+=(g+=a*u)>>>16,p+=e*f+o*d+n*u+a*s,l((y&=65535)<<16|(b&=65535),(p&=65535)<<16|(g&=65535),this.unsigned)},D.mul=D.multiply,D.divide=function(t){if(i(t)||(t=h(t)),t.isZero())throw Error("division by zero");var e,o,n;if(r)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?l((this.unsigned?r.div_u:r.div_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:_;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return T;n=y}else{if(this.eq(S))return t.eq(b)||t.eq(v)?S:t.eq(S)?b:(e=this.shr(1).div(t).shl(1)).eq(_)?t.isNegative()?b:v:(o=this.sub(t.mul(e)),n=e.add(o.div(t)));if(t.eq(S))return this.unsigned?y:_;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=_}for(o=this;o.gte(t);){e=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(e)/Math.LN2),s=a<=48?1:u(2,a-48),d=c(e),f=d.mul(t);f.isNegative()||f.gt(o);)f=(d=c(e-=s,this.unsigned)).mul(t);d.isZero()&&(d=b),n=n.add(d),o=o.sub(f)}return n},D.div=D.divide,D.modulo=function(t){return i(t)||(t=h(t)),r?l((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return l(~this.low,~this.high,this.unsigned)},D.and=function(t){return i(t)||(t=h(t)),l(this.low&t.low,this.high&t.high,this.unsigned)},D.or=function(t){return i(t)||(t=h(t)),l(this.low|t.low,this.high|t.high,this.unsigned)},D.xor=function(t){return i(t)||(t=h(t)),l(this.low^t.low,this.high^t.high,this.unsigned)},D.shiftLeft=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):l(0,this.low<<t-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):l(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(t){if(i(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?l(this.low>>>t|e<<32-t,e>>>t,this.unsigned):l(32===t?e:e>>>t-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},D.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},D.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},o.fromBytes=function(t,e,r){return r?o.fromBytesLE(t,e):o.fromBytesBE(t,e)},o.fromBytesLE=function(t,e){return new o(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},o.fromBytesBE=function(t,e){return new o(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */!function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__(5),ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});var createOutputMethod=function(t){return function(e){return new Md5(!0).update(e)[t]()}},createMethod=function(){var t=createOutputMethod("hex");NODE_JS&&(t=nodeWrap(t)),t.create=function(){return new Md5},t.update=function(e){return t.create().update(e)};for(var e=0;e<OUTPUT_TYPES.length;++e){var r=OUTPUT_TYPES[e];t[r]=createOutputMethod(r)}return t},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(t){if("string"==typeof t)return crypto.createHash("md5").update(t,"utf8").digest("hex");if(null==t)throw ERROR;return t.constructor===ArrayBuffer&&(t=new Uint8Array(t)),Array.isArray(t)||ArrayBuffer.isView(t)||t.constructor===Buffer?crypto.createHash("md5").update(new Buffer(t)).digest("hex"):method(t)};return nodeMethod};function Md5(t){if(t)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var e=new ArrayBuffer(68);this.buffer8=new Uint8Array(e),this.blocks=new Uint32Array(e)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(t){if(!this.finalized){var e,r=typeof t;if("string"!==r){if("object"!==r)throw ERROR;if(null===t)throw ERROR;if(ARRAY_BUFFER&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||ARRAY_BUFFER&&ArrayBuffer.isView(t)))throw ERROR;e=!0}for(var o,i,n=0,a=t.length,s=this.blocks,c=this.buffer8;n<a;){if(this.hashed&&(this.hashed=!1,s[0]=s[16],s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)if(ARRAY_BUFFER)for(i=this.start;n<a&&i<64;++n)c[i++]=t[n];else for(i=this.start;n<a&&i<64;++n)s[i>>2]|=t[n]<<SHIFT[3&i++];else if(ARRAY_BUFFER)for(i=this.start;n<a&&i<64;++n)(o=t.charCodeAt(n))<128?c[i++]=o:o<2048?(c[i++]=192|o>>6,c[i++]=128|63&o):o<55296||o>=57344?(c[i++]=224|o>>12,c[i++]=128|o>>6&63,c[i++]=128|63&o):(o=65536+((1023&o)<<10|1023&t.charCodeAt(++n)),c[i++]=240|o>>18,c[i++]=128|o>>12&63,c[i++]=128|o>>6&63,c[i++]=128|63&o);else for(i=this.start;n<a&&i<64;++n)(o=t.charCodeAt(n))<128?s[i>>2]|=o<<SHIFT[3&i++]:o<2048?(s[i>>2]|=(192|o>>6)<<SHIFT[3&i++],s[i>>2]|=(128|63&o)<<SHIFT[3&i++]):o<55296||o>=57344?(s[i>>2]|=(224|o>>12)<<SHIFT[3&i++],s[i>>2]|=(128|o>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&o)<<SHIFT[3&i++]):(o=65536+((1023&o)<<10|1023&t.charCodeAt(++n)),s[i>>2]|=(240|o>>18)<<SHIFT[3&i++],s[i>>2]|=(128|o>>12&63)<<SHIFT[3&i++],s[i>>2]|=(128|o>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&o)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[e>>2]|=EXTRA[3&e],e>=56&&(this.hashed||this.hash(),t[0]=t[16],t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.bytes<<3,t[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var t,e,r,o,i,n,a=this.blocks;this.first?e=((e=((t=((t=a[0]-680876937)<<7|t>>>25)-271733879<<0)^(r=((r=(-271733879^(o=((o=(-1732584194^2004318071&t)+a[1]-117830708)<<12|o>>>20)+t<<0)&(-271733879^t))+a[2]-1126478375)<<17|r>>>15)+o<<0)&(o^t))+a[3]-1316259209)<<22|e>>>10)+r<<0:(t=this.h0,e=this.h1,r=this.h2,e=((e+=((t=((t+=((o=this.h3)^e&(r^o))+a[0]-680876936)<<7|t>>>25)+e<<0)^(r=((r+=(e^(o=((o+=(r^t&(e^r))+a[1]-389564586)<<12|o>>>20)+t<<0)&(t^e))+a[2]+606105819)<<17|r>>>15)+o<<0)&(o^t))+a[3]-1044525330)<<22|e>>>10)+r<<0),e=((e+=((t=((t+=(o^e&(r^o))+a[4]-176418897)<<7|t>>>25)+e<<0)^(r=((r+=(e^(o=((o+=(r^t&(e^r))+a[5]+1200080426)<<12|o>>>20)+t<<0)&(t^e))+a[6]-1473231341)<<17|r>>>15)+o<<0)&(o^t))+a[7]-45705983)<<22|e>>>10)+r<<0,e=((e+=((t=((t+=(o^e&(r^o))+a[8]+1770035416)<<7|t>>>25)+e<<0)^(r=((r+=(e^(o=((o+=(r^t&(e^r))+a[9]-1958414417)<<12|o>>>20)+t<<0)&(t^e))+a[10]-42063)<<17|r>>>15)+o<<0)&(o^t))+a[11]-1990404162)<<22|e>>>10)+r<<0,e=((e+=((t=((t+=(o^e&(r^o))+a[12]+1804603682)<<7|t>>>25)+e<<0)^(r=((r+=(e^(o=((o+=(r^t&(e^r))+a[13]-40341101)<<12|o>>>20)+t<<0)&(t^e))+a[14]-1502002290)<<17|r>>>15)+o<<0)&(o^t))+a[15]+1236535329)<<22|e>>>10)+r<<0,e=((e+=((o=((o+=(e^r&((t=((t+=(r^o&(e^r))+a[1]-165796510)<<5|t>>>27)+e<<0)^e))+a[6]-1069501632)<<9|o>>>23)+t<<0)^t&((r=((r+=(t^e&(o^t))+a[11]+643717713)<<14|r>>>18)+o<<0)^o))+a[0]-373897302)<<20|e>>>12)+r<<0,e=((e+=((o=((o+=(e^r&((t=((t+=(r^o&(e^r))+a[5]-701558691)<<5|t>>>27)+e<<0)^e))+a[10]+38016083)<<9|o>>>23)+t<<0)^t&((r=((r+=(t^e&(o^t))+a[15]-660478335)<<14|r>>>18)+o<<0)^o))+a[4]-405537848)<<20|e>>>12)+r<<0,e=((e+=((o=((o+=(e^r&((t=((t+=(r^o&(e^r))+a[9]+568446438)<<5|t>>>27)+e<<0)^e))+a[14]-1019803690)<<9|o>>>23)+t<<0)^t&((r=((r+=(t^e&(o^t))+a[3]-187363961)<<14|r>>>18)+o<<0)^o))+a[8]+1163531501)<<20|e>>>12)+r<<0,e=((e+=((o=((o+=(e^r&((t=((t+=(r^o&(e^r))+a[13]-1444681467)<<5|t>>>27)+e<<0)^e))+a[2]-51403784)<<9|o>>>23)+t<<0)^t&((r=((r+=(t^e&(o^t))+a[7]+1735328473)<<14|r>>>18)+o<<0)^o))+a[12]-1926607734)<<20|e>>>12)+r<<0,e=((e+=((n=(o=((o+=((i=e^r)^(t=((t+=(i^o)+a[5]-378558)<<4|t>>>28)+e<<0))+a[8]-2022574463)<<11|o>>>21)+t<<0)^t)^(r=((r+=(n^e)+a[11]+1839030562)<<16|r>>>16)+o<<0))+a[14]-35309556)<<23|e>>>9)+r<<0,e=((e+=((n=(o=((o+=((i=e^r)^(t=((t+=(i^o)+a[1]-1530992060)<<4|t>>>28)+e<<0))+a[4]+1272893353)<<11|o>>>21)+t<<0)^t)^(r=((r+=(n^e)+a[7]-155497632)<<16|r>>>16)+o<<0))+a[10]-1094730640)<<23|e>>>9)+r<<0,e=((e+=((n=(o=((o+=((i=e^r)^(t=((t+=(i^o)+a[13]+681279174)<<4|t>>>28)+e<<0))+a[0]-358537222)<<11|o>>>21)+t<<0)^t)^(r=((r+=(n^e)+a[3]-722521979)<<16|r>>>16)+o<<0))+a[6]+76029189)<<23|e>>>9)+r<<0,e=((e+=((n=(o=((o+=((i=e^r)^(t=((t+=(i^o)+a[9]-640364487)<<4|t>>>28)+e<<0))+a[12]-421815835)<<11|o>>>21)+t<<0)^t)^(r=((r+=(n^e)+a[15]+530742520)<<16|r>>>16)+o<<0))+a[2]-995338651)<<23|e>>>9)+r<<0,e=((e+=((o=((o+=(e^((t=((t+=(r^(e|~o))+a[0]-198630844)<<6|t>>>26)+e<<0)|~r))+a[7]+1126891415)<<10|o>>>22)+t<<0)^((r=((r+=(t^(o|~e))+a[14]-1416354905)<<15|r>>>17)+o<<0)|~t))+a[5]-57434055)<<21|e>>>11)+r<<0,e=((e+=((o=((o+=(e^((t=((t+=(r^(e|~o))+a[12]+1700485571)<<6|t>>>26)+e<<0)|~r))+a[3]-1894986606)<<10|o>>>22)+t<<0)^((r=((r+=(t^(o|~e))+a[10]-1051523)<<15|r>>>17)+o<<0)|~t))+a[1]-2054922799)<<21|e>>>11)+r<<0,e=((e+=((o=((o+=(e^((t=((t+=(r^(e|~o))+a[8]+1873313359)<<6|t>>>26)+e<<0)|~r))+a[15]-30611744)<<10|o>>>22)+t<<0)^((r=((r+=(t^(o|~e))+a[6]-1560198380)<<15|r>>>17)+o<<0)|~t))+a[13]+1309151649)<<21|e>>>11)+r<<0,e=((e+=((o=((o+=(e^((t=((t+=(r^(e|~o))+a[4]-145523070)<<6|t>>>26)+e<<0)|~r))+a[11]-1120210379)<<10|o>>>22)+t<<0)^((r=((r+=(t^(o|~e))+a[2]+718787259)<<15|r>>>17)+o<<0)|~t))+a[9]-343485551)<<21|e>>>11)+r<<0,this.first?(this.h0=t+1732584193<<0,this.h1=e-271733879<<0,this.h2=r-1732584194<<0,this.h3=o+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+r<<0,this.h3=this.h3+o<<0)},Md5.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,o=this.h3;return HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,o=this.h3;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&o,o>>8&255,o>>16&255,o>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),e=new Uint32Array(t);return e[0]=this.h0,e[1]=this.h1,e[2]=this.h2,e[3]=this.h3,t},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var t,e,r,o="",i=this.array(),n=0;n<15;)t=i[n++],e=i[n++],r=i[n++],o+=BASE64_ENCODE_CHAR[t>>>2]+BASE64_ENCODE_CHAR[63&(t<<4|e>>>4)]+BASE64_ENCODE_CHAR[63&(e<<2|r>>>6)]+BASE64_ENCODE_CHAR[63&r];return t=i[n],o+(BASE64_ENCODE_CHAR[t>>>2]+BASE64_ENCODE_CHAR[t<<4&63]+"==")};var exports=createMethod();COMMON_JS?module.exports=exports:(root.md5=exports,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()}).call(this,__webpack_require__(3),__webpack_require__(4))},function(t,e){var r,o,i=t.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===n||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:n}catch(t){r=n}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(t){o=a}}();var c,l=[],u=!1,d=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&f())}function f(){if(!u){var t=s(h);u=!0;for(var e=l.length;e;){for(c=l,l=[];++d<e;)c&&c[d].run();d=-1,e=l.length}c=null,u=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];l.push(new p(t,e)),1!==l.length||u||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,r){t.exports=function(){"use strict";var t=r(7),e=Function.bind.call(Function.call,Array.prototype.reduce),o=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),i=Function.bind.call(Function.call,Array.prototype.concat);return Object.values||(Object.values=function(r){return e(t(r),function(t,e){return i(t,"string"==typeof e&&o(r,e)?[r[e]]:[])},[])}),Object.entries||(Object.entries=function(r){return e(t(r),function(t,e){return i(t,"string"==typeof e&&o(r,e)?[[e,r[e]]]:[])},[])}),Object}()},function(t,e){"object"==typeof Reflect&&"function"==typeof Reflect.ownKeys?t.exports=Reflect.ownKeys:"function"==typeof Object.getOwnPropertySymbols?t.exports=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:t.exports=Object.getOwnPropertyNames},function(t,e,r){"use strict";function o(t,e){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var r=Object(t),o=1;o<arguments.length;o++){var i=arguments[o];if(null!=i)for(var n=Object.keys(Object(i)),a=0,s=n.length;a<s;a++){var c=n[a],l=Object.getOwnPropertyDescriptor(i,c);void 0!==l&&l.enumerable&&(r[c]=i[c])}}return r}t.exports={assign:o,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:o})}}},function(t,e,r){"use strict";function o(){this.VERSION="2.3.6",this.REPORT_VERSION=this.VERSION+"_20191108_2106",this.NATIVEVERSION="web",this.PLATFORM="web",this.SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/whiteboard?sdkappid=",this.TEST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/whiteboard?sdkappid=",this.COS_SERVER_URL="https://cloud.tim.qq.com/v4/ilvb_cos/cos",this.TEST_COS_SERVER_URL="https://cloud-test.tim.qq.com/v4/ilvb_cos_test/cos",this.WHITELIST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/whitelist?sdkappid=",this.TEST_WHITELIST_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/whitelist?sdkappid=",this.TRANSCODE_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_edu/transcode?sdkappid=",this.TEST_TRANSCODE_SERVER_URL="https://yun.tim.qq.com/v4/ilvb_test/transcode?sdkappid=",this.SUB_CMD={GET_BOARD_DATA:"get_board_data",REPORT_BOARD_DATA:"report_board_data"},this.PROGRESS_ENABLE=!1,this.PROGRESS_SHOW_DELAY=100,this.COMMON_GROUP="#DEFAULT",this.COMMON_DEFAULT_BOARD="#DEFAULT",this.SCALE=100,this.MAX_SCALE=1600,this.MIN_SCALE=100,this.RATIO="16:9",this.THIN=100,this.SMOOTH_LEVEL=.1,this.MIN_LINE_WIDTH=1,this.MIN_FONT_SIZE=10,this.TEXT_MAX_LENGTH=2e3,this.TEXT_SIZE=320,this.TEXT_COLOR=0,this.TEXT_FONT_FAMILY="customFontFamily,sans-serif,serif,monospace",this.DATA_SYNC_ENABLE=!0,this.PRELOAD_DEPTH=5,this.TEXT_FONT_STYLE={NORMAL:0,BOLD:1,ITALIC:2,BOLD_ITALIC:3},this.FILE_TYPE={IMG:0,H5:1},this.ABOUTBLANK="about:blank",this.penCursorIcon="https://tic-res-1259648581.file.myqcloud.com/board/icons/pen2.png",this.laserCursorIcon="https://tic-res-1259648581.file.myqcloud.com/board/icons/laserpen.png",this.ICONS={0:{cursor:"auto"},1:{cursor:"none",offset:[0,0]},2:{cursor:"auto"},3:{cursor:"none"},4:{cursor:"crosshair"},5:{cursor:"crosshair"},6:{cursor:"crosshair"},7:{cursor:"crosshair"},8:{cursor:"crosshair"},9:{cursor:"auto"},10:{cursor:"crosshair"},11:{cursor:"text"},12:{cursor:"move"}},this.PROTOCOL_ACTION={LINE_START_ACTION:1,LINE_MOVE_ACTION:2,LINE_END_ACTION:3,RASER_SHOW_ACTION:6,RASER_HIDE_ACTION:7,ERASER_ACTION:8,MOVE_LINE_GRAPH_ACTION:9,GRAPH_LINE_ACTION:10,GRAPH_CIRCLE_ACTION:11,GRAPH_RECT_ACTION:12,INPUT_TEXT_ACTION:13,GRAPH_CLEAR_ALL_ACTION:101,GRAPH_CLEAR_ACTION:102,FILE_CLEAR_ACTION:103,RESET_DATA_ACTION:104,SET_BOARD_RATIO_ACTION:105,SET_BOARD_FIT_MODE_ACTION:106,UPDATE_BG_IMG_ACTION:201,DELETE_BG_IMG_ACTION:202,UPDATE_BG_COLOR_ACTION:203,BOARD_MOVE_SCALE_ACTION:301,SWITCH_ACTION:401,ADD_FILE_ACTION:501,PPT_EVENT_ACTION:601}}r.r(e),o.prototype.setPlatform=function(t){this.PLATFORM=t},o.prototype.setNativeVersion=function(t){this.NATIVEVERSION=t};var i=new o,n=function(t,e){this.user=t,this.type=e.type,this.seq=e.seq},a=r(1),s=r.n(a),c={serverTime:0,localTime:0,localServerTimeDiff:0,seq:0,getCurrentTimeStamp:function(){return isNaN(this.localServerTimeDiff)&&(this.localServerTimeDiff=0),Date.now()-this.localServerTimeDiff},getSeq:function(){var t=parseInt(this.getCurrentTimeStamp()/1e3);return 1*new s.a(t>>>0<<15|32767&this.seq++,t>>>0>>17).toString()}},l={decimalToRgba:function(t){6===t.length&&(t+="ff");var e=[];return t.replace(/../g,function(t,r){var o;o=3==e.length?parseInt(t,"0x10")/255:parseInt(t,"0x10"),e.push(o)}),"rgba("+e.join(",")+")"},hexToRgba:function(t){var e;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return 3==(e=t.substring(1).split("")).length&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),t="#"+e.join(""),"rgba("+parseInt("0x"+t.slice(1,3))+","+parseInt("0x"+t.slice(3,5))+","+parseInt("0x"+t.slice(5,7))+", 1)"},rgbaToDecimal:function(t){for(var e=t.toString().match(/[\d\.]+/g),r="",o=0;o<3;o++)r+=("0"+(0|Number(e[o])).toString(16)).slice(-2);var i="ff";return e.length>=4&&(i=("0"+(0|Number(Math.min(255,255*e[3]))).toString(16)).slice(-2)),r+i},dealColor:function(t){if(t<0)return"rgba("+(t>>24&255)+","+(t>>16&255)+","+(t>>8&255)+",1)";var e=parseInt(t).toString(16),r=e.substr(e.length-2,e.length)||0;return e=(e="000000"+(e=e.substr(0,e.length-2))).substring(e.length-6,e.length),this.decimalToRgba(e+r)},formatColor:function(t){var e=this.rgbaToDecimal(t);return parseInt(e,16)},getEffectivePoint:function(t,e){return t<=0?t=Math.floor(e/2):t>=1e4&&(t=1e4-Math.floor(e/2)),t},getAVSdkTimestamp:function(){var t=this.getTimeStamp()+"",e=t.substring(0,5)+"00000000",r=t.substr(5),o=parseInt(e,10).toString(2).substr(-32);return parseInt(o,2)+(4294967295&r)},getTimeStamp:function(){return c.getCurrentTimeStamp()},getSecondTime:function(){return parseInt(this.getTimeStamp()/1e3)},getTimeDiff:function(t){return this.getTimeStamp()-t},boardId2Fid:function(t){return t.substring(t.indexOf("#"))},boardId2Uid:function(t){if(t===i.COMMON_DEFAULT_BOARD)return"";var e="";try{e=(e=t.substring(0,t.match(/_\d+_\d+_#\w+$/).index)).substring(e.indexOf("_")+1)}catch(t){}return e},boardIdGetSeq:function(t){return t.match(/\d+_#/)[0].replace(/\D/gi,"")},isCosUrl:function(t){return t.indexOf("myqcloud.com")>-1&&t.indexOf("cos")>-1},cosUrlExtractFileName:function(t){t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var e=t.substring(t.lastIndexOf("/")+1);return t.indexOf("-1257240443")>-1&&e.match(/\d+_/)&&(e=e.substr(e.match(/^\d+_/)[0].length)),decodeURIComponent(e)},fileDownLoadUrlToPreviewUrl:function(t){if(t.startsWith("https")||(t=t.startsWith("http")?t.replace("http","https"):"https://"+t),t.endsWith("/"))return t;t.indexOf("?")>-1&&(t=t.substring(0,t.indexOf("?")));var e="//";t.indexOf(e)>-1&&(t=t.substring(t.indexOf(e)+e.length)),e=".";var r=t.indexOf(e);return e=".com","https://"+t.substr(0,r)+".preview.myqcloud.com"+t.substring(t.indexOf(e)+e.length)+"?cmd=doc_preview&of=pic&page="},fontStyle2CanvasFontStyle:function(t){var e="";return 0===t?e="":1===t?e="bold":2===t?e="italic":3===t&&(e="italic bold"),e+" "},maxCommonDivisor:function(t,e){return 0!=e?this.maxCommonDivisor(e,t%e):t},calcRatioWidthHeight:function(t,e){var r,o;try{var i=t.split(":");r=1*i[0],r=isNaN(r)?e.split(":")[0]:r,o=1*i[1],o=isNaN(o)?e.split(":")[1]:o}catch(t){return this.calcRatioWidthHeight(e)}return{ratioWidth:r,ratioHeight:o}},isMobile:function(){var t=navigator.userAgent.toLowerCase();if(!(t.indexOf("macintosh")>-1))return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t);try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}},isIOS:function(){var t=navigator.userAgent.toLowerCase();if(!(t.indexOf("macintosh")>-1))return/iphone|ipad|ipod/i.test(t);try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}},canvasTextAutoLine:function(t,e,r,o,i,n,a){var s=0,c=0,l=e.split("\n"),u=0,d=0,h=a||i-r-10-2-1,f=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,p=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return l.forEach(function(e,i){if(i>0&&(o+=n),s=0,c=0,""==e)t.fillText(e,r,o),u+=n,s=0;else for(var a=0;a<e.length;a++)f.test(e[a])||p.test(e[a])?s+=2*t.measureText("M").width:s+=t.measureText("M").width,d=Math.max(d,s),s>h+t.measureText(e[a]).width/2&&(t.fillText(e.substring(c,a),r,o,h),d=Math.min(d,h),u+=n,o+=n,s=0,c=a,--a),a==e.length-1&&(t.fillText(e.substring(c,e.length),r,o,h),u+=n)}),[d,u]},calcCanvasTextWidthAndHeight:function(t,e,r,o,i,n){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4,s=0,c=e.split("\n"),l=0,u=0,d=Math.min(Math.max(i-r-Math.floor(100*i/1e4),30),a),h=/[\u4E00-\u9FA5\uF900-\uFA2D\u0800-\u4e00]/,f=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return c.forEach(function(e,r){if(s=0,""==e)l+=n,s=0;else for(var o=0;o<e.length&&(h.test(e[o])||f.test(e[o])?s+=2*t.measureText("M").width:s+=t.measureText("M").width,u=Math.max(u,s),!(s>d&&(u=Math.min(u,d),l+=n,s=0,--o<0)));o++)o==e.length-1&&(l+=n)}),[u,l]},calcCanvasTextHeight:function(t,e,r,o,i,n){var a=0,s=0;return e.split("\n").forEach(function(e,o){o>0&&(s+=s),a=0;for(var c=0;c<e.length;c++)(a+=t.measureText(e[c]).width)>i-r-10-2-1&&(a=0,s+=n),c==e.length-1&&(s+=s)}),s},parseQueryString:function(t){var e={},r=[],o="",i="",n=t.substring(t.indexOf("?")+1,t.length).split("&");for(var a in n)o=(r=n[a].split("="))[0],i=r[1],e[o]=i;return e},extractTouch:function(t){return t&&t.changedTouches&&t.changedTouches[0]?{clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,force:t.changedTouches[0].force,identifier:t.changedTouches[0].identifier,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY,radiusX:t.changedTouches[0].radiusX,radiusY:t.changedTouches[0].radiusY,rotationAngle:t.changedTouches[0].rotationAngle,screenX:t.changedTouches[0].screenX,screenY:t.changedTouches[0].screenY}:{}},extractTaskId:function(t){return t.substring(t.indexOf(".com/")+5,t.indexOf("/index.html"))},camelCase2CamelCase:function(t){if("[object String]"===Object.prototype.toString.call(t))return t.replace(/(.)(.*)/,t.charAt(0).toUpperCase()+"$2");if("[object Object]"===Object.prototype.toString.call(t)){var e={};for(var r in t)e[this.camelCase2CamelCase(r)]=t[r];return e}},CamelCase2camelCase:function(t){if("[object String]"===Object.prototype.toString.call(t))return t.replace(/(.)(.*)/,t.charAt(0).toLowerCase()+"$2");if("[object Object]"===Object.prototype.toString.call(t)){var e={};for(var r in t)e[this.CamelCase2camelCase(r)]=t[r];return e}}};function u(t,e){this.user=t,this.type="line",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.show=e.show,this.status="begin",this.select=!1,this.color=e.color,this.time=l.getTimeStamp(),this.thin=e.thin,this.startSeq=e.belongSeq,this.endSeq=0,this.lines=[{x:e.x,y:e.y,belongSeq:e.belongSeq,seq:e.seq}],this.fitCurve=[],this.border={maxX:e.x,maxY:e.y,minX:e.x,minY:e.y}}u.prototype.setBorder=function(t,e){t+this.thin>this.border.maxX&&(this.border.maxX=l.getEffectivePoint(t+this.thin,this.thin)),t-this.thin<this.border.minX&&(this.border.minX=l.getEffectivePoint(t-this.thin,this.thin)),e+this.thin>this.border.maxY&&(this.border.maxY=l.getEffectivePoint(e+this.thin,this.thin)),e-this.thin<this.border.minY&&(this.border.minY=l.getEffectivePoint(e-this.thin,this.thin))},u.prototype.sort=function(){this.lines.sort(function(t,e){return t.seq-e.seq})};var d=u,h=function(t,e){this.user=t,this.type="graph",this.graph=e.graph,this.seq=e.seq,this.show=e.show,this.status="begin",this.select=!1,this.time=l.getTimeStamp(),this.color=e.color,this.thin=e.thin,this.solid=e.solid||!1,this.style=e.style,this.startPoint={x:e.beginPoint.x,y:e.beginPoint.y,seq:e.beginPoint.seq},this.endPoint={x:e.endPoint.x,y:e.endPoint.y,seq:e.endPoint.seq}},f=function(t,e){this.user=t,this.type="select",this.seq=Math.floor(100*Math.random()),this.show=!0,this.color=e.color,this.startInfo={x:e.startx,y:e.starty},this.location={x:e.x,y:e.y}},p=function(t,e){this.user=t,this.type="raser",this.seq=e.seq,this.show=!0,this.status=1,this.color=e.color,this.radius=e.radius,this.location={x:e.x,y:e.y},this.toolType=e.toolType||3},g=function(t,e){this.user=t,this.type="inputtext",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.scale=1,this.color=0,this.typeFace="",this.textSize=0,this.fontStyle=0,this.time=l.getTimeStamp(),this.text="",this.show=!0,this.textWidth=0,this.textHeight=0,this.location={x:e.x,y:e.y}},m={BOARD_ACTION_TYPE:{LINE:"line",ERASER:"eraser",RASER:"raser",POINTSELECT:"pointselect",SELECT:"select",MOVE:"move","GRAPH-LINE":"graph-line","GRAPH-CIRCLE":"graph-circle","GRAPH-RECT":"graph-rect","GRAPH-OVAL":"graph-oval","GRAPH-CIRCLE-SOLID":"graph-circle-solid","GRAPH-RECT-SOLID":"graph-rect-solid","GRAPH-OVAL-SOLID":"graph-oval-solid",INPUTTEXT:"inputtext",MOUSE:"mouse",ZOOM:"zoom","GRAPH-STRAIGHTLINE":"graph-straightLine","GRAPH-ELLIPSE":"graph-ellipse"},BOARD_MODE:{BOARD:0,FILE:1},BACKGROUND_TYPE:{IMAGE:0,H5:1},FILL_MODE:{DEFAULT:0,LEFT:4,TOP:5,RIGHT:6,BOTTOM:7},COLOR:{RED:4278190335,WHITE:4294967295},EVENT:{HISTROY_DATA_COMPLETE:"histroy_data_complete",ADD_BOARD:"add_board",RT_DATA:"real_time_data",REAL_TIME_DATA:"real_time_data",ADD_DATA_ERROR:"add_data_error",DELETE_BOARD:"delete_board",SWITCH_BOARD:"switch_board",ADD_FILE:"add_group",ADD_H5PPT_FILE:"add_h5ppt_file",DELETE_FILE:"delete_group",SWITCH_FILE:"switch_group",IMG_START_LOAD:"img_start_load",IMG_LOAD:"img_load",IMG_ERROR:"img_error",IMG_ABORT:"img_abort",PRELOAD:"preload",BOARD_CAN_UNDO:"board_can_undo",BOARD_CAN_REDO:"board_can_redo",VERIFY_SDK_SUCC:"verify_sdk_succ",VERIFY_SDK_ERROR:"verify_sdk_error",CANVAS_MOUSEDOWN:"canvas_mousedown",CANVAS_MOUSEMOVE:"canvas_mousemove",CANVAS_MOUSEUP:"canvas_mouseup",CANVAS_MOUSELEAVE:"canvas_mouseleave",CANVAS_TOUCHSTART:"canvas_touchstart",CANVAS_TOUCHMOVE:"canvas_touchmove",CANVAS_TOUCHEND:"CANVAS_touchend",CANVAS_TOUCHCANCEL:"canvas_touchcancel",UPDATE_BACKGROUND_IMAGE_SUCCESS:"update_background_image_success",UPDATE_BACKGROUND_IMAGE_ERROR:"update_background_image_error",COS:{GET_SIGN_ERROR:"get_sign_error",TASK_READY:"task_ready",HASH_PROGRESS:"hash_progress",PROGRESS:"progress",GET_SIGN_SUCCESS:"get_sign_success",DOES_NOT_SUPPORT_UPLOAD:"does_not_support_upload",UPLOAD_SUCCESS:"upload_success",UPLOAD_ERROR:"upload_error"}}};function _(){this.wxSysData=wx.getSystemInfoSync()}_.prototype={APIURL:"https://ilivelog.qcloud.com",events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},levels:{info:"info",warn:"warn",error:"error"},send:function(t){this.defDatas.brand=this.wxSysData.brand,this.defDatas.model=this.wxSysData.model,this.defDatas.platform=this.wxSysData.platform,this.defDatas.system=this.wxSysData.system,this.defDatas.weixinversion=this.wxSysData.version;try{t=this.fillDatas(t),wx.request({url:this.APIURL,data:JSON.stringify(t),method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){},fail:function(t){}})}catch(t){}},fillDatas:function(t){var e={};for(var r in this.defDatas)["sdkappid","classid","userid"].indexOf(r)>=0?e[r]=this.defDatas[r]:e[r]=void 0!==t[r]?t[r]:this.defDatas[r];return e},datasParseToString:function(t){var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")},reporterHandel:function(){return function(t){t&&t.readyState&&t.readyState}},log:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.info})},warn:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.warn})},error:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.error})},defDatas:{action:"",version:i.VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:"miniprog",log_time:0,business:"ticsdk",roomid:0,boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:null,userAgent:null,cookie:null,brand:null,model:null,platform:null,system:null,weixinversion:null},setSdkAppid:function(t){null!=t&&null!=t&&(this.defDatas.sdkappid=t)},setRoomId:function(t){null!=t&&null!=t&&(this.defDatas.roomid=t)},setUserId:function(t){null!=t&&null!=t&&(this.defDatas.userid=t)},boardAction:function(t,e){this.report(t,e)},report:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{this.send(Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:l.getTimeStamp()}))}catch(t){}}};var y=new _;function b(t){if(this.permissions=!1,this.reportEnable=!1,this.option=Object.assign({},t),!this.option.tlsData)throw new Error("not found sdkAppId|userId|userSig");if(!this.option.tlsData.sdkAppId)throw new Error("not found sdkAppId");if(!this.option.tlsData.identifier)throw new Error("not found userId");if(!this.option.tlsData.userSig)throw new Error("not found userSig");this.BOARD_URL=(t.isTest?i.TEST_SERVER_URL:i.SERVER_URL)+this.option.tlsData.sdkAppId,this.COS_SERVER_URL=t.isTest?i.TEST_COS_SERVER_URL:i.COS_SERVER_URL,this.WHITELIST_SERVER_URL=(t.isTest?i.TEST_WHITELIST_SERVER_URL:i.WHITELIST_SERVER_URL)+this.option.tlsData.sdkAppId,this.TRANSCODE_SERVER_URL=(t.isTest?i.TEST_TRANSCODE_SERVER_URL:i.TRANSCODE_SERVER_URL)+this.option.tlsData.sdkAppId}b.prototype.setPermissions=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.permissions=t},b.prototype.setReportEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.reportEnable=t},b.prototype.reportMsg=function(t,e,r){this.option.classId&&this.permissions&&this.reportEnable&&(t={cmd:"open_conf_svc",sub_cmd:"report_board_data",conf_id:parseInt(this.option.classId,10),board_data_list:t},this.post(t,e,r))},b.prototype.getBoardData=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o={first_time:t,cmd:"open_conf_svc",sub_cmd:"get_board_data",seq:c.getSeq(),conf_id:parseInt(this.option.classId,10),version:1};this.post(o,e,r)},b.prototype.getLineData=function(t,e,r){var o=l.getTimeStamp(),i={cmd:"open_conf_svc",sub_cmd:"get_line",conf_id:parseInt(this.option.classId,10),boardId:t.boardId,owner:t.owner,seq:t.seq};this.post(i,function(t){y.report("getLineData",{action_result:0,time_consume:l.getTimeStamp()-o,extra_info:JSON.stringify(t)}),e&&e(t)},function(t){y.report("getLineData",{action_result:-1,time_consume:l.getTimeStamp()-o,extra_info:JSON.stringify(t)}),r&&r(t)})},b.prototype.getFileInfo=function(t,e,r){var o=l.getTimeStamp(),i={cmd:"open_conf_svc",sub_cmd:"get_file",conf_id:parseInt(this.option.classId,10),fid:t.fid};this.post(i,function(t){y.report("getFileInfo",{action_result:0,time_consume:l.getTimeStamp()-o,extra_info:JSON.stringify(t)}),e&&e(t)},function(t){y.report("getFileInfo",{action_result:-1,time_consume:l.getTimeStamp()-o,extra_info:JSON.stringify(t)}),r&&r(t)})},b.prototype.getDocTotalPage=function(t){return this.getPromise(t,{responseType:"blob"})},b.prototype.getCosAuthData=function(){var t=this.COS_SERVER_URL+"?SdkAppId=".concat(this.option.tlsData.sdkAppId,"&Identifier=").concat(this.option.tlsData.identifier,"&UserSig=").concat(this.option.tlsData.identifier);return this.postPromise(t,{cmd:"open_cos_svc",sub_cmd:"get_cos_token",duration:300,version:2})},b.prototype.createTranscode=function(t){var e=this.TRANSCODE_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return this.postPromise(e,Object.assign({Action:"CreateTranscode"},l.camelCase2CamelCase(t),{IsStaticPPT:!0}))},b.prototype.describeTranscode=function(t){var e=this.TRANSCODE_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return this.postPromise(e,Object.assign({Action:"DescribeTranscode"},l.camelCase2CamelCase(t)))},b.prototype.applyPermissions=function(){var t=this.WHITELIST_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return this.postPromise(t,{cmd:"open_conf_svc",sub_cmd:"verify_sdk",sdkappid:1*this.option.tlsData.sdkAppId,version:1})},b.prototype.post=function(t,e,r){var o=this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;wx.request({url:o,data:t,method:"POST",header:{"content-type":"application/json"},success:function(t){e(t.data)},fail:r})},b.prototype.postPromise=function(t,e){return t=t||this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier,new Promise(function(r,o){wx.request({url:t,data:e,method:"POST",header:{"content-type":"application/json"},success:function(t){r(t)},fail:function(){o.apply(this,arguments)}})})},b.prototype.getPromise=function(t,e){return t=t||this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier,new Promise(function(r,o){wx.request({url:t,data:e,method:"GET",header:{"content-type":"application/json"},responseType:"arraybuffer",success:function(t){r(t)},fail:function(){o.apply(this,arguments)}})})};var T=b;function v(t){this.request=t}v.prototype.reportCreateBoards=function(t,e){var r;if(0!==(r=Array.isArray(e)?e:[e]).length){var o=l.getTimeStamp();this.request.reportMsg([{type:"createBoards",seq:c.getSeq(),content:{fid:l.boardId2Fid(r[0]),createBoards:r,updateTime:l.getTimeStamp()}}],function(e){e.ErrorCode||e.error_code?y.boardAction("createBoards",{action_result:e.ErrorCode?"ErrorCode:".concat(e.ErrorCode):"error_code:".concat(e.error_code),action_info:e.ErrorInfo||e.error_msg,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("createBoards",{action_result:0,action_info:null,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){y.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})}},v.prototype.reportDeleteBoard=function(t,e){var r=l.getTimeStamp();this.request.reportMsg([{type:"deleteBoards",seq:c.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:l.getTimeStamp()}}],function(o){o.ErrorCode||o.error_code?y.boardAction("deleteBoards",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):y.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})},function(o){y.boardAction("deleteBoards",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})})},v.prototype.reportSetBoardBgColor=function(t,e){var r=l.getTimeStamp();this.request.reportMsg([{type:"setBoardBG",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp(),colorRGBA:e}}],function(o){o.ErrorCode||o.error_code?y.boardAction("setBoardBG",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):y.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})},function(o){y.boardAction("setBoardBG",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})})},v.prototype.reportClear=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"clean",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("clean",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("clean",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("clean",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},v.prototype.reportClearDraws=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"cleanDraws",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("cleanDraws",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("cleanDraws",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},v.prototype.reportImage=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.FILL_MODE.DEFAULT,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.BACKGROUND_TYPE.IMAGE,i=l.getTimeStamp();this.request.reportMsg([{type:"image",seq:c.getSeq(),content:{fid:l.boardId2Fid(t),boardId:t,url:e,updateTime:l.getTimeStamp(),type:o,mode:r}}],function(r){var o={};o[t]=e,r.ErrorCode||r.error_code?y.boardAction("image",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("image",{action_result:0,action_info:null,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o={};o[t]=e,y.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})})},v.prototype.reportImages=function(t){for(var e=l.getTimeStamp(),r=0,o=Math.ceil(t.length/100);r<o;r++){var i;i=t.slice(100*r,100*(r+1)),this.request.reportMsg(i,function(r){var o=[];t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,o.push(e)}),r.ErrorCode||r.error_code?y.boardAction("image",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("image",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o=[];t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,o.push(e)}),y.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})})}},v.prototype.reportSwitchBoard=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"switchBoard",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("switchBoard",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){y.boardAction("switchBoard",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},v.prototype.reportGlobalBgColor=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"setGlobalBG",seq:c.getSeq(),content:{updateTime:l.getTimeStamp(),colorRGBA:t}}],function(r){r.ErrorCode||r.error_code?y.boardAction("setGlobalBG",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):y.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})},function(r){y.boardAction("setGlobalBG",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})})},v.prototype.reportAddLine=function(t){l.getTimeStamp(),this.request.reportMsg([{type:"addLine",seq:c.getSeq(),content:t}],function(t){t.ErrorCode||t.error_code},function(t){})},v.prototype.reportAddText=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"addText",seq:c.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?y.boardAction("addText",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):y.boardAction("addText",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(r){y.boardAction("addText",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},v.prototype.reportDisplayLine=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"displayLine",seq:c.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?y.boardAction("displayLine",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):y.boardAction("displayLine",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})},function(r){y.boardAction("displayLine",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})})},v.prototype.reportGraphData=function(t){var e=l.getTimeStamp();this.request.reportMsg(t,function(r){t.forEach(function(t){r.ErrorCode||r.error_code?y.boardAction(t.type,{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null}):y.boardAction(t.type,{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})},function(r){t.forEach(function(t){y.boardAction(t.type,{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})})},v.prototype.reportAddFile=function(t){var e=t.fid,r=t.title,o=t.downloadURL,i=t.pageCount,n=t.currentPageIndex,a=t.currentPageStep,s=t.uid,u=t.timestamp,d=t.platform,h=t.type,f=l.getTimeStamp();this.request.reportMsg([{type:"addFile",seq:c.getSeq(),content:{updateTime:l.getTimeStamp(),fid:e,title:r,downloadURL:o,pageCount:i,currentPageIndex:n,currentPageStep:a,uid:s,timestamp:u,platform:d,type:h}}],function(t){t.ErrorCode||t.error_code?y.boardAction("addFile",{action_result:t.ErrorCode?"ErrorCode:".concat(t.ErrorCode):"error_code:".concat(t.error_code),action_info:t.ErrorInfo||t.error_msg,time_consume:l.getTimeDiff(f),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r}):y.boardAction("addFile",{action_result:0,action_info:null,time_consume:l.getTimeDiff(f),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r})},function(t){y.boardAction("addFile",{action_result:-9999,action_info:t&&t.message,time_consume:l.getTimeDiff(f),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r})})},v.prototype.reportDeleteFile=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"deleteFile",seq:c.getSeq(),content:{fid:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?y.boardAction("deleteFile",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):y.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})},function(r){y.boardAction("deleteFile",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})})},v.prototype.reportsetBoardRatio=function(t){this.request.reportMsg([{type:"setRatio",seq:c.getSeq(),content:{ratio:t}}],function(t){},function(t){})},v.prototype.reportCleanAll=function(){var t=l.getTimeStamp();this.request.reportMsg([{type:"cleanAll",seq:c.getSeq()}],function(e){e.ErrorCode||e.error_code?y.boardAction("cleanAll",{action_result:e.ErrorCode?"ErrorCode:".concat(e.ErrorCode):"error_code:".concat(e.error_code),action_info:e.ErrorInfo||e.error_msg,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):y.boardAction("cleanAll",{action_result:0,action_info:null,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){y.boardAction("cleanAll",{action_result:-9999,action_info:e&&e.message,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})};var C=v,E={postMessage:function(t,e){t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")},init:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"init",data:e},"*")},count:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"count"},"*")},getCurrentSlideIndex:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_slide_index"},"*")},getCurrentStepIndex:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_step_index"},"*")},getCurrentStepCount:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"current_step_count"},"*")},nextPage:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"next_page"},"*")},prevPage:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"prev_page"},"*")},gotoNextStep:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"next_step_new",data:e},"*")},gotoPreviousStep:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"prev_step_new",data:e},"*")},gotoSlide:function(t,e,r){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_slide",data:{slideIndex:e,autoStart:r}},"*")},gotoTimestamp:function(t,e,r,o,i){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_timestamp",data:{slideIndex:e,stepIndex:r,autoStart:o,timeOffset:i}},"*")},gotoTimestampNew:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"goto_timestamp_new",data:{slideIndex:e.slideIndex,stepIndex:e.stepIndex,resetStep:e.resetStep,usePrevNextStepMethod:e.usePrevNextStepMethod,isPassive:e.isPassive}},"*")},clearIframeCache:function(t){this.postMessage(t,{module:"tx_board_postmessage",cmd:"clear_cache"},"*")},setFid:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"set_fid",data:e},"*")},pptAction:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"ppt_action",data:e},"*")},sendMouseEvent:function(t,e){this.postMessage(t,{module:"tx_board_postmessage",cmd:"mouse_event",data:e},"*")}};function S(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var D=function(){function t(e,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardId=e||"",this.backgroundUrl="",r&&(this.backgroundUrl=r.url||""),this.backgroundColor=o||""}var e,r;return e=t,(r=[{key:"setBoardId",value:function(t){this.boardId=t}},{key:"setBackgroundUrl",value:function(t){this.backgroundUrl=t}},{key:"getBoardId",value:function(){return this.boardId}},{key:"getBackgroundUrl",value:function(){return this.backgroundUrl}},{key:"setBackgroundColor",value:function(t){this.backgroundColor=t}},{key:"getBackgroundColor",value:function(){return this.backgroundColor}}])&&S(e.prototype,r),t}(),A=1,O=3,x=2,R=4,B=6,I=7,P=0;function w(){}w.prototype={APIURL:"https://ilivelog.qcloud.com",method:"POST",events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},levels:{info:"info",warn:"warn",error:"error"},send:function(t){try{t.userAgent=navigator.userAgent,t=this.fillDatas(t);var e=this.getXHR();e.onreadystatechange=this.reporterHandel(e),e.open(this.method,this.APIURL,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(JSON.stringify(t))}catch(t){}},fillDatas:function(t){var e={};for(var r in this.defDatas)["sdkappid","classid","userid"].indexOf(r)>=0?e[r]=this.defDatas[r]:(e[r]=void 0!==t[r]?t[r]:this.defDatas[r],"boardid_list"===r&&(e[r]=JSON.stringify(this.defDatas[r])),"roomid"===r&&(e[r]=this.defDatas[r]+""));return e.device=i.PLATFORM,e.nativeVersion=i.NATIVEVERSION,e},datasParseToString:function(t){var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")},getXHR:function(){var t=null,e=window.ActiveXObject;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(e)try{t=new e("Msxml2.XMLHTTP")}catch(r){try{t=new e("Microsoft.XMLHTTP")}catch(t){}}if(null!=t)return t},reporterHandel:function(t){return function(){t&&t.readyState&&t.readyState}},log:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.info})},warn:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.warn})},error:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.error})},defDatas:{action:"",version:i.REPORT_VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:i.PLATFORM,log_time:0,business:"ticsdk",roomid:"",boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:"unknown",userAgent:null},setSdkAppid:function(t){null!=t&&null!=t&&(this.defDatas.sdkappid=t)},setRoomId:function(t){null!=t&&null!=t&&(this.defDatas.roomid=t)},setUserId:function(t){null!=t&&null!=t&&(this.defDatas.userid=t)},boardAction:function(t,e){this.report(t,e)},report:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{this.send(Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:l.getTimeStamp()}))}catch(t){}}};var N=new w;function L(t){this.request=t}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function M(t,e,r){return e&&q(t.prototype,e),r&&q(t,r),t}function F(t,e){return function(t){if(Array.isArray(t))return t}
/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */(t)||function(t,e){var r=[],o=!0,i=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);o=!0);}catch(t){i=!0,n=t}finally{try{o||null==s.return||s.return()}finally{if(i)throw n}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function U(t,e,r,o,i,n){var a,s,c,l=F(function(t,e,r){var o,i,n,a,s,c,l,u;i=0,n=t.length/2;var d=H(e,10);for(s=0,c=t.length;s<c;s++)l=t[s],u=j(e,r[s],d,10),(o=(a=W.subtract(z.q(e,u),l))[0]*a[0]+a[1]*a[1])>i&&(i=o,n=s);return[i,n]}(t,a=function(t,e,r,o){var i,n,a,s,c,l,u,d,h,f,p,g,m,_,y,b,T,v=t[0],C=t[t.length-1];for(i=[v,null,null,C],n=W.zeros_Xx2x2(e.length),m=0,_=e.length;m<_;m++)T=1-(b=e[m]),(a=n[m])[0]=W.mulItems(r,3*b*(T*T)),a[1]=W.mulItems(o,3*T*(b*b));for(s=[[0,0],[0,0]],c=[0,0],m=0,_=t.length;m<_;m++)b=e[m],a=n[m],s[0][0]+=W.dot(a[0],a[0]),s[0][1]+=W.dot(a[0],a[1]),s[1][0]+=W.dot(a[0],a[1]),s[1][1]+=W.dot(a[1],a[1]),y=W.subtract(t[m],z.q([v,v,C,C],b)),c[0]+=W.dot(a[0],y),c[1]+=W.dot(a[1],y);return l=s[0][0]*s[1][1]-s[1][0]*s[0][1],u=s[0][0]*c[1]-s[1][0]*c[0],d=c[0]*s[1][1]-c[1]*s[0][1],f=0===l?0:u/l,(h=0===l?0:d/l)<(p=1e-6*(g=W.vectorLen(W.subtract(v,C))))||f<p?(i[1]=W.addArrays(v,W.mulItems(r,g/3)),i[2]=W.addArrays(C,W.mulItems(o,g/3))):(i[1]=W.addArrays(v,W.mulItems(r,h)),i[2]=W.addArrays(C,W.mulItems(o,f))),i}(t,r,o,i),e),2);return s=l[0],c=l[1],n&&n({bez:a,points:t,params:e,maxErr:s,maxPoint:c}),[a,s,c]}function G(t,e,r){return r.map(function(r,o){return function(t,e,r){var o=W.subtract(z.q(t,r),e),i=z.qprime(t,r),n=W.mulMatrix(o,i),a=W.sum(W.squareItems(i))+2*W.mulMatrix(o,z.qprimeprime(t,r));return 0===a?r:r-n/a}(t,e[o],r)})}L.prototype.reportCreateBoards=function(t,e){var r;if(0!==(r=Array.isArray(e)?e:[e]).length){var o=l.getTimeStamp();this.request.reportMsg([{type:"createBoards",seq:c.getSeq(),content:{fid:l.boardId2Fid(r[0]),createBoards:r,updateTime:l.getTimeStamp()}}],function(e){e.ErrorCode||e.error_code?N.boardAction("createBoards",{action_result:e.ErrorCode?"ErrorCode:".concat(e.ErrorCode):"error_code:".concat(e.error_code),action_info:e.ErrorInfo||e.error_msg,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):N.boardAction("createBoards",{action_result:0,action_info:null,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){N.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:l.getTimeDiff(o),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})}},L.prototype.reportDeleteBoard=function(t,e){var r=l.getTimeStamp();this.request.reportMsg([{type:"deleteBoards",seq:c.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:l.getTimeStamp()}}],function(o){o.ErrorCode||o.error_code?N.boardAction("deleteBoards",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):N.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})},function(o){N.boardAction("deleteBoards",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})})},L.prototype.reportSetBoardBgColor=function(t,e){var r=l.getTimeStamp();this.request.reportMsg([{type:"setBoardBG",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp(),colorRGBA:e}}],function(o){o.ErrorCode||o.error_code?N.boardAction("setBoardBG",{action_result:o.ErrorCode?"ErrorCode:".concat(o.ErrorCode):"error_code:".concat(o.error_code),action_info:o.ErrorInfo||o.error_msg,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):N.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})},function(o){N.boardAction("setBoardBG",{action_result:-9999,action_info:o&&o.message,time_consume:l.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})})},L.prototype.reportClear=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"clean",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?N.boardAction("clean",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):N.boardAction("clean",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){N.boardAction("clean",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},L.prototype.reportClearDraws=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"cleanDraws",seq:c.getSeq(),content:{boardId:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?N.boardAction("cleanDraws",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):N.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){N.boardAction("cleanDraws",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},L.prototype.reportImage=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.FILL_MODE.DEFAULT,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.BACKGROUND_TYPE.IMAGE,i=l.getTimeStamp();this.request.reportMsg([{type:"image",seq:c.getSeq(),content:{fid:l.boardId2Fid(t),boardId:t,url:e,updateTime:l.getTimeStamp(),type:o,mode:r}}],function(r){var o={};o[t]=e,r.ErrorCode||r.error_code?N.boardAction("image",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null}):N.boardAction("image",{action_result:0,action_info:null,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o={};o[t]=e,N.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(i),boardid:null,boardid_list:[o],to_boardId:null,color:null,file_id:null,file_title:null})})},L.prototype.reportImages=function(t){for(var e=l.getTimeStamp(),r=0,o=Math.ceil(t.length/100);r<o;r++){var i;i=t.slice(100*r,100*(r+1)),this.request.reportMsg(i,function(r){var o=[];t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,o.push(e)}),r.ErrorCode||r.error_code?N.boardAction("image",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null}):N.boardAction("image",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){var o=[];t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,o.push(e)}),N.boardAction("image",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:o,to_boardId:null,color:null,file_id:null,file_title:null})})}},L.prototype.reportSwitchBoard=function(t){var e=t.boardId,r=t.fid,o=t.url,i=t.type,n=t.page,a=t.step,s=t.ratio,u=t.scale,d=l.getTimeStamp();this.request.reportMsg([{type:"switchBoard",seq:c.getSeq(),content:{boardId:e,fid:r,url:o,type:i,page:n,step:a,ratio:s,scale:u,updateTime:l.getTimeStamp()}}],function(t){t.ErrorCode||t.error_code?N.boardAction("switchBoard",{action_result:t.ErrorCode?"ErrorCode:".concat(t.ErrorCode):"error_code:".concat(t.error_code),action_info:t.ErrorInfo||t.error_msg,time_consume:l.getTimeDiff(d),boardid:e,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):N.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:l.getTimeDiff(d),boardid:e,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(t){N.boardAction("switchBoard",{action_result:-9999,action_info:t&&t.message,time_consume:l.getTimeDiff(d),boardid:e,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},L.prototype.reportGlobalBgColor=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"setGlobalBG",seq:c.getSeq(),content:{updateTime:l.getTimeStamp(),colorRGBA:t}}],function(r){r.ErrorCode||r.error_code?N.boardAction("setGlobalBG",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):N.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})},function(r){N.boardAction("setGlobalBG",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})})},L.prototype.reportAddLine=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"addLine",seq:c.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?N.boardAction("addLine",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):N.boardAction("addLine",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(r){N.boardAction("addLine",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},L.prototype.reportAddText=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"addText",seq:c.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?N.boardAction("addText",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):N.boardAction("addText",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(r){N.boardAction("addText",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},L.prototype.reportDisplayLine=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"displayLine",seq:c.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?N.boardAction("displayLine",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):N.boardAction("displayLine",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})},function(r){N.boardAction("displayLine",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})})},L.prototype.reportGraphData=function(t){var e=l.getTimeStamp();this.request.reportMsg(t,function(r){t.forEach(function(t){r.ErrorCode||r.error_code?N.boardAction(t.type,{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null}):N.boardAction(t.type,{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})},function(r){t.forEach(function(t){N.boardAction(t.type,{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})})},L.prototype.reportAddFile=function(t){var e=t.fid,r=t.title,o=t.downloadURL,n=t.pageCount,a=t.currentPageIndex,s=t.currentPageStep,u=t.uid,d=t.timestamp,h=t.platform,f=t.type,p=t.ratio,g=t.scale,m=t.isTranscodeFile,_=l.getTimeStamp();this.request.reportMsg([{type:"addFile",seq:c.getSeq(),content:{updateTime:l.getTimeStamp(),fid:e,title:r,downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:s,uid:u,timestamp:d,platform:h||i.PLATFORM,type:f||i.FILE_TYPE.IMG,ratio:p,scale:g,isTranscodeFile:m}}],function(t){t.ErrorCode||t.error_code?N.boardAction("addFile",{action_result:t.ErrorCode?"ErrorCode:".concat(t.ErrorCode):"error_code:".concat(t.error_code),action_info:t.ErrorInfo||t.error_msg,time_consume:l.getTimeDiff(_),extra_info:JSON.stringify({downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:s,uid:u,timestamp:d,platform:h||i.PLATFORM,type:f||i.FILE_TYPE.IMG,ratio:p,scale:g,isTranscodeFile:m}),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r}):N.boardAction("addFile",{action_result:0,action_info:null,time_consume:l.getTimeDiff(_),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r,extra_info:JSON.stringify({downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:s,uid:u,timestamp:d,platform:h||i.PLATFORM,type:f||i.FILE_TYPE.IMG,ratio:p,scale:g,isTranscodeFile:m})})},function(t){N.boardAction("addFile",{action_result:-9999,action_info:t&&t.message,time_consume:l.getTimeDiff(_),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:e,file_title:r,extra_info:JSON.stringify({downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:s,uid:u,timestamp:d,platform:h||i.PLATFORM,type:f||i.FILE_TYPE.IMG,ratio:p,scale:g,isTranscodeFile:m})})})},L.prototype.reportDeleteFile=function(t){var e=l.getTimeStamp();this.request.reportMsg([{type:"deleteFile",seq:c.getSeq(),content:{fid:t,updateTime:l.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?N.boardAction("deleteFile",{action_result:r.ErrorCode?"ErrorCode:".concat(r.ErrorCode):"error_code:".concat(r.error_code),action_info:r.ErrorInfo||r.error_msg,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):N.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})},function(r){N.boardAction("deleteFile",{action_result:-9999,action_info:r&&r.message,time_consume:l.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})})},L.prototype.reportDrag=function(t){this.request.reportMsg([{type:"drag",seq:c.getSeq(),content:t}],function(t){},function(t){})},L.prototype.reportsetBoardRatio=function(t){this.request.reportMsg([{type:"setRatio",seq:c.getSeq(),content:t}],function(t){},function(t){})},L.prototype.reportsetBoardContentFitMode=function(t){this.request.reportMsg([{type:"setBoardContentFitMode",seq:c.getSeq(),content:t}],function(t){},function(t){})},L.prototype.reportCleanAll=function(){var t=l.getTimeStamp();this.request.reportMsg([{type:"cleanAll",seq:c.getSeq()}],function(e){e.ErrorCode||e.error_code?N.boardAction("cleanAll",{action_result:e.ErrorCode?"ErrorCode:".concat(e.ErrorCode):"error_code:".concat(e.error_code),action_info:e.ErrorInfo||e.error_msg,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):N.boardAction("cleanAll",{action_result:0,action_info:null,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){N.boardAction("cleanAll",{action_result:-9999,action_info:e&&e.message,time_consume:l.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})};var H=function(t,e){for(var r,o=[0],i=t[0],n=0,a=1;a<=e;a++)r=z.q(t,a/e),n+=W.vectorLen(W.subtract(r,i)),o.push(n),i=r;return o.map(function(t){return t/n})};function j(t,e,r,o){if(e<0)return 0;if(e>1)return 1;for(var i,n,a,s,c=1;c<=o;c++)if(e<=r[c]){a=(c-1)/o,n=c/o,s=(e-(i=r[c-1]))/(r[c]-i)*(n-a)+a;break}return s}function K(t,e){return W.normalize(W.subtract(t,e))}var W=function(){function t(){k(this,t)}return M(t,null,[{key:"zeros_Xx2x2",value:function(t){for(var e=[];t--;)e.push([0,0]);return e}},{key:"mulItems",value:function(t,e){return t.map(function(t){return t*e})}},{key:"mulMatrix",value:function(t,e){return t.reduce(function(t,r,o){return t+r*e[o]},0)}},{key:"subtract",value:function(t,e){return t.map(function(t,r){return t-e[r]})}},{key:"addArrays",value:function(t,e){return t.map(function(t,r){return t+e[r]})}},{key:"addItems",value:function(t,e){return t.map(function(t){return t+e})}},{key:"sum",value:function(t){return t.reduce(function(t,e){return t+e})}},{key:"dot",value:function(e,r){return t.mulMatrix(e,r)}},{key:"vectorLen",value:function(t){return Math.hypot.apply(Math,function(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(t))}},{key:"divItems",value:function(t,e){return t.map(function(t){return t/e})}},{key:"squareItems",value:function(t){return t.map(function(t){return t*t})}},{key:"normalize",value:function(t){return this.divItems(t,this.vectorLen(t))}}]),t}(),z=function(){function t(){k(this,t)}return M(t,null,[{key:"q",value:function(t,e){var r=1-e,o=W.mulItems(t[0],r*r*r),i=W.mulItems(t[1],3*r*r*e),n=W.mulItems(t[2],3*r*e*e),a=W.mulItems(t[3],e*e*e);return W.addArrays(W.addArrays(o,i),W.addArrays(n,a))}},{key:"qprime",value:function(t,e){var r=1-e,o=W.mulItems(W.subtract(t[1],t[0]),3*r*r),i=W.mulItems(W.subtract(t[2],t[1]),6*r*e),n=W.mulItems(W.subtract(t[3],t[2]),3*e*e);return W.addArrays(W.addArrays(o,i),n)}},{key:"qprimeprime",value:function(t,e){return W.addArrays(W.mulItems(W.addArrays(W.subtract(t[2],W.mulItems(t[1],2)),t[0]),6*(1-e)),W.mulItems(W.addArrays(W.subtract(t[3],W.mulItems(t[2],2)),t[1]),6*e))}}]),t}(),V=function(t,e,r){if(!Array.isArray(t))return[];var o=!0;if(t.forEach(function(e){Array.isArray(e)&&!e.some(function(t){return"number"!=typeof t})&&e.length===t[0].length||(o=!1)}),!o)return[];if((t=t.filter(function(e,r){return 0===r||!e.every(function(e,o){return e===t[r-1][o]})})).length<2)return[];var i=t.length,n=K(t[1],t[0]),a=K(t[i-2],t[i-1]);return function t(e,r,o,i,n){var a,s,c,l,u,d,h,f,p,g,m,_,y;if(2===e.length)return _=W.vectorLen(W.subtract(e[0],e[1]))/3,[a=[e[0],W.addArrays(e[0],W.mulItems(r,_)),W.addArrays(e[1],W.mulItems(o,_)),e[1]]];s=function(t){var e,r,o,i=[];return t.forEach(function(t,n){e=n?r+W.vectorLen(W.subtract(t,o)):0,i.push(e),r=e,o=t}),i=i.map(function(t){return t/r})}(e);var b=F(U(e,s,s,r,o,n),3);if(a=b[0],l=b[1],d=b[2],l<i)return[a];if(l<i*i)for(c=s,u=l,h=d,y=0;y<20;y++){var T=F(U(e,s,c=G(a,e,c),r,o,n),3);if(a=T[0],l=T[1],d=T[2],l<i)return[a];if(d===h){var v=l/u;if(v>.9999&&v<1.0001)break}u=l,h=d}if(m=[],(f=W.subtract(e[d-1],e[d+1])).every(function(t){return 0===t})){var C=[-(f=W.subtract(e[d-1],e[d]))[1],f[0]];f[0]=C[0],f[1]=C[1]}return p=W.normalize(f),g=W.mulItems(p,-1),(m=m.concat(t(e.slice(0,d+1),r,p,i,n))).concat(t(e.slice(d),g,o,i,n))}(t,n,a,e,r)};function Y(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var X=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.action=i.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION,this.scale=e.scale,this.xOffsetRatio=e.xOffsetRatio,this.yOffsetRatio=e.yOffsetRatio,this.xOffset=e.xOffset,this.yOffset=e.yOffset}var e,r;return e=t,(r=[{key:"update",value:function(t){Object.assign(this,t)}},{key:"getReportData",value:function(){return{updateTime:l.getSecondTime(),xOffset:Number(this.xOffset.toFixed(4)),yOffset:Number(this.yOffset.toFixed(4)),scale:this.scale}}},{key:"getRealTimeData",value:function(){return{action:this.action,time:l.getTimeStamp(),seq:c.getSeq(),scale:this.scale,xOffset:Number(this.xOffset.toFixed(4)),yOffset:Number(this.yOffset.toFixed(4))}}}])&&Y(e.prototype,r),t}();function J(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var $=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data={}}var e,r;return e=t,(r=[{key:"addDragData",value:function(t,e){this.data[t]||(this.data[t]=e)}},{key:"getDragData",value:function(t){return this.data[t]}},{key:"updateDragData",value:function(t,e){this.data[t].update(e)}}])&&J(e.prototype,r),t}();function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Q(t){this.event=t.event,this.options=JSON.parse(JSON.stringify(t)),this.preStep=t.preStep||2,this.context=t.context,this.maxSeq=0,this.request=new T(t),this.report=new C(this.request),this.permissions=0,"[object Undefined]"===Object.prototype.toString.call(t.syncHistroyEnable)||"[object Null]"===Object.prototype.toString.call(t.syncHistroyEnable)?this.syncHistroyEnable=!0:this.syncHistroyEnable=t.syncHistroyEnable,this.identifier=t.tlsData.identifier,this.classId=t.classId,this.user=t.tlsData.identifier,this.data={},this.progressEnable=i.PROGRESS_ENABLE,this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.pptFilePreloaded={},this.boardRatio={},this.dragDataList=new $,this.scale=this.options.scale||i.SCALE,this.ratio=this.options.ratio||i.RATIO,this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.color=0,this.thin=0,this.typeFace=i.TEXT_FONT_FAMILY,this.textSize=0,this.textColor="",this.fontStyle=i.TEXT_FONT_STYLE.NORMAL,this.smoothLevel=0,this.dataSyncEnable=!1,this.preloadDepth=0,this.globalBackgroundColor=0,this.type=null,this.transparent=!1,this.seq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.beforeMoveType="",this.containerWidth=0,this.containerHeight=0,this.boardWidth=0,this.boardHeight=0,this.ctx=null,this.boardContentFitMode=0,y.setSdkAppid(t.tlsData.sdkAppId),y.setRoomId(this.classId),y.setUserId(t.tlsData.identifier),this.applyPermissions(function(){}),this.initInterval(),this.cosData={cosAppId:null,cosBucket:null}}Q.prototype.applyPermissions=function(t){var e=this,r=l.getTimeStamp();this.request.applyPermissions().then(function(o){0===o.data.error_code&&o.data.level?(c.localTime=l.getTimeStamp(),c.serverTime=o.data.server_time,c.localServerTimeDiff=c.localTime-c.serverTime,e.permissions=o.data.level,e.request.setPermissions(e.permissions),e.cosData={cosAppId:o.data.cos_appid,cosBucket:o.data.cos_bucket},e.setDefaultBoard(),e.initData(e.options),t(),e.syncHistroyEnable&&e.classId&&e.syncHistroyData(),y.report("verify_sdk",{time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})}),e.event.fire(e,"TEB_INIT")):(c.localTime=l.getTimeStamp(),c.serverTime=o.data.server_time,c.localServerTimeDiff=c.localTime-c.serverTime,e.permissions=0,e.request.setPermissions(e.permissions),e.event.fire(e,"TEB_ERROR",x,"please purchase the service first"),e.setDefaultBoard(),e.initData(e.options),y.report("verify_sdk",{action_result:o.data.error_code,action_info:JSON.stringify(o.data),time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})})),e.setNeedDraw(!0)},function(t){c.localTime=l.getTimeStamp(),c.serverTime=l.getTimeStamp(),c.localServerTimeDiff=c.localTime-c.serverTime,e.permissions=0,e.request.setPermissions(e.permissions),e.event.fire(e,"TEB_ERROR",x,"please purchase the service first"),e.setDefaultBoard(),e.initData(e.options),y.report("verify_sdk",{action_result:-1,action_info:JSON.stringify(t),time_consume:l.getTimeStamp()-r,extra_info:JSON.stringify({permissions:e.permissions})}),e.setNeedDraw(!0)})},Q.prototype.createBoardIdForFile=function(t,e,r,o,i){for(var n=1,a=[],s=0;s<o;s++){var c="".concat(i,"_").concat(e,"_").concat(r,"_").concat(n++,"_").concat(t);a.push(c)}return a},Q.prototype.createBoardId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentGroup,e=arguments.length>1?arguments[1]:void 0;return 0==this.boardIdSeq?(this.boardIdSeq++,i.COMMON_DEFAULT_BOARD):(i.COMMON_GROUP,"".concat(i.PLATFORM,"_").concat(this.identifier,"_").concat(e||l.getSecondTime(),"_").concat(this.boardIdSeq++,"_").concat(t))},Q.prototype.initInterval=function(){var t=this;this.sendInterval=setInterval(function(){t.realTimeData.length>0&&t.sendRequest()},200)},Q.prototype.resetData=function(){this.data={},this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.seq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.beforeMoveType="",this.setDefaultBoard(),this.initData(this.options)},Q.prototype.initData=function(t){var e=this;this.setProgressEnable(t.progressEnable),this.setColor(t.brushColor),this.setThin(t.brushThin),this.setTextFontFamily(t.textFamily),this.setTextSize(t.textSize),this.setTextColor(t.textColor),this.setTextFontStyle(t.textStyle),this.setSmoothLevel(t.smoothLevel),this.setDataSyncEnable(t.dataSyncEnable),this.setPreloadDepth(t.preloadDepth),this.setBoardContentFitMode(t.boardContentFitMode,!1),"[object Undefined]"!==Object.prototype.toString.call(t.toolType)&&"[object Null]"!==Object.prototype.toString.call(t.toolType)||(t.toolType=1),this.setType(m.BOARD_ACTION_TYPE[["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"][t.toolType]]),this.setGlobalBackgroundColor(t.globalBackgroundColor,!0),this.setTransparent(t.transparent),this.setSelectArea(),setTimeout(function(){e.event.fire(e,"TEB_OPERATE_CANREDO_STATUS_CHANGED",e.canRedo()),e.event.fire(e,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",e.canUndo())},500)},Q.prototype.addBoard=function(t){var e=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=[];if(Array.isArray(t))o=t;else{if(!t)return;o=[t]}var n={};for(var a in o.forEach(function(t,r){e.userData[t]={},e.userData[t][e.identifier]=[],e.data[t]=[],e.opData[t]=[],e.opIndex[t]=0,e.backgroundColor[t]=e.globalBackgroundColor,e.backgroundPic[t]={url:"",user:t===i.COMMON_DEFAULT_BOARD?e.identifier:l.boardId2Uid(t),show:!0,mode:m.FILL_MODE.DEFAULT,type:m.BACKGROUND_TYPE.IMAGE},-1===e.boardList.indexOf(t)&&e.boardList.push(t);var o=l.boardId2Fid(t);n[o]||(n[o]=[]),n[o].push(t)}),n)this.event.fire(this,"TEB_ADDBOARD",n[a],a);return this.sortBoard(),r&&this.report.reportCreateBoards(this.currentBoard,o),this.boardList},Q.prototype.findLine=function(t,e,r){for(var o,i=this.userData[t][e],n=0,a=i.length;n<a;n++){var s=i[n];if("line"===s.type&&s.seq==r.belongSeq){o=s;break}}return o},Q.prototype.setNeedDraw=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.needDraw=t},Q.prototype.getNeedDraw=function(){return this.needDraw},Q.prototype.getBoardList=function(){return this.boardList},Q.prototype.getBoardPicList=function(){return this.backgroundPic},Q.prototype.setDefaultBoard=function(){this.currentGroup=i.COMMON_GROUP;var t=l.getSecondTime();this.addGroup(i.COMMON_GROUP,i.COMMON_GROUP,this.user,null,1,0,t,i.PLATFORM,i.FILE_TYPE.IMG,0),this.currentBoard=this.createBoardId(),this.addBoard(this.currentBoard,!1),this.setBackgroundColor(l.formatColor(this.globalBackgroundColor),!0),delete this.setDefaultBoard},Q.prototype.removeBoard=function(t){Array.isArray(t)||(t=[t]);for(var e=[],r=[],o=!1,n={},a=0,s=t.length;a<s;a++){var c,u=t[a];if(u!==i.COMMON_DEFAULT_BOARD&&(c=this.boardList.indexOf(u))>-1){e.push(u);var d=l.boardId2Fid(u);if(n[d]||(n[d]=[]),n[d].push(u),delete this.userData[u],delete this.data[u],delete this.opData[u],delete this.opIndex[u],delete this.backgroundColor[u],delete this.backgroundPic[u],u==this.currentBoard){o=!0;var h=this.getBoardByGroup(this.currentGroup),f=h.indexOf(u);if(this.currentBoard=0===f?h[f+1]:h[f-1],!this.currentBoard){var p=this.getBoardByGroup(i.COMMON_GROUP);this.currentBoard=p[this.getFileInfo(i.COMMON_GROUP).currentPageIndex]}}this.boardList.splice(c,1);var g=l.boardId2Fid(u),m=this.getBoardByGroup(g),_=this.getFileInfo(g);0===m.length?_&&(this.deleteGroup(g),r.push(g)):_&&(_.pageCount=_.pageCount-1,_.pageCount===_.currentPageIndex&&(_.currentPageIndex=_.currentPageIndex-1),this.updateFileInfo(_))}}var y=l.boardId2Fid(this.currentBoard),b=this.getBoardByGroup(y);for(var T in(_=this.getFileInfo(y))&&(_.pageCount=b.length,_.currentPageIndex=b.indexOf(this.currentBoard),this.updateFileInfo(_)),this.currentGroup=l.boardId2Fid(this.currentBoard),n)this.event.fire(this,"TEB_DELETEBOARD",n[T],T);return o&&this.event.fire(this,"TEB_GOTOBOARD",this.currentBoard,l.boardId2Fid(this.currentBoard)),this.setNeedDraw(!0),{deleteBoards:e,deleteFids:r}},Q.prototype.deleteBoard=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentBoard,e=arguments.length>1?arguments[1]:void 0,r=this.removeBoard(t)||[],o=r.deleteBoards,n=r.deleteFids;if(o.length){var a=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";a&&this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:a,time:l.getTimeStamp(),seq:c.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0});var s=[];e?n.indexOf(e)>-1?s=n:s.push(e):s=n;var u=this.getBoardByGroup(this.currentGroup),d=u.indexOf(this.currentBoard);this.realTimeData.push({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),toBoardId:this.currentBoard,deleteBoards:s.length?[]:o,deleteFiles:s.length?s:[],page:d,step:0}),this.report.reportDeleteBoard(o,this.currentBoard);var h=this.getFileInfo(this.currentGroup);h.currentPageIndex=d,h.currentPageStep=0,h.pageCount=u.length,this.report.reportAddFile(h)}return o},Q.prototype.getGroup=function(){var t=this,e=Object.assign([],this.groups);return e.forEach(function(e){var r=[];e.type===i.FILE_TYPE.IMG&&(t.getBoardByGroup(e.fid)||[]).forEach(function(e){var o=new D(e,t.backgroundPic[e],t.backgroundColor[e]);r.push(o)}),e.boardInfoList=r}),e},Q.prototype.getFileInfo=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.COMMON_GROUP,e=null,r=this.getGroup(),o=0,n=r.length;o<n;o++){var a=r[o];if(t===a.fid){e=a;break}}return e},Q.prototype.getBoardByGroup=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.COMMON_GROUP;return this.boardList.filter(function(e){return t===i.COMMON_GROUP&&e===i.COMMON_DEFAULT_BOARD||e.indexOf("_".concat(t))>-1})},Q.prototype.addGroupNotReport=function(t,e,r,o,n,a,s){for(var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i.PLATFORM,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:i.FILE_TYPE.IMG,u=arguments.length>9?arguments[9]:void 0,d=arguments.length>10?arguments[10]:void 0,h=arguments.length>11?arguments[11]:void 0,f=!1,p=0,g=this.groups.length;p<g;p++)if(this.groups[p].fid==t){f=!0;break}if(f)return this.groups;this.event.fire(this,"TEB_ADDTRANSCODEFILE",t);var m={fid:t,title:e||t,downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:u,uid:r,timestamp:s,platform:c,ratio:d,type:l,scale:h};return this.groups.push(m)},Q.prototype.addGroup=function(t,e,r,o,n,a,s){for(var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i.PLATFORM,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:i.FILE_TYPE.IMG,u=arguments.length>9?arguments[9]:void 0,d=arguments.length>10?arguments[10]:void 0,h=arguments.length>11?arguments[11]:void 0,f=!1,p=0,g=this.groups.length;p<g;p++)if(this.groups[p].fid==t){f=!0;break}if(f)return this.groups;this.event.fire(this,"TEB_ADDTRANSCODEFILE",t);var m={fid:t,title:e||t,downloadURL:o,pageCount:n,currentPageIndex:a,currentPageStep:u,uid:r,timestamp:s,platform:c,ratio:d,type:l,scale:h};return t&&t!==i.COMMON_GROUP&&this.report.reportAddFile(m),this.groups.push(m)},Q.prototype.deleteGroup=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t===i.COMMON_GROUP)return[];for(var r=-1,o=0,n=this.groups.length;o<n;o++)if(this.groups[o].fid==t){r=o;break}return r>-1&&(this.groups.splice(r,1),E.clearIframeCache(this.iframeDom)),e&&this.report.reportDeleteFile(t),this.getBoardByGroup(t)},Q.prototype.setColor=function(t){t||(t=m.COLOR.RED),this.cancelSelect(),"number"==typeof t?this.color=l.dealColor(t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.color=t):this.color=l.hexToRgba(t)},Q.prototype.getColor=function(){return this.color},Q.prototype.setThin=function(t){t||(t=i.THIN),this.cancelSelect(),this.thin=t},Q.prototype.getThin=function(){return this.thin},Q.prototype.setSmoothLevel=function(t){"[object Undefined]"!==Object.prototype.toString.call(t)&&"[object Null]"!==Object.prototype.toString.call(t)||(t=i.SMOOTH_LEVEL),t=Math.max(0,Math.min(1,t)),this.smoothLevel=t},Q.prototype.getSmoothLevel=function(){return this.smoothLevel},Q.prototype.setTextSize=function(t){t||(t=i.TEXT_SIZE),this.cancelSelect(),this.textSize=t},Q.prototype.getTextSize=function(){return this.textSize},Q.prototype.setTextColor=function(t){t||(t=i.TEXT_COLOR),this.cancelSelect(),"number"==typeof t?this.textColor=l.dealColor(t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.textColor=t):this.textColor=l.hexToRgba(t)},Q.prototype.getTextColor=function(){return this.textColor},Q.prototype.setTextFontFamily=function(t){t||(t=i.TEXT_FONT_FAMILY),this.cancelSelect(),this.typeFace=t},Q.prototype.getTextFontFamily=function(){return this.typeFace},Q.prototype.setTextFontStyle=function(t){t||(t=i.TEXT_FONT_STYLE.NORMAL),this.cancelSelect(),this.fontStyle=t},Q.prototype.getTextFontStyle=function(){return this.fontStyle},Q.prototype.setDataSyncEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.DATA_SYNC_ENABLE;this.request.setReportEnable(t),this.dataSyncEnable=t},Q.prototype.isDataSyncEnable=function(){return this.dataSyncEnable},Q.prototype.setProgressEnable=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.PROGRESS_ENABLE;this.progressEnable=t},Q.prototype.isProgressEnable=function(){return this.progressEnable},Q.prototype.setPreloadDepth=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.PRELOAD_DEPTH;this.preloadDepth=t},Q.prototype.setType=function(t){var e=Object.values(m.BOARD_ACTION_TYPE);this.cancelSelect(),e.indexOf(t)>-1?this.type=t:this.type=m.BOARD_ACTION_TYPE.LINE},Q.prototype.getType=function(){return this.type},Q.prototype.setTransparent=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.transparent=t},Q.prototype.getTransparent=function(){return this.transparent},Q.prototype.setBackgroundColor=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.COLOR.WHITE,e=arguments.length>1?arguments[1]:void 0,r=this.currentBoard;"object"===Z(t)&&(r=t.boardId,t=t.color);var o=0;"number"==typeof t?(this.backgroundColor[r]=l.dealColor(t),o=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.backgroundColor[r]=t,o=l.formatColor(t)):(this.backgroundColor[r]=l.hexToRgba(t),o=l.formatColor(l.hexToRgba(t))),this.setNeedDraw(!0),e||(this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),color:o,isGlobal:0}),this.report.reportSetBoardBgColor(r,o))},Q.prototype.getBackgroundColor=function(){return this.backgroundColor[this.getCurrentBoard()]},Q.prototype.setSelectArea=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.selectArea={x:t,y:e,width:r,height:o}},Q.prototype.getSelectArea=function(){return this.selectArea},Q.prototype.getCurrentBoard=function(){return this.currentBoard},Q.prototype.getCurrentFile=function(){return this.currentGroup},Q.prototype.getData=function(){return this.data},Q.prototype.getCurrentBoardData=function(){return{data:this.data[this.currentBoard],userData:this.userData[this.currentBoard],opData:this.opData[this.currentBoard],opIndex:this.opIndex[this.currentBoard],backgroundPic:this.backgroundPic[this.currentBoard],backgroundColor:this.backgroundColor[this.currentBoard],ratio:this.boardRatio[this.currentBoard],scale:this.getBoardScale()}},Q.prototype.getCurrentBoardPic=function(){return this.backgroundPic[this.currentBoard]},Q.prototype.getCurrentBoardColor=function(){return this.backgroundColor[this.currentBoard]},Q.prototype.getSelectList=function(){return this.selectedList},Q.prototype.clearBoard=function(t){this.currentBoard&&(this.data[this.currentBoard]=[],this.opData[this.currentBoard]=[],this.opIndex[this.currentBoard]=0,this.userData[this.currentBoard]={},this.userData[this.currentBoard][this.identifier]=[],t||(this.backgroundPic[this.currentBoard]={show:!1,mode:m.FILL_MODE.DEFAULT,url:"",type:m.BACKGROUND_TYPE.IMAGE,user:""},this.backgroundColor[this.currentBoard]=this.globalBackgroundColor),this.cancelSelect(),this.setNeedDraw(!0))},Q.prototype.clearFileDrawData=function(t){var e=this;t.forEach(function(t){(e.getBoardByGroup(t)||[]).forEach(function(t){e.data[t]=[],e.opData[t]=[],e.opIndex[t]=0,e.userData[t]={},e.userData[t][e.identifier]=[]})}),this.cancelSelect(),this.setNeedDraw(!0)},Q.prototype.clear=function(){this.clearBoard(),this.realTimeData.push({action:101,seq:c.getSeq()}),this.report.reportClear(this.currentBoard)},Q.prototype.clearDraws=function(){this.clearBoard(!0),this.realTimeData.push({action:102,seq:c.getSeq()}),this.report.reportClearDraws(this.currentBoard)},Q.prototype.clearFileDraws=function(t){var e=this;if(t){Array.isArray(t)||(t=[t]),this.clearFileDrawData(t);var r=[];t.forEach(function(t){r=r.concat(e.getBoardByGroup(t))}),this.realTimeData.push({action:i.PROTOCOL_ACTION.FILE_CLEAR_ACTION,seq:c.getSeq(),fids:t}),this.report.reportClearDraws(r)}},Q.prototype.clearAll=function(){this.report.reportCleanAll(),this.realTimeData.push({action:i.PROTOCOL_ACTION.RESET_DATA_ACTION,seq:c.getSeq()}),this.sendRequest(),this.resetData()},Q.prototype.addBackgroundPic=function(t){var e=this,r=t.boardIds,o=t.urls,n=t.type,a=void 0===n?m.BACKGROUND_TYPE.IMAGE:n,s=t.needReport,u=void 0===s||s,d=t.position,h=void 0===d?m.FILL_MODE.DEFAULT:d,f=[],p=[];if(Array.isArray(r)){if(!Array.isArray(o)||r.length!=o.length)return!1;f=r,p=o}else{if(Array.isArray(o))return!1;f=[r],p=[o]}var g=[];this.cancelSelect(),f.forEach(function(t,r){t===e.currentBoard&&u&&e.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:encodeURI(p[r]),time:l.getTimeStamp(),seq:c.getSeq(),mode:h,type:a,cleanBoard:0}),e.data[t]||e.addBoard(t),e.backgroundPic[t].url=p[r],e.backgroundPic[t].show=!0,e.backgroundPic[t].mode=h,e.backgroundPic[t].type=a,g.push({type:"image",seq:c.getSeq(),content:{fid:l.boardId2Fid(t),boardId:t,url:p[r],updateTime:l.getTimeStamp(),type:a,mode:h}})}),u&&this.report.reportImages(g),this.setNeedDraw(!0)},Q.prototype.setBackgroundPic=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.FILL_MODE.DEFAULT;t&&(this.cancelSelect(),this.addBackgroundPic({boardIds:this.currentBoard,urls:t,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1,position:e}),this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:l.getTimeStamp(),seq:c.getSeq(),mode:e,type:m.BACKGROUND_TYPE.IMAGE,cleanBoard:0}),this.report.reportImage(this.currentBoard,t,e))},Q.prototype.setBackgroundH5=function(t){this.cancelSelect(),this.addBackgroundPic({boardIds:this.currentBoard,urls:t,type:m.BACKGROUND_TYPE.H5,needReport:!1}),this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:l.getTimeStamp(),seq:c.getSeq(),mode:m.FILL_MODE.DEFAULT,type:m.BACKGROUND_TYPE.H5,cleanBoard:0}),this.report.reportImage(this.currentBoard,t,m.FILL_MODE.DEFAULT,m.BACKGROUND_TYPE.H5)},Q.prototype.updateCurrentFillMode=function(t){var e=this.backgroundPic[this.currentBoard];e&&e.url&&this.setBackgroundPic(e.url,t)},Q.prototype.deleteBackgroundPic=function(t){this.cancelSelect(),this.backgroundPic[t].show=!1,this.setNeedDraw(!0)},Q.prototype.cancelBackgroundPic=function(){this.cancelSelect(),this.deleteBackgroundPic(this.currentBoard),this.img.style.display="none",this.realTimeData.push({action:i.PROTOCOL_ACTION.DELETE_BG_IMG_ACTION,seq:this.getSeq()}),this.report.reportImage(this.currentBoard,"",0)},Q.prototype.clearGlobalBgColor=function(){this.setGlobalBackgroundColor(this.options.globalBackgroundColor)},Q.prototype.switchPage=function(){var t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t=(e=this.getBoardByGroup(this.getCurrentFile()))[r=Math.min(r,e.length-1)],this.switchBoard(t)},Q.prototype.switchH5Board=function(t){var e=t.fid,r=t.slideIndex,o=t.stepIndex;this.cancelSelect();var n=this.getBoardByGroup(e),a=this.getFileInfo(e),s=n[r];this.currentBoard=s,this.currentGroup=e,a.currentPageIndex=r,a.currentPageStep=o,a.pageCount=n.length;var u=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";return u&&this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:u,time:l.getTimeStamp(),seq:c.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0}),this.realTimeData.push({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),toBoardId:s,deleteBoards:[],deleteFiles:[],page:a.currentPageIndex,step:o}),this.sendRequest(),this.report.reportSwitchBoard(s),this.report.reportAddFile(a),this.event.fire(this,"TEB_GOTOBOARD",s,e),this.setNeedDraw(!0),s},Q.prototype.switchBoard=function(t){if(this.cancelSelect(),t&&!this.data[t])return!1;t||(t=this.createBoardId(),this.addBoard(t)),this.currentBoard=t,this.currentGroup=l.boardId2Fid(t);var e=this.getBoardByGroup(this.currentGroup),r=this.getFileInfo(this.currentGroup),o=e.indexOf(t),n=r.currentPageStep;r.currentPageIndex=o,r.currentPageStep=n,r.pageCount=e.length;var a=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";return a&&this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:a,time:l.getTimeStamp(),seq:c.getSeq(),mode:this.backgroundPic[this.currentBoard].mode,type:this.backgroundPic[this.currentBoard].type,cleanBoard:0}),this.realTimeData.push({action:i.PROTOCOL_ACTION.SWITCH_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),toBoardId:t,deleteBoards:[],deleteFiles:[],page:r.currentPageIndex,step:n}),this.sendRequest(),this.report.reportSwitchBoard(t),this.report.reportAddFile(r),this.event.fire(this,"TEB_GOTOBOARD",this.currentBoard,l.boardId2Fid(this.currentBoard)),this.setNeedDraw(!0),t},Q.prototype.setGlobalBackgroundColor=function(t,e){var r=this;t||(t=m.COLOR.WHITE);var o=0;"number"==typeof t?(this.globalBackgroundColor=l.dealColor(t),o=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length?"string"==typeof t&&t.startsWith("rgba(")&&(this.globalBackgroundColor=t,o=l.formatColor(t)):(this.globalBackgroundColor=l.hexToRgba(t),o=l.formatColor(l.hexToRgba(t))),this.boardList.forEach(function(t){r.backgroundColor[t]=r.globalBackgroundColor}),this.setNeedDraw(!0),e||(this.realTimeData.push({action:i.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),color:o,isGlobal:1}),this.report.reportGlobalBgColor(o))},Q.prototype.getGlobalBackgroundColor=function(){return this.globalBackgroundColor},Q.prototype.preloadBoard=function(){for(var t=[],e=0;e<this.groups.length;++e){var r=this.groups[e];if(r.type!==i.FILE_TYPE.H5){var o=this.getBoardByGroup(r.fid);t=t.concat(o)}else if(!this.pptFilePreloaded[r.fid]){if(r.fid===this.currentGroup){this.pptFilePreloaded[r.fid]=!0;continue}!function(t,e){setTimeout(function(){var e=document.createElement("iframe");e.setAttribute("style","position:fixed;visibility:hidden;width:0px;height:0px;border:none;"),document.body.appendChild(e),e.onload=function(){e.remove()},e.setAttribute("src",t)},1e3)}(r.downloadURL),this.pptFilePreloaded[r.fid]=!0}}for(var n=t.indexOf(this.currentBoard),a=-this.preloadDepth;a<this.preloadDepth;++a){var s=n+a;if(!(s<0||s>=t.length)){var c=t[s],l=this.backgroundPic[c];if(l&&!l.preloaded&&void 0!==l.url&&""!==l.url){if(0===a){l.preloaded=!0;continue}l.type===m.BACKGROUND_TYPE.IMAGE?function(t,e){setTimeout(function(){var e=new Image;e.onload=function(){},e.onabort=function(){},e.onerror=function(){},e.src=t},e)}(l.url,200*(Math.abs(a)-1)):l.type===m.BACKGROUND_TYPE.H5&&function(t,e){setTimeout(function(){var e=document.createElement("iframe");e.setAttribute("style","position:fixed;visibility:hidden;width:0px;height:0px;border:none;"),document.body.appendChild(e),e.onload=function(){e.remove()},e.setAttribute("src",t)},e)}(l.url,200*(Math.abs(a)-1)),l.preloaded=!0}}}},Q.prototype.resetOperation=function(){this.opData[this.currentBoard]=this.opData[this.currentBoard].slice(0,this.opIndex[this.currentBoard])},Q.prototype.collectLineData=function(){var t=this;return{start:function(e,r){var o=c.getSeq();t.belongLineSeq=o;var a=new d(t.identifier,{color:t.color,thin:t.thin,x:e,y:r,show:!0,seq:o,belongSeq:o});t.userData[t.currentBoard][t.identifier].push(a),t.data[t.currentBoard].push(a),t.opData[t.currentBoard].push(new n(t.identifier,{seq:a.seq,type:t.type})),t.opIndex[t.currentBoard]++;var s={action:i.PROTOCOL_ACTION.LINE_START_ACTION,color:l.formatColor(a.color),scale:100,thin:a.thin,time:l.getTimeStamp(),seq:a.seq,belongSeq:a.belongSeq,x:e,y:r};t.realTimeData.push(s)},draw:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1];n.setBorder(e,r);var a=c.getSeq();n.lines.push({x:e,y:r,seq:a});var s={action:i.PROTOCOL_ACTION.LINE_MOVE_ACTION,seq:a,belongSeq:t.belongLineSeq,x:e,y:r};t.realTimeData.push(s)},end:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1];n.setBorder(e,r);var a=c.getSeq();if(n.lines.push({x:e,y:r,seq:a}),t.smoothLevel>0){var s=[];n.lines.forEach(function(t){s.push([t.x,t.y])}),n.fitCurve=V(s,1e4*t.smoothLevel,null)}var u={action:i.PROTOCOL_ACTION.LINE_END_ACTION,belongSeq:t.belongLineSeq,seq:a,x:e,y:r};t.realTimeData.push(u),t.setNeedDraw(!0);var d=[];n.lines.forEach(function(t){d.push({seq:t.seq,x:t.x,y:t.y})}),t.currentBoard,t.identifier,l.formatColor(t.color),t.thin,n.time,l.getTimeStamp(),n.seq,t.report.reportAddLine({boardId:t.currentBoard,uid:n.user,colorRGBA:l.formatColor(t.color),scale:100,width:t.thin,time:n.time,updateTime:l.getTimeStamp(),seq:n.seq,hidden:0,points:d})},over:function(t,e){this.end(t,e)}}},Q.prototype.collectTextInputData=function(){var t=this;return{start:function(e,r){var o,i=c.getSeq();try{var a=t.data[t.currentBoard],s={seq:0,index:-1};if(a.forEach(function(o,i){if("inputtext"===o.type&&o.show&&o.user===t.identifier){var n=5/t.boardWidth*1e4,a=5/t.boardHeight*1e4,c=o.location.x-n,l=o.location.y-a,u=o.location.x+o.textWidth/t.boardWidth*1e4+n,d=o.location.y+o.textHeight/t.boardHeight*1e4+a;e>=c&&e<=u&&r>=l&&r<=d&&o.belongSeq>s.seq&&(s={seq:o.belongSeq,index:i})}}),s.index>-1){var l=t.data[t.currentBoard].splice(s.index,1)[0];l.show=!1,t.setNeedDraw(!0),o=l,(t.userData[t.currentBoard][t.identifier]||[]).forEach(function(e,r){e.belongSeq===o.belongSeq&&t.userData[t.currentBoard][t.identifier].splice(r,1)})}}catch(t){}o||((o=new g(t.identifier,{x:e,y:r,belongSeq:i})).color=t.getTextColor(),o.textSize=t.getTextSize(),o.typeFace=t.getTextFontFamily(),o.fontStyle=t.getTextFontStyle()),t.userData[t.currentBoard][t.identifier].push(o),t.data[t.currentBoard].push(o);for(var u=!1,d=0,h=t.opData[t.currentBoard].length;d<h;d++)if(t.opData[t.currentBoard][d].seq===o.belongSeq){u=!0;break}return u||(t.opData[t.currentBoard].push(new n(t.identifier,{seq:o.belongSeq,type:t.type})),t.opIndex[t.currentBoard]++),o},inputting:function(e,r,o){var n=t.userData[t.currentBoard][t.identifier].length,a=t.userData[t.currentBoard][t.identifier][n-1],s=c.getSeq();a.text=e,a.seq=s,a.textWidth=r,a.textHeight=o;var u={action:i.PROTOCOL_ACTION.INPUT_TEXT_ACTION,seq:s,belongSeq:a.belongSeq,color:l.formatColor(a.color),scale:100,typeFace:a.typeFace,textSize:Math.floor(a.textSize),fontStyle:a.fontStyle,time:l.getTimeStamp(),x:a.location.x,y:a.location.y,text:e};t.realTimeData.push(u)},draw:function(e){var r=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][r-1];if(!e&&!e.trim()){for(var i=-1,n=0,a=t.opData[t.currentBoard].length;n<a;n++)if(t.opData[t.currentBoard][n].seq===o.belongSeq){i=n;break}return i>-1&&(t.opData[t.currentBoard].splice(i,1),t.opIndex[t.currentBoard]--),t.userData[t.currentBoard][t.identifier].splice(r-1,1),void t.data[t.currentBoard].splice(t.data[t.currentBoard].length-1,1)}o.text=e,o.show=!0,t.report.reportAddText({belongSeq:o.belongSeq,time:o.time,boardId:t.currentBoard,uid:o.user,x:Math.floor(o.location.x),y:Math.floor(o.location.y),colorRGBA:l.formatColor(o.color),scale:100,updateTime:l.getTimeStamp(),hidden:0,typeface:o.typeFace,textSize:Math.floor(o.textSize),fontStyle:o.fontStyle,text:e}),t.setNeedDraw(!0)}}},Q.prototype.collectEraserData=function(t,e){var r=this.eraserImpactCheck(t,e,this.thin/2);if(r.length>0){this.opData[this.currentBoard].push(new n(this.identifier,{seq:r,type:this.type})),this.opIndex[this.currentBoard]++;var o={action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),x:0,y:0,lines:r};r.length&&(this.realTimeData.push(o),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:r})),this.setNeedDraw(!0)}},Q.prototype.collectRaserData=function(){var t=this;return{start:function(e,r){var o=new p(t.identifier,{color:l.dealColor(m.COLOR.RED),radius:t.thin/2,x:e,y:r,seq:c.getSeq()});t.seq=o.seq,t.userData[t.currentBoard][t.identifier].push(o),t.data[t.currentBoard].push(o);var n={action:i.PROTOCOL_ACTION.RASER_SHOW_ACTION,r:o.radius,seq:o.seq,x:e,y:r};t.realTimeData.push(n),t.setNeedDraw(!0)},draw:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1];n.location={x:e,y:r},t.setNeedDraw(!0),t.realTimeData.push({action:i.PROTOCOL_ACTION.RASER_SHOW_ACTION,seq:c.getSeq(),x:e,y:r,r:n.radius})},end:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,n=t.userData[t.currentBoard][t.identifier][o-1];n.point={x:e,y:r},n.status=0;var a={action:i.PROTOCOL_ACTION.RASER_HIDE_ACTION,seq:n.seq};t.realTimeData.push(a),t.setNeedDraw(!0)},over:function(){var e=t.userData[t.currentBoard][t.identifier].length;t.userData[t.currentBoard][t.identifier][e-1].status=0,t.setNeedDraw(!0)}}},Q.prototype.collectSelectData=function(){var t=this;return{start:function(e,r){t.beforeMoveType="select";var o=new f(t.identifier,{startx:e,starty:r,x:e,y:r});t.seq=o.seq,t.userData[t.currentBoard][t.identifier].push(o),t.data[t.currentBoard].push(o)},draw:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length;t.userData[t.currentBoard][t.identifier][o-1].location={x:e,y:r},t.setNeedDraw(!0)},end:function(e,r,o,i){for(var n=e>o?e:o,a=r>i?r:i,s=e+o-n,c=r+i-a,l=t.data[t.currentBoard].length-1;l>=0;l--){var u=t.data[t.currentBoard][l];if("line"==u.type&&u.show)n>=u.border.maxX&&a>=u.border.maxY&&s<=u.border.minX&&c<=u.border.minY&&(u.select=!0,t.selectedList.push(u));else if("graph"==u.type&&u.show)n>=u.endPoint.x&&a>=u.endPoint.y&&s<=u.startPoint.x&&c<=u.startPoint.y&&(u.select=!0,t.selectedList.push(u));else if("inputtext"==u.type&&u.show&&u.text){var d=u.location.x,h=u.location.y,f=u.location.x+u.textWidth/t.boardWidth*1e4,p=u.location.y+u.textHeight/t.boardHeight*1e4;n>=f&&a>=p&&s<=d&&c<=h&&(u.select=!0,t.selectedList.push(u))}}t.selectArea={x:s,y:c,width:n-s,height:a-c},t.userData[t.currentBoard][t.identifier][t.userData[t.currentBoard][t.identifier].length-1].show=!1,t.setNeedDraw(!0)}}},Q.prototype.collectPointSelectData=function(t,e){this.beforeMoveType="pointselect";for(var r=!1,o=this.data[this.currentBoard].length-1;o>=0;o--){var i=this.data[this.currentBoard][o];if("line"==i.type&&i.show){if(t<i.border.maxX&&t>i.border.minX&&e<i.border.maxY&&e>i.border.minY){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:i.border.minX,y:i.border.minY,width:i.border.maxX-i.border.minX,height:i.border.maxY-i.border.minY};break}}else if("graph"==i.type&&i.show){var n=i.endPoint.x,a=i.endPoint.y,s=i.startPoint.x,c=i.startPoint.y;if(n<s&&(n+=s,n-=s=n-s),a<c&&(a+=c,a-=c=a-c),a+=this.thin,n+=this.thin,s-=this.thin,c-=this.thin,t>=s&&t<=n&&e>=c&&e<=a){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:s,y:c,width:n-s,height:a-c};break}}else if("inputtext"===i.type&&i.show&&i.text){var l=5/this.boardWidth*1e4,u=5/this.boardHeight*1e4,d=i.location.x-l,h=i.location.y-u,f=i.location.x+i.textWidth/this.boardWidth*1e4+l,p=i.location.y+i.textHeight/this.boardHeight*1e4+u;if(t>=d&&t<=f&&e>=h&&e<=p){r=!0,i.select=!0,this.selectedList=[i],this.selectArea={x:d,y:h,width:f-d,height:p-h};break}}}r&&this.setNeedDraw(!0)},Q.prototype.collectMoverData=function(){var t=this;return{beforeStart:function(e,r){if(0==t.selectedList.length)return!1;for(var o=!1,i=0;i<t.selectedList.length;i++){var n=t.selectedList[i];if("line"==n.type){var a=1.5*t.thin,s=1.5*t.thin;if(n.border.minX-a<=e&&n.border.maxX+a>=e&&n.border.minY-s<=r&&n.border.maxY+s>=r){o=!0;break}}else if("graph"==n.type){var c=n.startPoint.x,l=n.endPoint.x,u=n.startPoint.y,d=n.endPoint.y;if(l<c&&(l+=c,l-=c=l-c),d<u&&(d+=u,d-=u=d-u),d+=t.thin,l+=t.thin,u-=t.thin,(c-=t.thin)<=e&&l>=e&&u<=r&&d>=r){o=!0;break}}else if("inputtext"===n.type){var h=5/t.boardWidth*1e4,f=5/t.boardHeight*1e4,p=n.location.x-h,g=n.location.y-f,m=n.location.x+n.textWidth/t.boardWidth*1e4+h,_=n.location.y+n.textHeight/t.boardHeight*1e4+f;if(e>=p&&e<=m&&r>=g&&r<=_){o=!0;break}}}return!!o||(t.cancelSelect(),!1)},start:function(e,r){var o=[];t.selectedList.forEach(function(t){"line"==t.type?o.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type?o.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y}):"inputtext"==t.type&&o.push({uid:t.user,seq:t.belongSeq,x:t.location.x,y:t.location.y})}),t.opData[t.currentBoard].push(new n(t.identifier,{seq:{origin:o,final:[]},type:"move"}))},draw:function(e,r,o,i){if(t.selectedList.length>0){for(var n=0;n<t.selectedList.length;n++){var a=t.selectedList[n],s=e-o,c=r-i;"line"==a.type?(a.border.maxX+=s,a.border.minX+=s,a.border.maxY+=c,a.border.minY+=c,a.lines.forEach(function(t){t.x+=s,t.y+=c}),0!==a.fitCurve.length&&a.fitCurve.forEach(function(t){t[1][0]+=s,t[1][1]+=c,t[2][0]+=s,t[2][1]+=c,t[3][0]+=s,t[3][1]+=c})):"graph"==a.type?(a.startPoint.x+=s,a.startPoint.y+=c,a.endPoint.x+=s,a.endPoint.y+=c):"inputtext"===a.type&&(a.location.x+=s,a.location.y+=c)}t.selectArea.x+=s,t.selectArea.y+=c,t.setNeedDraw(!0)}},end:function(){t.setNeedDraw(!0);var e=[];if(0!=t.selectedList.length){t.selectedList.forEach(function(t){"line"==t.type?e.push({seq:t.seq,x:t.lines[0].x,y:t.lines[0].y,uid:t.user}):"graph"==t.type?e.push({seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y,uid:t.user}):"inputtext"===t.type&&e.push({seq:t.belongSeq,x:t.location.x,y:t.location.y,uid:t.user})});var r={action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,seq:c.getSeq(),moves:e,time:l.getTimeStamp()};t.realTimeData.push(r);var o=[];t.selectedList.forEach(function(t){"line"==t.type?o.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type?o.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y}):"inputtext"===t.type&&o.push({uid:t.user,seq:t.belongSeq,x:t.location.x,y:t.location.y})}),t.opData[t.currentBoard][t.opData[t.currentBoard].length-1].seq.final=o,t.opIndex[t.currentBoard]++;var n=[];e.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];if("line"==i.type&&e.seq==i.seq){var a=[];i.lines.forEach(function(t){a.push({seq:t.seq,x:t.x,y:t.y})}),n.push({type:"addLine",seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),seq:i.seq,hidden:0,points:a}})}else if("graph"==i.type&&e.seq==i.startPoint.seq){var s={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),hidden:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}};"oval"==i.graph||"circle"==i.graph?s.content.fillRect=i.solid?1:0:"rect"==i.graph&&(s.content.fillRect=i.solid?1:0,s.content.cornerRadius=0),n.push(s)}else"inputtext"===i.type&&e.seq==i.belongSeq&&n.push({type:"addText",seq:c.getSeq(),content:{belongSeq:i.belongSeq,time:l.getTimeStamp(),boardId:t.currentBoard,uid:i.user,x:i.location.x,y:i.location.y,colorRGBA:l.formatColor(i.color),scale:i.scale,updateTime:l.getTimeStamp(),hidden:0,typeface:i.typeFace,textSize:i.textSize,fontStyle:i.fontStyle,text:i.text}})}}),t.report.reportGraphData(n)}}}},Q.prototype.collectGraphData=function(){var t=this;return{start:function(e,r){var o=t.type.split("-")[1],i=new h(t.identifier,{graph:o,color:t.color,thin:t.thin,seq:c.getSeq(),beginPoint:{x:e,y:r,seq:c.getSeq()},endPoint:{x:e,y:r,seq:c.getSeq()},show:!0,solid:t.type.indexOf("solid")>-1});t.seq=i.seq,t.userData[t.currentBoard][t.identifier].push(i),t.data[t.currentBoard].push(i),t.opData[t.currentBoard].push(new n(t.identifier,{seq:i.startPoint.seq,type:"graph"})),t.opIndex[t.currentBoard]++},draw:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,i=t.userData[t.currentBoard][t.identifier][o-1];i.endPoint.x=e,i.endPoint.y=r,"circle"==i.graph&&t.circleFix(i),t.setNeedDraw(!0)},end:function(e,r){var o=t.userData[t.currentBoard][t.identifier].length,i=t.userData[t.currentBoard][t.identifier][o-1];i.endPoint.x=e,i.endPoint.y=r,"circle"==i.graph&&t.circleFix(i),"line"!=i.graph&&t.graphFix(i),t.setNeedDraw(!0);var n={seq:i.seq,time:l.getTimeStamp(),color:l.formatColor(t.color),scale:100,thin:t.thin,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}};n.action={line:10,oval:11,circle:11,rect:12}[i.graph];var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(t.color),scale:100,width:t.thin,time:i.time,updateTime:l.getTimeStamp(),hidden:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}},s=t.type.indexOf("solid")>-1?1:0;n.action>10&&(n.fillRect=s,a.content.fillRect=s),12==n.action&&(n.cornerRadius=0,a.content.cornerRadius=0),t.realTimeData.push(n),t.report.reportGraphData([a])},over:function(t,e){this.end(t,e)}}},Q.prototype.collectDragData=function(){var t=this;return{start:function(t){var e=t.currentTarget.getElementsByClassName("tx_board_canvas_box")[0];getComputedStyle(e).getPropertyValue("transform"),e.style.left,e.style.top},draw:function(e,r,o,i,n){var a,s,c,l,u=e.currentTarget.getElementsByClassName("tx_board_canvas_box")[0],d=o-n,h=(r-i)/t.boardWidth*100,f=d/t.boardHeight*100;t.boardWidth/t.boardHeight>t.containerWidth/t.containerHeight?(t.boardHeight>t.containerHeight?(c=50+(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,l=50-(t.boardHeight-t.containerHeight)/2/t.boardHeight*100):(c=50,l=50),a=50+(t.boardWidth-t.containerWidth)/2/t.boardWidth*100,s=50-(t.boardWidth-t.containerWidth)/2/t.boardWidth*100):(c=50+(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,l=50-(t.boardHeight-t.containerHeight)/2/t.boardHeight*100,t.boardWidth>t.containerWidth?(a=50+(t.boardWidth-t.containerWidth)/2/t.boardWidth*100,s=50-(t.boardWidth-t.containerWidth)/2/t.boardWidth*100):(a=50,s=50));var p=1*u.style.left.replace("%","")+h;p=Math.min(a,Math.max(s,p)),u.style.left=p+"%";var g=1*u.style.top.replace("%","")+f;g=Math.min(c,Math.max(l,g)),u.style.top=g+"%";var m=u.getAttribute("style");-1===m.indexOf("-webkit-transform")&&(m+="-webkit-transform: translateX(-50%) translateY(-50%);"),u.setAttribute("style",m),t.dragDataList.getDragData(t.currentBoard)?t.dragDataList.updateDragData(t.currentBoard,{xOffset:p,yOffset:g}):t.dragDataList.addDragData(t.currentBoard,new X({scale:t.getBoardScale(),xOffset:p,yOffset:g})),t.realTimeData.push(t.dragDataList.getDragData(t.currentBoard).getRealTimeData())},scaleDraw:function(e,r){if(r.length){var o,n=t.dragDataList.getDragData(t.currentBoard);n&&(o=parseInt(e*r[r.length-1]),o=Math.max(i.MIN_SCALE,Math.min(i.MAX_SCALE,o)),n.scale=o),t.setNeedDraw(!0)}},end:function(){t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))},touchEnd:function(e){if(e.length){var r=t.dragDataList.getDragData(t.currentBoard);t.setBoardScale(r.scale)}else t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))},over:function(){t.report.reportDrag(Object.assign(t.dragDataList.getDragData(t.currentBoard).getReportData(),{boardId:t.currentBoard}))}}},Q.prototype.cancelSelect=function(){for(var t=this.selectedList.length,e=0;e<t;e++)this.selectedList[e].select=!1;this.selectedList=[],this.selectArea={x:0,y:0,width:0,height:0},t&&this.setNeedDraw(!0)},Q.prototype.eraserImpactCheck=function(t,e,r){var o=this,i=[];return this.data[this.currentBoard].forEach(function(n){var a=n.thin/2;if("line"==n.type&&n.show){var s=n.border.maxX+a,c=n.border.maxY+a,l=n.border.minX-a,u=n.border.minY-a,d=0;if(t+r<l||t-r>s||e+r<u||e-r>c)return;var h=!1;if(1===n.lines.length){var f=n.lines[0];o.getDistance(t,e,f.x,f.y,f.x,f.y)<=(r+a)*(r+a)&&(h=!0)}else for(var p=1;p<n.lines.length;p++){var g=n.lines[p-1],m=n.lines[p];if(o.getDistance(t,e,g.x,g.y,m.x,m.y)<=(r+a)*(r+a)){h=!0;break}}h&&(n.show=!1,i.push({uid:n.user,seq:n.seq}))}else if("graph"==n.type&&n.show){if("line"==n.graph)(d=o.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.endPoint.x,n.endPoint.y))<=(r+a)*(r+a)&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}));else if("rect"==n.graph)if(n.solid)t>n.startPoint.x&&e>n.startPoint.y&&t<n.endPoint.x&&e<n.endPoint.y&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}));else{var _=o.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.startPoint.x,n.endPoint.y),y=o.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.endPoint.x,n.startPoint.y),b=o.getDistance(t,e,n.endPoint.x,n.endPoint.y,n.startPoint.x,n.endPoint.y),T=o.getDistance(t,e,n.endPoint.x,n.endPoint.y,n.endPoint.x,n.startPoint.y);Math.min(_,y,b,T)<=(r+a)*(r+a)&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}))}else if("circle"==n.graph){var v=(n.startPoint.x+n.endPoint.x)/2,C=(n.startPoint.y+n.endPoint.y)/2,E=Math.sqrt(Math.pow(n.startPoint.x-n.endPoint.x,2)+Math.pow(n.startPoint.y-n.endPoint.y,2))/2;d=Math.sqrt(Math.pow(t-v,2)+Math.pow(e-C,2)),n.solid?d<E+r&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq})):Math.abs(E-d)<=r+a&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}))}else if("oval"==n.graph){var S=(n.startPoint.x+n.endPoint.x)/2,D=(n.startPoint.y+n.endPoint.y)/2,A=Math.abs(n.startPoint.x-n.endPoint.x)/2,O=Math.abs(n.startPoint.y-n.endPoint.y)/2;if(A===O&&0===A)return;var x=Math.pow(t-S,2)/Math.pow(A,2)+Math.pow(e-D,2)/Math.pow(O,2),R=Math.pow(t-S+a,2)/Math.pow(A,2)+Math.pow(e-D+a,2)/Math.pow(O,2),B=Math.pow(t-S+a,2)/Math.pow(A,2)+Math.pow(e-D-a,2)/Math.pow(O,2),I=Math.pow(t-S-a,2)/Math.pow(A,2)+Math.pow(e-D+a,2)/Math.pow(O,2),P=Math.pow(t-S-a,2)/Math.pow(A,2)+Math.pow(e-D-a,2)/Math.pow(O,2);n.solid?(x<=1.2||R<=1.2||B<=1.2||I<=1.2||P<=1.2)&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq})):(x<=1.2&&x>=.8||R<=1.2&&R>=.8||B<=1.2&&B>=.8||I<=1.2&&I>=.8||P<=1.2&&P>=.8)&&(n.show=!1,i.push({uid:n.user,seq:n.startPoint.seq}))}}else if("inputtext"==n.type&&n.show){var w=n.location.x-0,N=n.location.y-0,L=n.location.x+n.textWidth/o.boardWidth*1e4+0,k=n.location.y+n.textHeight/o.boardHeight*1e4+0;t>w&&e>N&&t<L&&e<k&&(n.show=!1,i.push({uid:n.user,seq:n.belongSeq}))}}),i},Q.prototype.getDistance=function(t,e,r,o,i,n){var a,s,c=i-r,l=n-o,u=c*c+l*l,d=-1;0!=u&&(d=((t-r)*c+(e-o)*l)/u),d<0?(a=r,s=o):d>1?(a=i,s=n):(a=r+d*c,s=o+d*l);var h=t-a,f=e-s;return h*h+f*f},Q.prototype.circleFix=function(t){var e=Math.abs(t.startPoint.x-t.endPoint.x)*this.boardWidth/1e4,r=Math.abs(t.startPoint.y-t.endPoint.y)*this.boardHeight/1e4;e>r?(t.endPoint.x=t.startPoint.x<t.endPoint.x?t.startPoint.x+1e4*r/this.boardWidth:t.startPoint.x-1e4*r/this.boardWidth,t.endPoint.x=parseInt(t.endPoint.x)):(t.endPoint.y=t.startPoint.y<t.endPoint.y?t.startPoint.y+1e4*e/this.boardHeight:t.startPoint.y-1e4*e/this.boardHeight,t.endPoint.y=parseInt(t.endPoint.y))},Q.prototype.graphFix=function(t){var e=t.startPoint.x,r=t.startPoint.y,o=t.endPoint.x,i=t.endPoint.y;t.startPoint={x:e>o?o:e,y:r>i?i:r,seq:t.startPoint.seq},t.endPoint={x:e>o?e:o,y:r>i?r:i,seq:t.endPoint.seq}},Q.prototype.sendRequest=function(){if(this.dataSyncEnable){if(this.permissions){var t=JSON.parse(JSON.stringify(this.realTimeData)),e={seq:c.getSeq(),timestamp:l.getTimeStamp(),value:{boardId:this.currentBoard,operator:this.identifier,actions:t}};this.realTimeData=[],this.event.fire(this,"TEB_SYNCDATA",e)}}else this.realTimeData=[]},Q.prototype.addHistory=function(t){var e=this,r=this;this.sortBoard(),t.forEach(function(t){var o,n;if(t.content=JSON.parse(t.content),"setGlobalBG"===t.type);else if("createBoards"===t.type)t.content&&t.content.createBoards.forEach(function(t){(o=t)&&!r.userData[o]&&r.addBoard(o,!1)});else if("addFile"===t.type){for(var a=t.content.fid,s=t.content.title,c=t.content.downloadURL,u=t.content.pageCount,f=t.content.currentPageIndex,p=t.content.currentPageStep||0,_=t.content.timestamp,b=t.content.uid,T=t.content.platform,v=t.content.type,C=t.content.ratio,E=t.content.scale,S=!1,D=0,A=r.groups.length;D<A;D++){var O=r.groups[D];if(O.fid==a){O.title=s,O.downloadURL=c,O.pageCount=u,O.currentPageIndex=f,O.currentPageStep=p,O.timestamp=_,O.uid=b,O.type=v,O.ratio=C,O.scale=E,S=!0;break}}if(S?S&&a===i.COMMON_GROUP&&r.event.fire(e,"TEB_ADDFILE",a):r.addGroupNotReport(a,s,b,c,u,f,_,T,v,p,C,E),!_&&!b)return;if(a!=i.COMMON_GROUP){for(var x=[],R=r.createBoardIdForFile(a,b,_,u,T),B=[],I=c?l.fileDownLoadUrlToPreviewUrl(c):"",P=0;P<u;P++)o=R[P],I&&(I.endsWith("/")?B.push("".concat(I).concat(P+1,".jpg")):B.push(I+(P+1))),o&&!r.userData[o]&&x.push(o);r.addBoard(x),v==i.FILE_TYPE.IMG&&c&&r.addBackgroundPic({boardIds:R,urls:B,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1})}r.sortGroup()}else o=t.content.boardId,n=t.content.uid,o&&!r.userData[o]&&r.addBoard(o,!1),o&&!r.userData[o][n]&&(r.userData[o][n]=[]);if(t.content.colorRGBA&&(t.content.color=l.dealColor(t.content.colorRGBA)),t.content.width&&(t.content.thin=t.content.width),"addLine"==t.type){for(var w,N=0;N<t.content.points.length;N++){var L=t.content.points[N].x,k=t.content.points[N].y,q=t.content.points[0].seq;0==N?w=new d(n,{color:t.content.color,thin:t.content.thin,x:L,y:k,seq:t.content.points[N].seq,belongSeq:q,show:!t.content.hidden}):(w.lines.push({x:L,y:k,belongSeq:q,seq:t.content.points[N].seq}),N==t.content.points.length-1&&(w.sort(),w.endSeq=t.content.points[N].seq)),w.setBorder(L,k)}w&&(r.userData[o][n].push(w),r.data[o].push(w))}else if("addText"==t.type){var M=new g(n,{belongSeq:t.content.belongSeq,x:t.content.x,y:t.content.y});M.seq=t.content.belongSeq,M.scale=t.content.scale,M.color=t.content.color,M.typeFace=t.content.typeface,M.textSize=t.content.textSize,M.fontStyle=t.content.fontStyle,M.time=t.content.time,M.text=unescape(decodeURI(t.content.text)),M.show=!t.content.hidden,r.userData[o][n].push(M),r.data[o].push(M)}else if("displayLine"==t.type)t.content.lines.forEach(function(e){for(var o=0;o<r.userData[r.currentBoard][n].length;o++){var i=r.userData[r.currentBoard][n][o];"line"==i.type&&i.startSeq==e.seq?i.show=!!t.content.display:"graph"==i.type&&i.startPoint.seq==e.seq?i.show=!!t.content.display:"inputtext"==i.type&&i.belongSeq==e.seq&&(i.show=!!t.content.display)}});else if("addPatternLine"==t.type||"addPatternCircle"==t.type||"addPatternRectangle"==t.type){t.content.graph={addPatternLine:"line",addPatternCircle:"oval",addPatternRectangle:"rect"}[t.type],t.content.seq=t.content.beginPoint.seq,t.content.show=!t.content.hidden,t.content.solid=!!t.content.fillRect;var F=new h(n,t.content);r.userData[o][n].push(F),r.data[o].push(F)}else if("image"==t.type)t.content.url?r.addBackgroundPic({boardIds:t.content.boardId,urls:t.content.url,type:t.content.type,needReport:!1,position:t.content.mode}):r.deleteBackgroundPic(t.content.boardId);else if("clean"==t.type)r.clearBoard(!1);else if("cleanDraws"==t.type)r.clearBoard(!0);else if("switchBoard"==t.type){if(!o)return;(1*t.seq||0)>r.maxSeq?(r.maxSeq=t.seq,r.data[o]||r.addBoard(o,!1),r.currentBoard=o,o===i.COMMON_DEFAULT_BOARD?r.currentGroup=i.COMMON_GROUP:r.currentGroup=o.match(/\d+_#\w+$/)[0].split("_")[1],r.event.fire(e,"TEB_GOTOBOARD",o,l.boardId2Fid(o))):y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:r.maxSeq,boardId:o,method:"addHistory"})})}else if("setBoardBG"==t.type)r.setBackgroundColor({boardId:o,color:t.content.colorRGBA},!0);else if("setGlobalBG"==t.type)r.setGlobalBackgroundColor(t.content.colorRGBA,!0);else if("drag"==t.type)e.dragDataList.addDragData(o,new X({scale:t.content.scale,xOffset:t.content.xOffset,yOffset:t.content.yOffset}));else if("setRatio"==t.type){var U=t.content||{};for(var G in U)e.boardRatio[G]=U[G]}}),r.setNeedDraw(!0)},Q.prototype.undo=function(){var t=this;this.cancelSelect();var e=this.opData[this.currentBoard][this.opIndex[this.currentBoard]-1];if(e){if("line"==e.type)for(var r=0;r<this.userData[this.currentBoard][e.user].length;r++){var o=this.userData[this.currentBoard][e.user][r];if(e.seq==o.seq){o.show=!1,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("eraser"==e.type)e.seq.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];"line"==i.type&&e.seq==i.seq?i.show=!0:"graph"==i.type&&e.seq==i.startPoint.seq?i.show=!0:"inputtext"==i.type&&e.seq==i.belongSeq&&(i.show=!0)}}),this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:l.getTimeStamp(),seq:c.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:1,lines:e.seq});else if("graph"==e.type)for(var n=0;n<this.userData[this.currentBoard][e.user].length;n++){var a=this.userData[this.currentBoard][e.user][n];if("graph"==a.type&&e.seq==a.startPoint.seq){a.show=!1,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("inputtext"==e.type)for(var s=0;s<this.userData[this.currentBoard][e.user].length;s++){var u=this.userData[this.currentBoard][e.user][s];if("inputtext"==u.type&&e.seq==u.belongSeq){u.show=!1,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("move"==e.type){var d=[];e.seq.origin.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o],n=0,a=0;"line"==i.type&&e.seq==i.seq?(n=e.x-i.lines[0].x,a=e.y-i.lines[0].y,i.border.maxX+=n,i.border.minX+=n,i.border.maxY+=a,i.border.minY+=a,i.lines.forEach(function(t){t.x+=n,t.y+=a}),0!==i.fitCurve.length&&i.fitCurve.forEach(function(t){t[1][0]+=n,t[1][1]+=a,t[2][0]+=n,t[2][1]+=a,t[3][0]+=n,t[3][1]+=a}),d.push({uid:r,seq:e.seq,x:e.x,y:e.y})):"graph"==i.type&&e.seq==i.startPoint.seq?(n=e.x-i.startPoint.x,a=e.y-i.startPoint.y,i.startPoint.x+=n,i.startPoint.y+=a,i.endPoint.x+=n,i.endPoint.y+=a,d.push({uid:r,seq:e.seq,x:e.x,y:e.y})):"inputtext"==i.type&&e.seq==i.belongSeq&&(i.location.x=e.x,i.location.y=e.y,d.push({uid:r,seq:i.belongSeq,x:e.x,y:e.y}))}}),this.realTimeData.push({action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),moves:d});var h=[];e.seq.origin.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];if("line"==i.type&&e.seq==i.seq){var n=[];i.lines.forEach(function(t){n.push({seq:t.seq,x:t.x,y:t.y})}),h.push({type:"addLine",seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),seq:i.seq,hidden:0,points:n}})}else if("graph"==i.type&&e.seq==i.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),hidden:0,fillRect:i.solid?1:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}};"rect"==i.graph&&(a.content.cornerRadius=0),h.push(a)}else"inputtext"===i.type&&e.seq==i.belongSeq&&h.push({type:"addText",seq:c.getSeq(),content:{belongSeq:i.belongSeq,time:l.getTimeStamp(),boardId:t.currentBoard,uid:i.user,x:i.location.x,y:i.location.y,colorRGBA:l.formatColor(i.color),scale:i.scale,updateTime:l.getTimeStamp(),hidden:0,typeface:i.typeFace,textSize:i.textSize,fontStyle:i.fontStyle,text:i.text}})}}),this.report.reportGraphData(h)}this.opIndex[this.currentBoard]--,this.setNeedDraw(!0),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())}},Q.prototype.canUndo=function(){return 0!=this.opIndex[this.currentBoard]},Q.prototype.redo=function(){var t=this;this.cancelSelect();var e=this.opData[this.currentBoard][this.opIndex[this.currentBoard]];if(e){if("line"==e.type)for(var r=0;r<this.userData[this.currentBoard][e.user].length;r++){var o=this.userData[this.currentBoard][e.user][r];if(e.seq==o.seq){o.show=!0,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("inputtext"==e.type)for(var n=0;n<this.userData[this.currentBoard][e.user].length;n++){var a=this.userData[this.currentBoard][e.user][n];if("inputtext"==a.type&&e.seq==a.belongSeq){a.show=!0,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("eraser"==e.type)e.seq.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];"line"==i.type&&e.seq==i.seq?i.show=!1:"graph"==i.type&&e.seq==i.startPoint.seq?i.show=!1:"inputtext"===i.type&&e.seq==i.belongSeq&&(i.show=!1)}}),this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:l.getTimeStamp(),seq:c.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:0,lines:e.seq});else if("graph"==e.type)for(var s=0;s<this.userData[this.currentBoard][e.user].length;s++){var u=this.userData[this.currentBoard][e.user][s];if("graph"==u.type&&e.seq==u.startPoint.seq){u.show=!0,this.realTimeData.push({action:i.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:l.getTimeStamp(),seq:c.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:l.getTimeStamp(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("move"==e.type){var d=[];e.seq.final.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o],n=0,a=0;"line"==i.type&&e.seq==i.seq?(n=e.x-i.lines[0].x,a=e.y-i.lines[0].y,i.border.maxX+=n,i.border.minX+=n,i.border.maxY+=a,i.border.minY+=a,i.lines.forEach(function(t){t.x+=n,t.y+=a}),0!==i.fitCurve.length&&i.fitCurve.forEach(function(t){t[1][0]+=n,t[1][1]+=a,t[2][0]+=n,t[2][1]+=a,t[3][0]+=n,t[3][1]+=a}),d.push({uid:r,seq:e.seq,x:e.x,y:e.y})):"graph"==i.type&&e.seq==i.startPoint.seq?(n=e.x-i.startPoint.x,a=e.y-i.startPoint.y,i.startPoint.x+=n,i.startPoint.y+=a,i.endPoint.x+=n,i.endPoint.y+=a,d.push({uid:r,seq:e.seq,x:e.x,y:e.y})):"inputtext"==i.type&&e.seq==i.belongSeq&&(i.location.x=e.x,i.location.y=e.y,d.push({uid:r,seq:i.belongSeq,x:e.x,y:e.y}))}}),this.realTimeData.push({action:i.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),moves:d});var h=[];e.seq.final.forEach(function(e){for(var r=e.uid,o=0;o<t.userData[t.currentBoard][r].length;o++){var i=t.userData[t.currentBoard][r][o];if("line"==i.type&&e.seq==i.seq){var n=[];i.lines.forEach(function(t){n.push({seq:t.seq,x:t.x,y:t.y})}),h.push({type:"addLine",seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),seq:i.seq,hidden:0,points:n}})}else if("graph"==i.type&&e.seq==i.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[i.graph],seq:c.getSeq(),content:{boardId:t.currentBoard,uid:i.user,colorRGBA:l.formatColor(i.color),scale:100,width:i.thin,time:i.time,updateTime:l.getTimeStamp(),hidden:0,beginPoint:{x:i.startPoint.x,y:i.startPoint.y,seq:i.startPoint.seq},endPoint:{x:i.endPoint.x,y:i.endPoint.y,seq:i.endPoint.seq}}};"oval"==i.graph||"circle"==i.graph?a.content.fillRect=0:"rect"==i.graph&&(a.content.fillRect=0,a.content.cornerRadius=0),h.push(a)}else"inputtext"===i.type&&e.seq==i.belongSeq&&h.push({type:"addText",seq:c.getSeq(),content:{belongSeq:i.belongSeq,time:l.getTimeStamp(),boardId:t.currentBoard,uid:i.user,x:i.location.x,y:i.location.y,colorRGBA:l.formatColor(i.color),scale:i.scale,updateTime:l.getTimeStamp(),hidden:0,typeface:i.typeFace,textSize:i.textSize,fontStyle:i.fontStyle,text:i.text}})}}),this.report.reportGraphData(h)}this.opIndex[this.currentBoard]++,this.setNeedDraw(!0),this.event.fire(this,"TEB_OPERATE_CANREDO_STATUS_CHANGED",this.canRedo()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.canUndo())}},Q.prototype.canRedo=function(){return this.opIndex[this.currentBoard]!=this.opData[this.currentBoard].length},Q.prototype.syncHistroyData=function(){var t=this,e=this;e.clearBoard();var r=[],o=[],i=[],n=0;return new Promise(function(a,s){!function a(s,c,u){var d=l.getTimeStamp();new Promise(function(r,o){t.request.getBoardData(s,function(t){t.error_code?(y.report("getBoardData",{action_result:t.error_code,action_info:t.error_msg,time_consume:l.getTimeStamp()-d,extra_info:JSON.stringify(t)}),o("error_code:".concat(t.error_code," error_msg:").concat(t.error_msg)),e.event.fire(this,"TEB_ERROR",B,"sync data error")):(y.report("getBoardData",{time_consume:l.getTimeStamp()-d,extra_info:JSON.stringify(t)}),r(t))},function(t){o("error_code:".concat(t," error_msg:HTTP请求错误，请重试")),e.event.fire(this,"TEB_ERROR",B,"sync data error")})}).then(function(t){(t.board_data_list||[]).forEach(function(t){"setGlobalBG"===t.type?r.push(t):"addFile"===t.type?i.push(t):o.push(t)}),n++,!t.is_finish&&n<100?a(!1,c,u):c()}).catch(function(r){try{e.event.fire(t,"TEB_ERROR",B,r.toString())}catch(r){e.event.fire(t,"TEB_ERROR",B,"sync data error")}})}(!0,function(){var t=this;e.addHistory(r),e.addHistory(i),e.addHistory(o),e.fixBoardData(),e.sortBoard(),e.syncBoardSeq(),setTimeout(function(){e.event.fire(t,"TEB_HISTROYDATA_SYNCCOMPLETED")},200)})})},Q.prototype.fixBoardData=function(){var t=this;try{var e=[];this.getGroup().forEach(function(t){e.push(t.fid)});var r=[];this.boardList.forEach(function(o,n){var a=l.boardId2Fid(o);a!=i.COMMON_GROUP&&-1===e.indexOf(a)&&(r.push(n),delete t.userData[o],delete t.data[o],delete t.opData[o],delete t.opIndex[o],delete t.backgroundPic[o],delete t.backgroundColor[o])}),r.sort(function(t,e){return e-t}),r.forEach(function(e){t.boardList.splice(e,1)})}catch(t){}},Q.prototype.sortBoard=function(){this.boardList=this.boardList.sort(function(t,e){var r=t===i.COMMON_DEFAULT_BOARD?0:t.match(/\d+_\d+_#\w+$/)[0].split("_")[0],o=e===i.COMMON_DEFAULT_BOARD?0:e.match(/\d+_\d+_#\w+$/)[0].split("_")[0];return r!=o?r-o:(t===i.COMMON_DEFAULT_BOARD?0:t.match(/\d+_#\w+$/)[0].split("_")[0])-(e===i.COMMON_DEFAULT_BOARD?0:e.match(/\d+_#\w+$/)[0].split("_")[0])})},Q.prototype.syncBoardSeq=function(){1==this.boardList.length&&this.boardList[0]===i.COMMON_DEFAULT_BOARD?this.boardIdSeq=1:this.boardList[this.boardList.length-1]&&(this.boardIdSeq=1*this.boardList[this.boardList.length-1].match(/\d+_#\w+$/)[0].split("_")[0]+1)},Q.prototype.sortGroup=function(){this.groups=this.groups.sort(function(t,e){return t.fid===i.COMMON_GROUP?-1:e.fid===i.COMMON_GROUP?1:1*t.fid.replace(/\D*/,"")-1*e.fid.replace(/\D*/,"")})},Q.prototype.addData=function(t){var e=this;if(this.permissions){if("[object String]"===Object.prototype.toString.call(t))try{t=JSON.parse(t)}catch(e){this.event.fire(this,"TEB_WARNING",A,e.message+", "+t)}var r=t.value.operator,o=t.value.actions,n=t.value.boardId;this.userData[n]||this.addBoard(n,!1),this.userData[n][r]||(this.userData[n][r]=[]),this.userData[n][r].length,o.forEach(function(t){var o;if(t.color&&(t.color=l.dealColor(t.color)),1==t.action){if((o=e.findLine(n,r,t))?(o.color=t.color,o.thin=t.thin,o.show=!0,o.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),o.sort(),o.setBorder(t.x,t.y)):((o=new d(r,t)).show=!0,e.userData[n][r].push(o),e.data[n].push(o)),0!==o.endSeq&&e.smoothLevel>0){var a=[];o.lines.forEach(function(t){a.push([t.x,t.y])}),o.fitCurve=V(a,1e4*e.smoothLevel,null)}}else if(2==t.action||3==t.action){if((o=e.findLine(n,r,t))?(o.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),o.sort(),o.setBorder(t.x,t.y)):(o=new d(r,t),e.userData[n][r].push(o),e.data[n].push(o)),3==t.action&&(o.endSeq=t.seq,function(t,r){setTimeout(function(){t.color&&t.thin||e.request.getLineData({boardId:r,owner:t.user,seq:t.belongSeq},function(t){t.error_code||(e.addHistory([{content:t.content,type:t.type}]),e.sortBoard(),e.syncBoardSeq())})},500)}(o,n)),0!==o.endSeq&&e.smoothLevel>0){var s=[];o.lines.forEach(function(t){s.push([t.x,t.y])}),o.fitCurve=V(s,1e4*e.smoothLevel,null)}}else if(6==t.action){e.userData[n][r].forEach(function(t){"raser"==t.type&&(t.status=0)});var u=new p(e.identifier,{color:t.color,radius:t.r,x:t.x,y:t.y,seq:c.getSeq()});e.userData[n][r].push(u),e.data[n].push(u)}else if(7==t.action)e.userData[n][r].forEach(function(t){"raser"==t.type&&(t.status=0)});else if(8==t.action){if(!t.lines)return;t.lines.forEach(function(r){for(var o=0;o<e.userData[n][r.uid].length;o++){var i=e.userData[n][r.uid][o];"line"==i.type&&i.startSeq==r.seq?i.show=!!t.display:"graph"==i.type&&i.startPoint.seq==r.seq?i.show=!!t.display:"inputtext"==i.type&&i.belongSeq==r.seq&&(i.show=!!t.display)}})}else if(9==t.action){if(!t.moves)return;t.moves.forEach(function(t){for(var r=0;r<e.userData[n][t.uid].length;r++){var o=e.userData[n][t.uid][r],i=0,a=0;"line"==o.type&&o.startSeq==t.seq?(i=t.x-o.lines[0].x,a=t.y-o.lines[0].y,o.border.maxX+=i,o.border.minX+=i,o.border.maxY+=a,o.border.minY+=a,o.lines.forEach(function(t){t.x+=i,t.y+=a}),0!==o.fitCurve.length&&o.fitCurve.forEach(function(t){t[1][0]+=i,t[1][1]+=a,t[2][0]+=i,t[2][1]+=a,t[3][0]+=i,t[3][1]+=a})):"graph"==o.type&&o.startPoint.seq==t.seq?(i=t.x-o.startPoint.x,a=t.y-o.startPoint.y,o.startPoint.x+=i,o.startPoint.y+=a,o.endPoint.x+=i,o.endPoint.y+=a):"inputtext"==o.type&&o.belongSeq==t.seq&&(o.location.x=t.x,o.location.y=t.y)}})}else if(10==t.action||11==t.action||12==t.action){t.graph={10:"line",11:"oval",12:"rect"}[t.action],t.solid=!!t.fillRect,t.show=!0;var f=new h(r,t);e.userData[n][r].push(f),e.data[n].push(f)}else if(13==t.action)if((1*t.seq||0)>e.maxSeq){e.maxSeq=t.seq;for(var m=null,_=0;_<e.userData[n][r].length;_++){var b=e.userData[n][r][_];if(b.belongSeq===t.belongSeq){t.seq>b.seq&&(b.seq=t.seq),m=b;break}}m?m.text=unescape(decodeURI(t.text)):((m=new g(r,{x:t.x,y:t.y,belongSeq:t.belongSeq})).color=t.color,m.scale=t.scale,m.typeFace=t.typeFace,m.textSize=t.textSize,m.fontStyle=t.fontStyle,m.time=t.time,m.text=unescape(decodeURI(t.text)),e.userData[n][r].push(m),e.data[n].push(m))}else y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:e.maxSeq,boardId:n,method:"addData"})});else if(101==t.action)e.clearBoard(!1);else if(102==t.action)e.clearBoard(!0);else if(103==t.action)try{e.clearFileDrawData(t.fids)}catch(t){}else if(104==t.action)e.resetData();else if(t.action==i.PROTOCOL_ACTION.SET_BOARD_RATIO_ACTION)e.setBoardRatio(n,t.ratio,!1);else if(201==t.action)e.addBackgroundPic({boardIds:n,urls:t.url,type:t.type,needReport:!1,position:t.mode});else if(202==t.action)e.deleteBackgroundPic(n);else if(203==t.action)t.color&&(t.color=l.formatColor(t.color)),t.isGlobal?e.setGlobalBackgroundColor(t.color,!0):e.setBackgroundColor(t.color,!0);else if(t.action==i.PROTOCOL_ACTION.BOARD_MOVE_SCALE_ACTION){if((1*t.seq||0)>e.maxSeq){e.maxSeq=t.seq;var T=e.dragDataList.getDragData(n);T?e.dragDataList.updateDragData(n,{scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}):(T=new X({scale:t.scale,xOffset:t.xOffset,yOffset:t.yOffset}),e.dragDataList.addDragData(n,T))}}else 401==t.action?e.resolveSwitchBoardAction(t):501==t.action&&e.resolveAddFileAction(t.file)}),this.setNeedDraw(!0)}},Q.prototype.resolveSwitchBoardAction=function(t){var e=this,r=t.toBoardId,o=[],n=[];if((1*t.seq||0)>this.maxSeq){this.maxSeq=t.seq,o=t.deleteFiles||[],n=t.deleteBoards||[],o.forEach(function(t){e.deleteGroup(t,!1),n=n.concat(e.getBoardByGroup(t))}),n.forEach(function(t){e.removeBoard(t)}),this.data[r]||this.addBoard(r,!1),this.currentBoard=r;var a=l.boardId2Fid(r);this.currentGroup=a;var s=Math.max(t.page,0),c=Math.max(t.step,0),u=this.getFileInfo(a);u?(u.type===i.FILE_TYPE.H5&&E.gotoTimestampNew(this.iframeDom,{slideIndex:s,stepIndex:c,isPassive:!0}),this.updateFileInfo({fid:a,pageCount:this.getBoardByGroup(a).length,currentPageIndex:s||0,currentPageStep:c||0}),this.event.fire(this,"TEB_GOTOBOARD",r,l.boardId2Fid(r))):this.request.getFileInfo({fid:a},function(t){t&&0==t.error_code&&(u=JSON.parse(t.content),e.resolveAddFileAction(u),e.setNeedDraw(!0),setTimeout(function(){u.type===i.FILE_TYPE.H5&&E.gotoTimestampNew(e.iframeDom,{slideIndex:s,stepIndex:c,isPassive:!0}),e.updateFileInfo({fid:a,pageCount:e.getBoardByGroup(a).length,currentPageIndex:s||0,currentPageStep:c||0}),e.event.fire(e,"TEB_GOTOBOARD",r,l.boardId2Fid(r))},200))},function(t){})}else o=t.deleteFiles||[],n=t.deleteBoards||[],o.forEach(function(t){e.deleteGroup(t,!1),n=n.concat(e.getBoardByGroup(t))}),n.forEach(function(t){e.removeBoard(t)}),y.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:this.maxSeq,boardId:r,method:"addData"})})},Q.prototype.resolveAddFileAction=function(t){var e=null,r=[];if(t.type===i.FILE_TYPE.H5){r=[];for(var o=0;o<t.pageCount;o++)e="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(o+1,"_").concat(t.fid),r.push(e);this.addBoard(r,!1),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,i.FILE_TYPE.H5,0,t.ratio,t.scale)}else{var n=t.downloadURL,a=n?l.fileDownLoadUrlToPreviewUrl(n):"",s=[];r=[];for(var c=0;c<t.pageCount;c++)e="".concat(t.platform,"_").concat(t.uid,"_").concat(t.timestamp,"_").concat(c+1,"_").concat(t.fid),r.push(e),a.endsWith("/")?s.push("".concat(a).concat(c+1,".jpg")):s.push(a+(c+1));this.addBoard(r,!1),this.addBackgroundPic({boardIds:r,urls:s,type:m.BACKGROUND_TYPE.IMAGE,needReport:!1}),this.addGroupNotReport(t.fid,t.title,t.uid,t.downloadURL,t.pageCount,0,t.timestamp,t.platform,i.FILE_TYPE.IMAGE,0,t.ratio,t.scale)}},Q.prototype.addFile=function(t,e,r,o,n){if(Array.isArray(e)){var a,s,u,d,h,f=l.getSecondTime();if(a=this.createBoardIdForFile(t,this.user,f,e.length,i.PLATFORM)||[],n=(u=(s=2===this.boardContentFitMode||1===this.boardContentFitMode?l.calcRatioWidthHeight(n,i.RATIO):l.calcRatioWidthHeight(this.ratio,i.RATIO)).ratioWidth)+":"+(d=s.ratioHeight),2===this.boardContentFitMode){var p=this.containerWidth/u,g=this.containerHeight/d,m=Math.min(p,g);h=Math.max(p,g)/m*100}else this.boardContentFitMode,h=100;this.addGroup(t,r,this.user,o,e.length,0,f,i.PLATFORM,i.FILE_TYPE.IMG,0,n,h),this.addBoard(a),this.addBackgroundPic({boardIds:a,urls:e});var _={action:i.PROTOCOL_ACTION.ADD_FILE_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),file:{fid:t,title:r,downloadURL:o,pageCount:e.length,uid:this.identifier,timestamp:f,platform:i.PLATFORM,type:i.FILE_TYPE.IMG,ratio:n,scale:h}};return this.realTimeData.push(_),a.length&&this.switchFile(t),t}},Q.prototype.addH5PPTFile=function(t,e,r,o,n){for(var a=!1,s=this.getGroup()||[],u=0,d=s.length;u<d;u++)if(s[u].downloadURL==t){a=!0;break}if(!a){var h,f="#".concat(l.getTimeStamp()),p=l.getSecondTime();h=this.createBoardIdForFile(f,this.user,p,r,i.PLATFORM)||[];var g,m,_,y,b=null;if(o&&n){var T=l.maxCommonDivisor(o,n);b=o/T+":"+n/T}else b=this.ratio;if(b=(m=(g=2===this.boardContentFitMode||1===this.boardContentFitMode?l.calcRatioWidthHeight(b,i.RATIO):l.calcRatioWidthHeight(this.ratio,i.RATIO)).ratioWidth)+":"+(_=g.ratioHeight),2===this.boardContentFitMode){var v=this.containerWidth/m,C=this.containerHeight/_,E=Math.min(v,C);y=Math.max(v,C)/E*100}else this.boardContentFitMode,y=100;this.addGroup(f,e,this.user,t,r,0,p,i.PLATFORM,i.FILE_TYPE.H5,0,b,y),this.addBoard(h);var S={action:i.PROTOCOL_ACTION.ADD_FILE_ACTION,time:l.getTimeStamp(),seq:c.getSeq(),file:{fid:f,title:e,downloadURL:t,pageCount:r,uid:this.identifier,timestamp:p,platform:i.PLATFORM,type:i.FILE_TYPE.H5,ratio:b,scale:y}};return this.realTimeData.push(S),h.length&&this.switchFile(f),f}},Q.prototype.deleteFile=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCurrentFile();if(t===i.COMMON_GROUP)return!1;var e=this.deleteGroup(t);return this.event.fire(this,"TEB_DELETEFILE",t),this.switchFile(i.COMMON_GROUP),!(!e||!e.length||(this.deleteBoard(e,t),0))},Q.prototype.switchFile=function(t){for(var e=!1,r=0,o=this.groups.length;r<o;r++)if(this.groups[r].fid==t){e=!0;break}if(e){this.currentGroup=t;var i=this.getFileInfo(t),n=Math.max(0,i.currentPageIndex),a=this.getBoardByGroup(t)[n];return this.event.fire(this,"TEB_SWITCHFILE",t),this.switchBoard(a),t}return!1},Q.prototype.setBoardSize=function(t,e){this.boardWidth=t,this.boardHeight=e},Q.prototype.setContainerSize=function(t,e){this.containerWidth=t,this.containerHeight=e},Q.prototype.setCanvasContext=function(t){this.ctx=t},Q.prototype.setIframeDom=function(t){this.iframeDom=t},Q.prototype.setBoardRatio=function(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.boardRatio[t]=e;var o={};o[t]=e,r&&this.realTimeData.push({action:i.PROTOCOL_ACTION.SET_BOARD_RATIO_ACTION,seq:c.getSeq(),ratio:e}),r&&this.report.reportsetBoardRatio(o)},Q.prototype.getBoardRatio=function(){if(this.getCurrentFile()===i.COMMON_GROUP)return this.boardRatio[this.currentBoard]||this.ratio;var t=this.boardRatio[this.currentBoard];if(t)return t;var e=this.getFileInfo(this.getCurrentFile());return e&&e.ratio?e.ratio:this.ratio},Q.prototype.addDragData=function(t,e){var r=new X(e);this.dragDataList.addDragData(t,r)},Q.prototype.getDragData=function(){return this.dragDataList.getDragData(this.currentBoard)},Q.prototype.setBoardScale=function(t){t||(t=i.SCALE),t=Math.max(i.MIN_SCALE,Math.min(i.MAX_SCALE,t));var e=this.dragDataList.getDragData(this.currentBoard);e?this.dragDataList.updateDragData(this.currentBoard,{scale:t}):(e=new X({scale:t,xOffset:50,yOffset:50}),this.dragDataList.addDragData(this.currentBoard,e)),this.realTimeData.push(e.getRealTimeData()),this.report.reportDrag(Object.assign(e.getReportData(),{boardId:this.currentBoard})),this.setNeedDraw(!0)},Q.prototype.getBoardScale=function(){var t,e=this.dragDataList.getDragData(this.currentBoard);if(e)t=e.scale;else{var r=this.getFileInfo(this.getCurrentFile());r&&(t=r.scale),t||(t=this.scale)}return t},Q.prototype.setBoardContentFitMode=function(t){this.boardContentFitMode=t||P},Q.prototype.getBoardContentFitMode=function(){return this.boardContentFitMode||P},Q.prototype.updateFileInfo=function(t){for(var e=t.fid,r=!1,o=0,i=this.groups.length;o<i;o++){var n=this.groups[o];if(n.fid==e){n.title=n.title||t.title,n.pageCount=t.pageCount,n.currentPageIndex=void 0===t.currentPageIndex?n.currentPageIndex:t.currentPageIndex,n.currentPageStep=void 0===t.currentPageStep?n.currentPageStep:t.currentPageStep,n.downloadURL=n.downloadURL||t.downloadURL,n.uid=n.uid||t.uid,n.timestamp=n.timestamp||t.timestamp,n.ratio=t.ratio||n.ratio,n.scale=t.scale||n.scale,r=!0;break}}r||this.groups.push({fid:t.fid,title:t.title,pageCount:t.pageCount,currentPageIndex:t.currentPageIndex||0,currentPageStep:t.currentPageStep||0,downloadURL:t.downloadURL,uid:t.uid,timestamp:t.timestamp,type:t.type||0,ratio:t.ratio||0,scale:t.scale})},Q.prototype.isExistH5PPTUrl=function(t){for(var e=!1,r=this.getGroup()||[],o=0,i=r.length;o<i;o++)if(r[o].downloadURL==t){e=!0;break}return e},Q.prototype.getH5PPTByUrl=function(t){for(var e={},r=this.getGroup()||[],o=0,i=r.length;o<i;o++)if(r[o].downloadURL==t){e=r[o];break}return e},Q.prototype.createTranscode=function(t){return this.request.createTranscode(t)},Q.prototype.describeTranscode=function(t){return this.request.describeTranscode(t)};var tt=Q;function et(t){if(!(this instanceof et))return new et(t);this.option=Object.assign({},t),this.event=this.option.event,this.orientation=this.option.orientation||"vertical",this.classId=this.option.classId,this.canDraw=!0,"[object Undefined]"===Object.prototype.toString.call(t.drawEnable)||"[object Null]"===Object.prototype.toString.call(t.drawEnable)?this.canDraw=!0:this.canDraw=!!t.drawEnable,this.pinchScale=[],this.beforePinchScale,this.isMoving=!1,this.minLineWidth=t.minLineWidth||i.MIN_LINE_WIDTH,this.store=new tt(t),this.img=t.img,this.width=this.option.width,this.height=this.option.height,this.store.setBoardSize(this.width,this.height),this.canvasComponent=this.option.canvasComponent,this.canvasDrawComponent=this.option.canvasDrawComponent,this.containerOffset=this.option.containerOffset,this.context=this.option.context,this.store.setCanvasContext(this.canvasComponent),this.touchData={onoff:!1,startx:-10,starty:-10,oldx:-10,oldy:-10,inCanvas:!1},this.init()}et.prototype.resize=function(t,e){this.width=t,this.height=e,this.store.setBoardSize(t,e),this.store.setNeedDraw(!0)},et.prototype.getEventLocation=function(t){var e={x:0,y:0};if(e.x=t.changedTouches[0].x,e.y=t.changedTouches[0].y,"vertical"===this.orientation)e.x=parseInt(e.x/this.width*1e4),e.y=parseInt(e.y/this.height*1e4);else{var r=1e4-parseInt(e.x/this.height*1e4),o=parseInt(e.y/this.width*1e4);e.x=o,e.y=r}return e},et.prototype.draw=function(){var t=this,e=this.canvasComponent,r=this.canvasDrawComponent;"horizontal"===this.orientation&&this.setCanvasTranslate(),e.clearRect(0,0,t.width,t.height),this.store.getTransparent();var o=this.store.getCurrentBoardData(),n=o.backgroundPic;n.url&&n.show?this.context.setCurrentImg(n.url,this.getCurrentBoard()):this.context.setCurrentImg("",this.getCurrentBoard()),o.backgroundColor?this.context.setBoardBgColor(o.backgroundColor):this.context.setBoardBgColor(""),function(){var r=o.data;if((r=r.sort(function(t,e){return t.seq-e.seq})).forEach(function(r){if("line"==r.type&&r.show)t.drawLine(e,r);else if("raser"==r.type&&r.status){var o,n,a;o=r.location.x/1e4*t.width,n=r.location.y/1e4*t.height,a=r.radius/1e4*t.height,e.beginPath(),e.arc(o,n,a,0,2*Math.PI),e.setFillStyle(l.dealColor(m.COLOR.RED)),e.fill(),e.closePath()}else if("select"==r.type&&r.show){var s,c,u,d;s=r.startInfo.x/1e4*t.width,c=r.startInfo.y/1e4*t.height,u=(r.location.x-r.startInfo.x)/1e4*t.width,d=(r.location.y-r.startInfo.y)/1e4*t.height,e.setLineDash([15,5]),e.setLineWidth(1),e.setStrokeStyle(t.store.color),e.strokeRect(s,c,u,d),e.setLineDash([])}else if("graph"==r.type&&r.show){var h,f,p,g,_;if(h=r.startPoint.x/1e4*t.width,f=r.startPoint.y/1e4*t.height,p=r.endPoint.x/1e4*t.width,g=r.endPoint.y/1e4*t.height,_=r.thin/1e4*t.height,"line"==r.graph)e.beginPath(),e.moveTo(h,f),e.lineTo(p,g),e.setLineWidth(_),e.setStrokeStyle(r.color),e.setLineCap("round"),e.stroke();else if("rect"==r.graph){var y=h>p?p:h,b=f>g?g:f,T=h+p-2*y,v=f+g-2*b;e.setStrokeStyle(r.color),e.setLineWidth(_),r.solid?(e.setFillStyle(r.color),e.fillRect(y,b,T,v)):e.strokeRect(y,b,T,v)}else if("circle"==r.graph||"oval"==r.graph){var C=(h+p)/2,E=(f+g)/2,S=Math.abs(h-p)/2,D=Math.abs(f-g)/2;e.setStrokeStyle(r.color),e.setLineWidth(_),function(t,e,r,o,i,n,a){var s=.5522848,c=o*s,l=i*s;t.beginPath(),t.moveTo(e-o,r),t.bezierCurveTo(e-o,r-l,e-c,r-i,e,r-i),t.bezierCurveTo(e+c,r-i,e+o,r-l,e+o,r),t.bezierCurveTo(e+o,r+l,e+c,r+i,e,r+i),t.bezierCurveTo(e-c,r+i,e-o,r+l,e-o,r),t.closePath(),t.stroke(),n&&(t.setFillStyle(a),t.fill())}(e,C,E,S,D,r.solid,r.color),e.stroke()}}else if("inputtext"==r.type&&r.show){var A=Math.max(i.MIN_FONT_SIZE,Math.ceil(r.textSize/1e4*t.height));e.beginPath(),e.setFontSize(A),e.setTextBaseline("top"),e.setFillStyle(r.color);var O=l.canvasTextAutoLine(e,r.text,r.location.x/1e4*t.width,r.location.y/1e4*t.height,t.width,A);r.textHeight=O;var x=0;(r.text.split("\n")||[]).forEach(function(t){x=Math.max(x,Math.ceil(e.measureText(t).width+10))}),r.textWidth=x,e.stroke()}}),t.isMoving){var n=t.store.getSelectArea(),a=t.store.getThin();e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((n.x-a)/1e4*t.width,(n.y-a)/1e4*t.height,(n.width+2*a)/1e4*t.width,(n.height+2*a)/1e4*t.height),e.setLineDash([])}else{this.store.getSelectList().forEach(function(r){if("line"==r.type)e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((r.border.minX-2*r.thin)/1e4*t.width,(r.border.minY-2*r.thin)/1e4*t.height,(r.border.maxX-r.border.minX+4*r.thin)/1e4*t.width,(r.border.maxY-r.border.minY+4*r.thin)/1e4*t.height),e.setLineDash([]);else if("graph"==r.type){var o=r.endPoint.x,i=r.endPoint.y,n=r.startPoint.x,a=r.startPoint.y;o<n&&(o+=n,o-=n=o-n),i<a&&(i+=a,i-=a=i-a),e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((n-2*r.thin)/1e4*t.width,(a-2*r.thin)/1e4*t.height,(o-n+4*r.thin)/1e4*t.width,(i-a+4*r.thin)/1e4*t.height),e.setLineDash([])}else"inputtext"==r.type&&(e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect(r.location.x/1e4*t.width-5,r.location.y/1e4*t.height-5,r.textWidth+10,r.textSize/1e4*t.height+10),e.setLineDash([]))})}e.draw()}.apply(this),r.clearRect(0,0,this.width,this.height),r.draw(!1)},et.prototype.addBoard=function(){return this.store.switchFile(i.COMMON_GROUP),this.store.switchBoard()},et.prototype.getBoardData=function(){return JSON.parse(JSON.stringify(this.store.getData()))},et.prototype.addHistory=function(t){this.store.addHistory(t)},et.prototype.addData=function(t){this.store.addData(t)},et.prototype.deleteBoard=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.store.getCurrentBoard();l.boardId2Fid(t)==i.COMMON_GROUP&&this.store.deleteBoard(t)},et.prototype.getBoardList=function(){return JSON.parse(JSON.stringify(this.store.getBoardList()))},et.prototype.getBoardPicList=function(){return JSON.parse(JSON.stringify(this.store.getBoardPicList()))},et.prototype.getCurrentBoard=function(){return this.store.currentBoard},et.prototype.getCurrentFile=function(){return this.store.getCurrentFile()},et.prototype.addBoard=function(){return this.store.getCurrentFile()!=i.COMMON_GROUP&&this.store.switchFile(i.COMMON_GROUP),this.store.switchBoard()},et.prototype.switchBoard=function(t,e){var r=this;if(-1===this.getBoardList().indexOf(t)&&(t=i.COMMON_DEFAULT_BOARD),t){var o=l.boardId2Fid(t);if(this.getFileInfo(o).type===i.FILE_TYPE.H5){var n=this.getBoardByGroup(o).indexOf(t);E.gotoTimestampNew(this.iframeDOM,{slideIndex:n,resetStep:e,isPassive:!1})}else this.store.switchBoard(t)}else clearTimeout(this.bgH5LoadTask),this.bgH5.removeAttribute("src"),this.bgH5LoadTask=setTimeout(function(){r.store.switchBoard(t)},50)},et.prototype.switchPage=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.store.switchPage(t)},et.prototype.prevBoard=function(t){var e=this.getFileInfo(this.getCurrentFile()),r=this.getBoardByGroup(this.getCurrentFile());e.currentPageIndex<1||this.switchBoard(r[e.currentPageIndex-1],t)},et.prototype.prevStep=function(){var t=this.store.getFileInfo(this.store.getCurrentFile());t.type==i.FILE_TYPE.H5?E.gotoPreviousStep(this.iframeDOM,{currentPageIndex:t.currentPageIndex,currentPageStep:t.currentPageStep}):this.prevBoard()},et.prototype.nextBoard=function(t){var e=this.getFileInfo(this.getCurrentFile()),r=this.getBoardByGroup(this.getCurrentFile());e.currentPageIndex<e.pageCount-1&&this.switchBoard(r[e.currentPageIndex+1],t)},et.prototype.nextStep=function(){this.store.getFileInfo(this.store.getCurrentFile()).type==i.FILE_TYPE.H5?E.gotoNextStep(this.iframeDOM,{}):this.nextBoard()},et.prototype.setGlobalBackgroundColor=function(t){this.store.setGlobalBackgroundColor(t)},et.prototype.setBackgroundColor=function(t){this.store.setBackgroundColor(t)},et.prototype.init=function(){var t=this;y.report("init",{extra_info:JSON.stringify({orientation:this.orientation,width:this.width,height:this.height})}),this.drawInterval=setInterval(function(){if(t.store.getNeedDraw()){try{t.draw()}catch(e){t.event.fire(t,"TEB_ERROR",I,"render failed"),y.report("drawerror",{boardid:t.store.getCurrentBoard(),extra_info:e.message})}t.store.setNeedDraw(!1)}},50)},et.prototype.stopDefaultEvent=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},et.prototype.canvasTouchStart=function(t){var e=this.store.getType();"mouse"!=e?(this.stopDefaultEvent(t),this.canDraw&&(this.touchData.inCanvas=!0,this.touchData.onoff=!0,this.store.resetOperation(),this.touchData.oldx=this.touchData.startx=this.getEventLocation(t).x,this.touchData.oldy=this.touchData.starty=this.getEventLocation(t).y,"line"==e?(this.store.cancelSelect(),this.store.collectLineData().start(this.touchData.startx,this.touchData.starty)):"eraser"==e?(this.store.cancelSelect(),this.store.collectEraserData(this.touchData.startx,this.touchData.starty)):"raser"==e?(this.store.cancelSelect(),this.store.collectRaserData().start(this.touchData.startx,this.touchData.starty)):"select"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)?this.isMoving=!0:(this.store.cancelSelect(),this.store.collectSelectData().start(this.touchData.startx,this.touchData.starty)):"pointselect"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0):"keyboardinput"==e||("move"==e?this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0,this.store.collectMoverData().start(this.touchData.startx,this.touchData.starty)):e.indexOf("graph")>-1&&(this.store.cancelSelect(),this.store.collectGraphData().start(this.touchData.startx,this.touchData.starty))),1==this.isMoving&&this.store.collectMoverData().beforeStart(this.touchData.startx,this.touchData.starty)&&(this.isMoving=!0,this.store.collectMoverData().start(this.touchData.startx,this.touchData.starty)))):this.nextStep()},et.prototype.canvasTouchMove=function(t){if(this.stopDefaultEvent(t),this.canDraw){var e=this.store.getType(),r=this.store.getColor(),o=this.store.getThin(),i=this.canvasDrawComponent;if(this.touchData.onoff){var n=this.getEventLocation(t).x,a=this.getEventLocation(t).y;"line"==e?(i.beginPath(),i.moveTo(this.touchData.oldx/1e4*this.width,this.touchData.oldy/1e4*this.height),i.lineTo(n/1e4*this.width,a/1e4*this.height),i.setStrokeStyle(r),i.setLineWidth(o/1e4*this.height),i.setLineCap("round"),i.stroke(),i.draw(!0),this.store.collectLineData().draw(n,a)):"eraser"==e?this.store.collectEraserData(n,a):"raser"==e?this.store.collectRaserData().draw(n,a):"select"==e?this.store.collectSelectData().draw(n,a):"pointselect"==e||("move"==e?this.store.collectMoverData().draw(n,a,this.touchData.oldx,this.touchData.oldy):e.indexOf("graph")>-1&&this.store.collectGraphData().draw(n,a)),this.isMoving&&this.store.collectMoverData().draw(n,a,this.touchData.oldx,this.touchData.oldy),this.touchData.oldx=n,this.touchData.oldy=a}}},et.prototype.canvasTouchEnd=function(t){if(this.stopDefaultEvent(t),this.canDraw){this.touchData.onoff=!1;var e=this.store.getType(),r=this.getEventLocation(t).x,o=this.getEventLocation(t).y;if("line"==e){if(!this.touchData.inCanvas)return;this.store.collectLineData().end(r,o)}else{if("eraser"==e)return;"raser"==e?this.store.collectRaserData().end(r,o):"select"!=e||this.isMoving?"pointselect"!=e||this.isMoving?e.indexOf("graph")>-1&&this.store.collectGraphData().end(r,o):this.store.collectPointSelectData(r,o):this.store.collectSelectData().end(this.touchData.startx,this.touchData.starty,r,o)}this.isMoving&&(this.isMoving=!1,this.store.collectMoverData().end()),this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo())}},et.prototype.canvasTouchCancel=function(t){if(this.stopDefaultEvent(t),this.canDraw){var e,r=this.store.getType(),o=this.getEventLocation(t).x,i=this.getEventLocation(t).y;this.touchData.inCanvas=!1,1==this.touchData.onoff&&("line"==r?(e=this.store.getThin(),o=l.getEffectivePoint(o,e),i=l.getEffectivePoint(i,e),this.store.collectLineData().over(o,i)):"raser"==r?this.store.collectRaserData().over():"select"!=r||this.isMoving?r.indexOf("graph")>-1&&(e=this.store.getThin(),o=l.getEffectivePoint(o,e),i=l.getEffectivePoint(i,e),this.store.collectGraphData().over(o,i)):this.store.collectSelectData().end(this.touchData.startx,this.touchData.starty,o,i),this.isMoving&&(this.isMoving=!1,this.store.collectMoverData().end()),this.touchData.onoff=!1,this.event.fire(this,"TEB_OPERATE_CANUNDO_STATUS_CHANGED",this.store.canUndo()))}},et.prototype.setColor=function(t){this.store.setColor(t)},et.prototype.setThin=function(t){this.store.setThin(t)},et.prototype.setTextSize=function(t){this.store.setTextSize(t)},et.prototype.getTextSize=function(){return this.store.getTextSize()},et.prototype.setTextColor=function(t){this.store.setTextColor(t)},et.prototype.getTextColor=function(){return this.store.getTextColor()},et.prototype.setType=function(t){this.store.setType(m.BOARD_ACTION_TYPE[["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"][t]])},et.prototype.undo=function(){this.store.undo()},et.prototype.canUndo=function(){return this.store.canUndo()},et.prototype.redo=function(){this.store.redo()},et.prototype.canRedo=function(){return this.store.canRedo()},et.prototype.clearBoard=function(t){this.store.clearBoard(t)},et.prototype.clear=function(){this.store.clear()},et.prototype.clearDraws=function(){this.store.clearDraws()},et.prototype.clearAll=function(){this.store.clearAll()},et.prototype.addBackgroundPic=function(t,e,r){this.store.addBackgroundPic(t,e,r)},et.prototype.setBackgroundPic=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.FILL_MODE.DEFAULT;this.store.setBackgroundPic(t,e)},et.prototype.setBackgroundH5=function(t){this.store.setBackgroundH5(t)},et.prototype.updateCurrentFillMode=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.FILL_MODE.DEFAULT;this.store.updateCurrentFillMode(t)},et.prototype.deleteBackgroundPic=function(t){this.store.deleteBackgroundPic(t)},et.prototype.cancelBackgroundPic=function(){this.store.cancelBackgroundPic()},et.prototype.clearGlobalBgColor=function(){this.store.clearGlobalBgColor()},et.prototype.cancelSelect=function(){this.store.cancelSelect()},et.prototype.setCanDraw=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.canDraw=t},et.prototype.addFile=function(t,e,r,o,i){return this.store.addFile(t,e,r,o,i)},et.prototype.addH5PPTFile=function(t){if(!this.store.isExistH5PPTUrl(t)&&this.iframeDOM.getAttribute("src")!==t)return t.indexOf("?")>-1?t+="&page=0&step=0":t+="?page=0&step=0",void this.iframeDOM.setAttribute("src",t);this.event.fire(this,"TEB_WARNING",O,t)},et.prototype.deleteFile=function(t){return this.store.deleteFile(t)},et.prototype.switchFile=function(t){var e=this;t&&t!=this.store.getCurrentFile()&&(clearTimeout(this.pptH5LoadTask),this.iframeDOM.removeAttribute("src"),this.bgH5.removeAttribute("src"),this.pptH5LoadTask=setTimeout(function(){e.store.switchFile(t)},50))},et.prototype.getGroup=function(){return this.store.getGroup()},et.prototype.getFileInfo=function(t){return this.store.getFileInfo(t)},et.prototype.getBoardByGroup=function(t){return this.store.getBoardByGroup(t)},et.prototype.clearFileDraws=function(t){return this.store.clearFileDraws(t)},et.prototype.setOrientation=function(t){this.orientation=t,this.store.setNeedDraw(!0)},et.prototype.setCanvasTranslate=function(){this.canvasComponent.translate(this.height/2,this.width/2),this.canvasComponent.rotate(.5*Math.PI),this.canvasComponent.translate(-this.width/2,-this.height/2),this.canvasDrawComponent.translate(this.height/2,this.width/2),this.canvasDrawComponent.rotate(.5*Math.PI),this.canvasDrawComponent.translate(-this.width/2,-this.height/2)},et.prototype.layout=function(){var t=this.container.clientWidth,e=this.container.clientHeight,r=this.store.getBoardRatio()||this.option.ratio,o=16,i=9;if(!1===r)this.width=t,this.height=e;else{if(void 0===r)o=16,i=9;else try{var n=r.split(":");o=1*n[0],o=isNaN(o)?16:o,i=1*n[1],i=isNaN(i)?9:i}catch(t){o=16,i=9}t/e>o/i?(this.width=e*o/i,this.height=e):(this.width=t,this.height=t*i/o)}this.width=Math.floor(this.width),this.height=Math.floor(this.height)},et.prototype.drawLine=function(t,e){var r=this,o=e.lines,i=e.color,n=e.thin;t.lineWidth=n/1e4*this.height,t.lineCap="round",t.strokeStyle=i,t.fillStyle=i;var a=this.store.getSmoothLevel();if(a>0&&e.endSeq&&!e.fitCurve.length){var s=[];e.lines.forEach(function(t){s.push([t.x,t.y])}),e.fitCurve=V(s,1e4*a,null)}if(t.beginPath(),o.length<2)return t.arc(o[0].x/1e4*this.width,o[0].y/1e4*this.height,t.lineWidth/2,0,2*Math.PI,!0),t.fill(),void t.closePath();if(t.moveTo(o[0].x/1e4*this.width,o[0].y/1e4*this.height),0===e.fitCurve.length){for(var c=1;c<o.length-2;c++){var l=o[c],u=o[c+1],d=(l.x+u.x)/2/1e4*this.width,h=(l.y+u.y)/2/1e4*this.height;t.quadraticCurveTo(l.x/1e4*this.width,l.y/1e4*this.height,d,h)}var f=o[o.length-1];t.lineTo(f.x/1e4*this.width,f.y/1e4*this.height)}else e.fitCurve.forEach(function(e){var o=e[1][0]/1e4*r.width,i=e[1][1]/1e4*r.height,n=e[2][0]/1e4*r.width,a=e[2][1]/1e4*r.height,s=e[3][0]/1e4*r.width,c=e[3][1]/1e4*r.height;t.bezierCurveTo(o,i,n,a,s,c)});t.stroke()},et.prototype.isDrawEnable=function(){return this.canDraw},et.prototype.getGlobalBackgroundColor=function(){return this.store.getGlobalBackgroundColor()},et.prototype.getBackgroundColor=function(){return this.store.getBackgroundColor()},et.prototype.getToolType=function(){var t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t,e){return t===e};return Object.keys(m.BOARD_ACTION_TYPE).find(function(r){return e(m.BOARD_ACTION_TYPE[r],t)})}(this.store.getType());return["MOUSE","LINE","ERASER","RASER","GRAPH-LINE","GRAPH-OVAL","GRAPH-RECT","GRAPH-OVAL-SOLID","GRAPH-RECT-SOLID","POINTSELECT","SELECT","INPUTTEXT","ZOOM"].indexOf(t)},et.prototype.getBrushColor=function(){return this.store.getColor()},et.prototype.getBrushThin=function(){return this.store.getThin()},et.prototype.setDataSyncEnable=function(t){this.store.setDataSyncEnable(t)},et.prototype.isDataSyncEnable=function(){return this.store.isDataSyncEnable()},et.prototype.setTextFontFamily=function(t){this.store.setTextFontFamily(t)},et.prototype.getTextFontFamily=function(){return this.store.getTextFontFamily()},et.prototype.setTextFontStyle=function(t){this.store.setTextFontStyle(t)},et.prototype.getTextFontStyle=function(){return this.store.getTextFontStyle()},et.prototype.setBoardRatio=function(t){this.store.setBoardRatio(this.store.getCurrentBoard(),t),this.draw()},et.prototype.getBoardRatio=function(){return this.store.getBoardRatio()||this.option.ratio},et.prototype.setBoardScale=function(t){this.store.setBoardScale(t),this.draw()},et.prototype.getBoardScale=function(){return this.store.getBoardScale()},et.prototype.setBoardContentFitMode=function(t){this.store.setBoardContentFitMode(t)},et.prototype.getBoardContentFitMode=function(){return this.store.getBoardContentFitMode()},et.prototype.setContainerOffset=function(t){this.containerOffset=t},et.prototype.createTranscode=function(t){return this.store.createTranscode(t)},et.prototype.describeTranscode=function(t){return this.store.describeTranscode(t)};var rt=et;function ot(){}ot.prototype.on=function(t,e){return this._cbs=this._cbs||{},(this._cbs[t]||(this._cbs[t]=[])).unshift(e),this},ot.prototype.off=function(t,e){if(this._cbs=this._cbs||{},!t)return this._cbs={};if(!e)return delete this._cbs[t];for(var r,o=this._cbs[t]||[];o&&~(r=o.indexOf(e));)o.splice(r,1);return this},ot.prototype.fire=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=arguments.length>1?arguments[1]:void 0;this._cbs=this._cbs||{};var r=this._cbs[e];if(r){for(var o=r.length,i=arguments.length,n=new Array(i>2?i-2:0),a=2;a<i;a++)n[a-2]=arguments[a];for(;o--;)r[o].apply(t,[].concat(n))}return this};var it=ot,nt=(r(2),{TEDU_BOARD_UPLOAD_SUCC:1,TEDU_BOARD_UPLOAD_ERROR:2}),at=r(0),st=r.n(at);function ct(t,e){this.cos=null,this.options=t,this.options.cosData=t.cosData||{},this.options.cosData.appid=t.cosData.appid||1257240443,this.options.cosData.bucket=t.cosData.bucket,this.options.cosData.region=t.cosData.region||"ap-shanghai",this.options.cosData.path=t.cosData.path||"TIC/MINIPROGRAM/",this.request=new T(t),this.init(this.options),this.userDataKeyMap={},this.event=t.event,this.board=e}ct.prototype.init=function(t){var e=this;if(st.a){var r=this;this.cos=new st.a({getAuthorization:function(t,o){var i=e.userDataKeyMap["/"+t.Query.prefix];e.request.getCosAuthData().then(function(t){try{if(t&&t.data&&0==t.data.error_code){var n=t.data;o({TmpSecretId:n.tmp_secret_id,TmpSecretKey:n.tmp_secret_key,XCosSecurityToken:n.session_token,ExpiredTime:n.expired_time})}else r.event.fire(e,"TEB_FILEUPLOADSTATUS",nt.TEDU_BOARD_UPLOAD_ERROR,{code:t.data.error_code,userData:i,errorMsg:"get cos securitytoken fail, ".concat(t.data.error_msg)})}catch(t){r.event.fire(e,"TEB_FILEUPLOADSTATUS",nt.TEDU_BOARD_UPLOAD_ERROR,{code:-1,userData:i,errorMsg:"get cos securitytoken fail"})}}).catch(function(t){r.event.fire(e,"TEB_FILEUPLOADSTATUS",nt.TEDU_BOARD_UPLOAD_ERROR,{code:-2,userData:i,errorMsg:"get cos securitytoken fail"})})}})}},ct.prototype.uploadImgFile=function(t,e){var r=this,o=l.getTimeStamp(),i=this;this.uploadCosFile(t).then(function(n){var a=t.name,s="https://".concat(n.Bucket,".file.myqcloud.com/").concat(n.Key),c=n.userData;e&&e(s),i.event.fire(r,"TEB_SETBACKGROUNDIMAGE",a,s,c),y.report("cos_upload_file",{time_consume:l.getTimeStamp()-o,extra_info:JSON.stringify({bucket:r.options.cosData.bucket,cos_appid:r.options.cosData.appid,region:r.options.cosData.region,data:n})})}).catch(function(e){var n;n="[object File]"===Object.prototype.toString.call(t)?"":t.userData,Object.assign(e,{userData:n}),i.event.fire(r,"TEB_ERROR",R,"setbackgroundimg fail, ".concat(e)),y.report("cos_upload_file",{action_result:1,action_info:JSON.stringify(e),time_consume:l.getTimeStamp()-o,extra_info:JSON.stringify({bucket:r.options.cosData.bucket,cos_appid:r.options.cosData.appid,region:r.options.cosData.region,userData:n})})})},ct.prototype.uploadCosFile=function(t){var e=this;return new Promise(function(r,o){!function(t,r,o){var i=e.options.cosData.path+l.getTimeStamp()+"/"+o.name;e.userDataKeyMap[i]=o.userData,e.options.cosData.appid=e.board.store.cosData.cosAppId,e.options.cosData.bucket=e.board.store.cosData.cosBucket;var n=e.options.cosData.bucket+"-"+e.options.cosData.appid;e.cos.postObject({Bucket:n,Region:e.options.cosData.region,Key:i,FilePath:o.path,onProgress:function(t){e.event.fire(e,"TEB_FILEUPLOADPROGRESS",Object.assign({userData:o.userData},t))}},function(a,s){s&&200===s.statusCode?(Object.assign(s,{userData:o.userData}),t(Object.assign({Bucket:n,Key:i},s))):(e.event.fire(this,"TEB_FILEUPLOADSTATUS",nt.TEDU_BOARD_UPLOAD_ERROR,{code:a.statusCode?a.statusCode:-3,userData:o.userData,errorMsg:JSON.stringify(a.error)}),r(a))})}(r,o,t)})},ct.prototype.transcodeUploadFile=function(t,e){var r=this,o=l.getTimeStamp();this.uploadCosFile(t).then(function(t){e(t),y.report("cos_upload_file",{time_consume:l.getTimeStamp()-o,extra_info:JSON.stringify({bucket:r.options.cosData.bucket,cos_appid:r.options.cosData.appid,region:r.options.cosData.region,data:t})})}).catch(function(e){var i;i="[object File]"===Object.prototype.toString.call(t)?"":t.userData,y.report("cos_upload_file",{action_result:1,action_info:JSON.stringify(e),time_consume:l.getTimeStamp()-o,extra_info:JSON.stringify({bucket:r.options.cosData.bucket,cos_appid:r.options.cosData.appid,region:r.options.cosData.region,userData:i})})})};var lt=ct;function ut(t){i.setNativeVersion("2.1.0"),i.setPlatform("miniprogram"),t.tlsData={sdkAppId:t.sdkAppId,identifier:t.userId,userSig:t.userSig},this.event=new it,t.event=this.event,this.board=new rt(t),this.fileCos=new lt(t,this.board),this.version=i.VERSION,this.transcodeIntervalMap={}}r(6),r(8).polyfill(),ut.EVENT={TEB_INIT:"TEB_INIT",TEB_OPERATE_CANUNDO_STATUS_CHANGED:"TEB_OPERATE_CANUNDO_STATUS_CHANGED",TEB_OPERATE_CANREDO_STATUS_CHANGED:"TEB_OPERATE_CANREDO_STATUS_CHANGED",TEB_ADDBOARD:"TEB_ADDBOARD",TEB_SYNCDATA:"TEB_SYNCDATA",TEB_ERROR:"TEB_ERROR",TEB_WARNING:"TEB_WARNING",TEB_HISTROYDATA_SYNCCOMPLETED:"TEB_HISTROYDATA_SYNCCOMPLETED",TEB_IMAGE_STATUS_CHANGED:"TEB_IMAGE_STATUS_CHANGED",TEB_H5BACKGROUND_STATUS_CHANGED:"TEB_H5BACKGROUND_STATUS_CHANGED",TEB_DELETEBOARD:"TEB_DELETEBOARD",TEB_GOTOBOARD:"TEB_GOTOBOARD",TEB_ADDH5PPTFILE:"TEB_ADDH5PPTFILE",TEB_ADDFILE:"TEB_ADDFILE",TEB_DELETEFILE:"TEB_DELETEFILE",TEB_FILEUPLOADSTATUS:"TEB_FILEUPLOADSTATUS",TEB_SWITCHFILE:"TEB_SWITCHFILE",TEB_SETBACKGROUNDIMAGE:"TEB_SETBACKGROUNDIMAGE",TEB_FILEUPLOADPROGRESS:"TEB_FILEUPLOADPROGRESS",TEB_LAYOUT:"TEB_LAYOUT",TEB_TRANSCODEPROGRESS:"TEB_TRANSCODEPROGRESS"},ut.TOOL_TYPE={TEDU_BOARD_TOOL_TYPE_MOUSE:0,TEDU_BOARD_TOOL_TYPE_PEN:1,TEDU_BOARD_TOOL_TYPE_ERASER:2,TEDU_BOARD_TOOL_TYPE_LASER:3,TEDU_BOARD_TOOL_TYPE_LINE:4,TEDU_BOARD_TOOL_TYPE_OVAL:5,TEDU_BOARD_TOOL_TYPE_RECT:6,TEDU_BOARD_TOOL_TYPE_OVAL_SOLID:7,TEDU_BOARD_TOOL_TYPE_RECT_SOLID:8,TEDU_BOARD_TOOL_TYPE_POINT_SELECT:9,TEDU_BOARD_TOOL_TYPE_RECT_SELECT:10,TEDU_BOARD_TOOL_TYPE_TEXT:11,TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG:12,TEDU_BOARD_TOOL_TYPE_STRAIGHT_LINE:13,TEDU_BOARD_TOOL_TYPE_ELLIPSE:14},ut.prototype.on=function(t,e){this.event.on(t,e)},ut.prototype.off=function(t,e){this.event.off(t,e)},ut.prototype.getVersion=function(){return this.version},ut.prototype.addBoard=function(t,e){var r=this.board.addBoard();return this.board.setBackgroundPic(t,e),r},ut.prototype.deleteBoard=function(t){this.board.deleteBoard(t)},ut.prototype.prevBoard=function(){this.board.prevBoard()},ut.prototype.nextBoard=function(){this.board.nextBoard()},ut.prototype.gotoBoard=function(t){t&&this.board.switchBoard(t)},ut.prototype.getCurrentBoard=function(){return this.board.getCurrentBoard()},ut.prototype.getBoardList=function(){return this.board.getBoardList()},ut.prototype.deleteFile=function(t){this.board.deleteFile(t)},ut.prototype.switchFile=function(t){this.board.switchFile(t)},ut.prototype.getCurrentFile=function(){return this.board.getCurrentFile()},ut.prototype.getFileInfo=function(t){return this.board.getFileInfo(t)},ut.prototype.getFileInfoList=function(){return this.board.getGroup()},ut.prototype.getFileBoardList=function(t){return this.board.getBoardByGroup(t)},ut.prototype.clearFileDraws=function(t){this.board.clearFileDraws(t)},ut.prototype.reset=function(){this.board.clearAll()},ut.prototype.addSyncData=function(t){this.board.addData(t)},ut.prototype.setDrawEnable=function(t){this.board.setCanDraw(t)},ut.prototype.isDrawEnable=function(){return this.board.isDrawEnable()},ut.prototype.setGlobalBackgroundColor=function(t){this.board.setGlobalBackgroundColor(t)},ut.prototype.getGlobalBackgroundColor=function(){return this.board.getGlobalBackgroundColor()},ut.prototype.setBackgroundColor=function(t){this.board.setBackgroundColor(t)},ut.prototype.getBackgroundColor=function(){return this.board.getBackgroundColor()},ut.prototype.setToolType=function(t){this.board.setType(t)},ut.prototype.getToolType=function(){return this.board.getToolType()},ut.prototype.setBrushColor=function(t){this.board.setColor(t)},ut.prototype.getBrushColor=function(){return this.board.getBrushColor()},ut.prototype.setBrushThin=function(t){this.board.setThin(t)},ut.prototype.getBrushThin=function(){return this.board.getBrushThin()},ut.prototype.clear=function(t){t?this.board.clear():this.board.clearDraws()},ut.prototype.setBackgroundImage=function(t,e){var r=this;if("[object String]"===Object.prototype.toString.call(t))this.board.setBackgroundPic(t,e);else if("[object Object]"===Object.prototype.toString.call(t)){var o=t;this.fileCos.uploadImgFile(o,function(t){r.board.setBackgroundPic(t,e)})}},ut.prototype.undo=function(){this.board.undo()},ut.prototype.redo=function(){this.board.redo()},ut.prototype.resize=function(t,e){this.board.resize(t,e)},ut.prototype.setTextStyle=function(t){this.board.setTextFontStyle(t)},ut.prototype.getTextStyle=function(){return this.board.getTextFontStyle()},ut.prototype.setTextFamily=function(t){this.board.setTextFontFamily(t)},ut.prototype.getTextFamily=function(){return this.board.getTextFontFamily()},ut.prototype.canvasTouchStart=function(t){this.board.canvasTouchStart(t)},ut.prototype.canvasTouchMove=function(t){this.board.canvasTouchMove(t)},ut.prototype.canvasTouchEnd=function(t){this.board.canvasTouchEnd(t)},ut.prototype.canvasTouchCancel=function(t){this.board.canvasTouchCancel(t)},ut.prototype.setOrientation=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical";this.board.setOrientation(t)},ut.prototype.setContainerOffset=function(t){this.board.setContainerOffset(t)},ut.prototype.setDataSyncEnable=function(t){this.board.setDataSyncEnable(t)},ut.prototype.isDataSyncEnable=function(){return this.board.isDataSyncEnable()},ut.prototype.addTranscodeFile=function(t){var e="#".concat(l.getTimeStamp());if(t.pages&&0!=t.pages&&t.url.endsWith("/")){for(var r=[],o=0;o<t.pages;o++)r.push("".concat(t.url).concat(o+1,".jpg"));try{var i=t.resolution.split("x")[0],n=t.resolution.split("x")[1],a=l.maxCommonDivisor(i,n),s="".concat(i/a,":").concat(n/a);return this.board.addFile(e,r,t.title,t.url,s)}catch(o){return this.board.addFile(e,r,t.title,t.url,null)}}},ut.prototype.applyFileTranscode=function(t,e){var r=this;if("[object Object]"===Object.prototype.toString.call(t)){var o=t.userData;if("image"===t.type)return void this.event.fire(this,"TEB_TRANSCODEPROGRESS",{code:"FailedOperation.SdkModule",message:"transcode does not support image",userData:o,status:"ERROR"});"file"===t.type&&this.fileCos.transcodeUploadFile(t,function(t){var i="https://".concat(t.Bucket,".file.myqcloud.com/").concat(t.Key);e="[object Object]"===Object.prototype.toString.call(e)?Object.assign(e,{url:i}):{url:i},r.board.createTranscode(e).then(function(t){if(t.data.Response.Error)r.event.fire(r,"TEB_TRANSCODEPROGRESS",{code:t.data.Response.Error.Code,message:t.data.Response.Error.Message,status:"ERROR",userData:o});else{r.event.fire(r,"TEB_TRANSCODEPROGRESS",Object.assign(t.data.Response,{code:"",message:"",userData:o,status:"CREATE"}));var e=t.data.Response.TaskId;r.transcodeIntervalMap[e]=setInterval(function(){r.getFileTranscodeProgress({taskId:e})},5e3)}},function(t){r.event.fire(r,"TEB_TRANSCODEPROGRESS",{code:"FailedOperation.SdkModule",message:"transcode failure",userData:o,status:"ERROR"})})})}else this.event.fire(this,"TEB_TRANSCODEPROGRESS",{code:"FailedOperation.SdkModule",message:"invalid arguments",status:"ERROR"})},ut.prototype.getFileTranscodeProgress=function(t){var e=this;this.board.describeTranscode(t).then(function(r){r.data.Response.Error?(e.event.fire(e,"TEB_TRANSCODEPROGRESS",{status:"ERROR",code:r.data.Response.Error.Code,message:r.data.Response.Error.Message,taskId:t.taskId}),clearInterval(e.transcodeIntervalMap[t.taskId])):r.data.Response&&(e.event.fire(e,"TEB_TRANSCODEPROGRESS",Object.assign({code:"",message:""},r.data.Response)),"FINISHED"===r.data.Response.Status&&clearInterval(e.transcodeIntervalMap[t.taskId]))},function(r){e.event.fire(e,"TEB_TRANSCODEPROGRESS",{status:"ERROR",code:"FailedOperation.SdkModule",message:"transcode failure",taskId:t.taskId}),clearInterval(e.transcodeIntervalMap[t.taskId])}).catch(function(r){e.event.fire(e,"TEB_TRANSCODEPROGRESS",{status:"ERROR",code:"FailedOperation.SdkModule",message:r.message||"transcode failure",taskId:t.taskId}),clearInterval(e.transcodeIntervalMap[t.taskId])})},e.default=ut}]).default});